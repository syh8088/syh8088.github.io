<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>결제 Testing - 1 | Seo Yang Hun Blog</title>
  <meta name="keywords" content="">
  <meta name="description" content="결제 Testing - 1 | Seo Yang Hun Blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="캐시 전략기본적으로 웹서비스 경우 데이터베이스 통해 수집, 저장, 관리, 검색 역할을 하고 있습니다. 하지만 많은 트래픽이 발생이 하면 캐싱을 하게 되는데 기본적으로 데이터베이스 (디스크) 보다 메모리 (RAM) 같은 빠른 임시 저장소에 저장 해서 관리 하게 됩니다. 이는 어플리케이션 응답 속도를 획기적으로 높이고, 데이터베이스 부하를 줄이는데 획기적인 방">
<meta property="og:type" content="article">
<meta property="og:title" content="캐시 전략">
<meta property="og:url" content="https://syh8088.github.io/2025/12/28/NoSQL/CACHE_STRATEGY/CacheStrategy/index.html">
<meta property="og:site_name" content="Seo Yang Hun Blog">
<meta property="og:description" content="캐시 전략기본적으로 웹서비스 경우 데이터베이스 통해 수집, 저장, 관리, 검색 역할을 하고 있습니다. 하지만 많은 트래픽이 발생이 하면 캐싱을 하게 되는데 기본적으로 데이터베이스 (디스크) 보다 메모리 (RAM) 같은 빠른 임시 저장소에 저장 해서 관리 하게 됩니다. 이는 어플리케이션 응답 속도를 획기적으로 높이고, 데이터베이스 부하를 줄이는데 획기적인 방">
<meta property="og:locale">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1.CachePenetration.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-1.NullObjectPattern.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-2-1.BloomFilter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-2-2.BloomFilter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-2-3.BloomFilter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-2-4.BloomFilter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-2-5.BloomFilter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-2-6.BloomFilter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-2-7.BloomFilter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-2-8.BloomFilter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1-2-9.BloomFilter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2.CacheStampede.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-1.Jitter.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-2-1.ProbabilisticEarlyRecomputation(PER).png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-2-2.ProbabilisticEarlyRecomputation(PER).png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-3-1.RequestCollapsing.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-3-2.RequestCollapsing.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-4.RateLimit.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-5-1.WriteThrough.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-5-2.WriteThrough.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-5-3.WriteThrough.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-5-4.WriteThrough.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-5-5.WriteThrough.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/2-5-6.WriteThrough.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/3_1.HotKey.png">
<meta property="og:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/3_2.HotKey.png">
<meta property="article:published_time" content="2025-12-27T22:47:42.000Z">
<meta property="article:modified_time" content="2026-01-20T13:04:53.684Z">
<meta property="article:author" content="Seo Yang Hun">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://syh8088.github.io/img/NoSQL/CACHE_STRATEGY/1.CachePenetration.png">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>Seo Yang Hun</span>
</div>

<div class="icon">
    
        
            <a title="rss"
               href="/atom.xml"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-rss"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="github"
               href="https://github.com/syh8088"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <a title="email"
               href="mailto:syh8088@gmail.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=872336115&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(69)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="Authentication">
            <i class="fold iconfont icon-right"></i>
            Authentication
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Authentication&lt;---&gt;JWT">
            
            JWT
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="Authentication&lt;---&gt;Oauth">
            
            Oauth
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="AWS">
            <i class="fold iconfont icon-right"></i>
            AWS
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="AWS&lt;---&gt;Image Resizing">
            
            Image Resizing
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="CI-CD">
            <i class="fold iconfont icon-right"></i>
            CI-CD
            <small>(10)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;AWS">
            <i class="fold iconfont icon-right"></i>
            AWS
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;AWS&lt;---&gt;EKS">
            <i class="fold iconfont icon-right"></i>
            EKS
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;AWS&lt;---&gt;EKS&lt;---&gt;Kubernetes">
            <i class="fold iconfont icon-right"></i>
            Kubernetes
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;AWS&lt;---&gt;EKS&lt;---&gt;Kubernetes&lt;---&gt;Docker">
            
            Docker
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;GitHubActions">
            
            GitHubActions
            <small>(6)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;Jenkins">
            
            Jenkins
            <small>(3)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="DB">
            <i class="fold iconfont icon-right"></i>
            DB
            <small>(5)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="DB&lt;---&gt;Mysql">
            <i class="fold iconfont icon-right"></i>
            Mysql
            <small>(4)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="DB&lt;---&gt;Mysql&lt;---&gt;DBCP">
            
            DBCP
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="DB&lt;---&gt;Mysql&lt;---&gt;optimizing">
            
            optimizing
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="DB&lt;---&gt;Mysql&lt;---&gt;Paging">
            
            Paging
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="DB&lt;---&gt;MySql">
            <i class="fold iconfont icon-right"></i>
            MySql
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="DB&lt;---&gt;MySql&lt;---&gt;Collation">
            
            Collation
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="Elastic Search">
            
            Elastic Search
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="Flink">
            <i class="fold iconfont icon-right"></i>
            Flink
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Flink&lt;---&gt;Real Time">
            <i class="fold iconfont icon-right"></i>
            Real Time
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Flink&lt;---&gt;Real Time&lt;---&gt;Kafka">
            
            Kafka
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="J">
            <i class="fold iconfont icon-right"></i>
            J
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="J&lt;---&gt;Jenkins">
            
            Jenkins
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="JAVA">
            <i class="fold iconfont icon-right"></i>
            JAVA
            <small>(29)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;HTTP">
            <i class="fold iconfont icon-right"></i>
            HTTP
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;HTTP&lt;---&gt;FeignClient">
            
            FeignClient
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;JPA">
            
            JPA
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Object">
            
            Object
            <small>(2)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Payment">
            
            Payment
            <small>(5)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Security">
            
            Security
            <small>(4)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Spring">
            <i class="fold iconfont icon-right"></i>
            Spring
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Spring&lt;---&gt;Payment">
            <i class="fold iconfont icon-right"></i>
            Payment
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Spring&lt;---&gt;Payment&lt;---&gt;junit5">
            <i class="fold iconfont icon-right"></i>
            junit5
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Spring&lt;---&gt;Payment&lt;---&gt;junit5&lt;---&gt;Mockito">
            
            Mockito
            <small>(2)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;SpringBatch">
            
            SpringBatch
            <small>(5)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;SpringBootAndSecurityAndJWT">
            
            SpringBootAndSecurityAndJWT
            <small>(3)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;SpringCloudConfig">
            
            SpringCloudConfig
            <small>(4)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Transaction">
            
            Transaction
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Validator">
            
            Validator
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="JavaScript">
            <i class="fold iconfont icon-right"></i>
            JavaScript
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JavaScript&lt;---&gt;Webpack">
            
            Webpack
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="Kafka">
            <i class="fold iconfont icon-right"></i>
            Kafka
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Kafka&lt;---&gt;idempotent">
            
            idempotent
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="KUBERNETES">
            
            KUBERNETES
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="MSA">
            <i class="fold iconfont icon-right"></i>
            MSA
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment">
            <i class="fold iconfont icon-right"></i>
            Payment
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka">
            <i class="fold iconfont icon-right"></i>
            Kafka
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka&lt;---&gt;EDA">
            <i class="fold iconfont icon-right"></i>
            EDA
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka&lt;---&gt;EDA&lt;---&gt;CQRS">
            
            CQRS
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka&lt;---&gt;EDA&lt;---&gt;Saga">
            <i class="fold iconfont icon-right"></i>
            Saga
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka&lt;---&gt;EDA&lt;---&gt;Saga&lt;---&gt;Axon">
            
            Axon
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="Network">
            
            Network
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="NoSQL">
            <i class="fold iconfont icon-right"></i>
            NoSQL
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="NoSQL&lt;---&gt;Redis">
            <i class="fold iconfont icon-right"></i>
            Redis
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="NoSQL&lt;---&gt;Redis&lt;---&gt;RateLimiter">
            
            RateLimiter
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="R">
            
            R
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="대용량 트래픽">
            <i class="fold iconfont icon-right"></i>
            대용량 트래픽
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;EDA">
            <i class="fold iconfont icon-right"></i>
            EDA
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;EDA&lt;---&gt;Payment">
            <i class="fold iconfont icon-right"></i>
            Payment
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;EDA&lt;---&gt;Payment&lt;---&gt;Redis">
            <i class="fold iconfont icon-right"></i>
            Redis
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;EDA&lt;---&gt;Payment&lt;---&gt;Redis&lt;---&gt;Kafka">
            
            Kafka
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;Redis">
            <i class="fold iconfont icon-right"></i>
            Redis
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;Redis&lt;---&gt;Kafka">
            
            Kafka
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;Redis&lt;---&gt;WebFlux">
            <i class="fold iconfont icon-right"></i>
            WebFlux
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;Redis&lt;---&gt;WebFlux&lt;---&gt;접근자 대기열">
            
            접근자 대기열
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="69">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="search shortcut key i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="switch to outline view shortcut key w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="return"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="case sensitive"></i>
            <i class="iconfont icon-tag" data-title="label"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">outline</div>
            <i class="iconfont icon-list" data-title="switch to article list"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All NoSQL Redis "
           href="/2025/12/28/NoSQL/CACHE_STRATEGY/CacheStrategy/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="캐시 전략">캐시 전략</span>
            <span class="post-date" title="2025-12-28 07:47:42">2025/12/28</span>
        </a>
        
        
        <a  class="All CI-CD AWS EKS Kubernetes Docker "
           href="/2025/08/15/CI-CD/AWS_EKS_CICD/aws_eks_cicd/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AWS EKS 서버 배포 - CI/CD">AWS EKS 서버 배포 - CI/CD</span>
            <span class="post-date" title="2025-08-15 07:47:42">2025/08/15</span>
        </a>
        
        
        <a  class="All DB MySql Collation "
           href="/2025/07/23/DB/Mysql/Collation/Collation/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Mysql - Collation">Mysql - Collation</span>
            <span class="post-date" title="2025-07-23 07:47:42">2025/07/23</span>
        </a>
        
        
        <a  class="All Network "
           href="/2025/07/15/NETWORK/introduction/Network-Introduction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="네트워크 - 구조 및 공유기 원리">네트워크 - 구조 및 공유기 원리</span>
            <span class="post-date" title="2025-07-15 07:47:42">2025/07/15</span>
        </a>
        
        
        <a  class="All Kafka "
           href="/2025/07/06/KAFKA/introduction/kafka_introduction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="카프카 개념 및 실전">카프카 개념 및 실전</span>
            <span class="post-date" title="2025-07-06 07:47:42">2025/07/06</span>
        </a>
        
        
        <a  class="All "
           href="/2025/06/27/AWS/ImageResizing/imageTest/"
           data-tag=""
           data-author="" >
            <span class="post-title" title=""></span>
            <span class="post-date" title="2025-06-27 20:10:06">2025/06/27</span>
        </a>
        
        
        <a  class="All AWS Image Resizing "
           href="/2025/06/26/AWS/ImageResizing/aws-image-resizing/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AWS Image Resizing 구현하기">AWS Image Resizing 구현하기</span>
            <span class="post-date" title="2025-06-26 07:47:42">2025/06/26</span>
        </a>
        
        
        <a  class="All Elastic Search "
           href="/2025/06/16/ELASTIC_SEARCH/introduction/elasticsearch-introduction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Elastic Search 검색 활용기">Elastic Search 검색 활용기</span>
            <span class="post-date" title="2025-06-16 07:47:42">2025/06/16</span>
        </a>
        
        
        <a  class="All Flink Real Time Kafka "
           href="/2025/04/05/FLINK/introduction/Flink-Introduction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Flink 이용해서 실시간 데이터 스트림 처리 해보기">Flink 이용해서 실시간 데이터 스트림 처리 해보기</span>
            <span class="post-date" title="2025-04-05 07:47:42">2025/04/05</span>
        </a>
        
        
        <a  class="All Kafka idempotent "
           href="/2024/12/23/KAFKA/idempotent/Kafka_idempotent/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="카프카 멱등성 및 이벤트 일관성 보장하기">카프카 멱등성 및 이벤트 일관성 보장하기</span>
            <span class="post-date" title="2024-12-23 07:47:42">2024/12/23</span>
        </a>
        
        
        <a  class="All MSA Payment Kafka EDA CQRS "
           href="/2024/12/16/MSA/paymentMsa/MSA_Payment_Project_3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템으로 알아보는 MSA 3 - 쿼리 문제">결제 시스템으로 알아보는 MSA 3 - 쿼리 문제</span>
            <span class="post-date" title="2024-12-16 07:47:42">2024/12/16</span>
        </a>
        
        
        <a  class="All MSA Payment Kafka EDA Saga Axon "
           href="/2024/12/15/MSA/paymentMsa/MSA_Payment_Project_2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템으로 알아보는 MSA 2 - 분산 트랜잭션 구현">결제 시스템으로 알아보는 MSA 2 - 분산 트랜잭션 구현</span>
            <span class="post-date" title="2024-12-15 07:47:42">2024/12/15</span>
        </a>
        
        
        <a  class="All MSA Payment Kafka EDA "
           href="/2024/12/14/MSA/paymentMsa/MSA_Payment_Project_1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템으로 알아보는 MSA 1 - 기본 설명">결제 시스템으로 알아보는 MSA 1 - 기본 설명</span>
            <span class="post-date" title="2024-12-14 07:47:42">2024/12/14</span>
        </a>
        
        
        <a  class="All 대용량 트래픽 EDA Payment Redis Kafka "
           href="/2024/12/13/HIGH_VOLUME_TRAFFIC/PaymentEDA/PaymentEDA/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템으로 알아보는 EDA 시스템">결제 시스템으로 알아보는 EDA 시스템</span>
            <span class="post-date" title="2024-12-13 07:47:42">2024/12/13</span>
        </a>
        
        
        <a  class="All DB Mysql optimizing "
           href="/2024/12/06/DB/Mysql/optimizing/IndexDiveOptimizaiton/IndexDiveOptimizaiton/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Index Dive 최적화">Index Dive 최적화</span>
            <span class="post-date" title="2024-12-06 07:47:42">2024/12/06</span>
        </a>
        
        
        <a  class="All JAVA Spring Payment junit5 Mockito "
           href="/2024/12/03/JAVA/TEST/PaymentTesting/PaymentTesting2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 Testing - 2">결제 Testing - 2</span>
            <span class="post-date" title="2024-12-03 15:50:00">2024/12/03</span>
        </a>
        
        
        <a  class="All JAVA Spring Payment junit5 Mockito "
           href="/2024/12/02/JAVA/TEST/PaymentTesting/PaymentTesting1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 Testing - 1">결제 Testing - 1</span>
            <span class="post-date" title="2024-12-02 15:50:00">2024/12/02</span>
        </a>
        
        
        <a  class="All 대용량 트래픽 Redis WebFlux 접근자 대기열 "
           href="/2024/11/28/HIGH_VOLUME_TRAFFIC/AccessorQueuingSystem/AccessorQueuingSystem/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="대용량 트래픽 - 접근자 대기열 시스템 만들기">대용량 트래픽 - 접근자 대기열 시스템 만들기</span>
            <span class="post-date" title="2024-11-28 07:47:42">2024/11/28</span>
        </a>
        
        
        <a  class="All 대용량 트래픽 Redis Kafka "
           href="/2024/11/22/HIGH_VOLUME_TRAFFIC/CreateCoupon/CreateCoupon/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="대용량 트래픽 - 선착순 쿠폰 등록 With Kafka, Redis">대용량 트래픽 - 선착순 쿠폰 등록 With Kafka, Redis</span>
            <span class="post-date" title="2024-11-22 07:47:42">2024/11/22</span>
        </a>
        
        
        <a  class="All NoSQL Redis RateLimiter "
           href="/2024/11/19/NoSQL/Redis/RateLimiter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Request Rate Limiter 구현하기">Request Rate Limiter 구현하기</span>
            <span class="post-date" title="2024-11-19 07:47:42">2024/11/19</span>
        </a>
        
        
        <a  class="All CI-CD GitHubActions "
           href="/2024/10/20/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 6">GitHubActions CICD With SpringBoot - 6</span>
            <span class="post-date" title="2024-10-20 07:47:42">2024/10/20</span>
        </a>
        
        
        <a  class="All CI-CD GitHubActions "
           href="/2024/10/19/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot5/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 5">GitHubActions CICD With SpringBoot - 5</span>
            <span class="post-date" title="2024-10-19 07:47:42">2024/10/19</span>
        </a>
        
        
        <a  class="All CI-CD GitHubActions "
           href="/2024/10/18/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot4/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 4">GitHubActions CICD With SpringBoot - 4</span>
            <span class="post-date" title="2024-10-18 07:47:42">2024/10/18</span>
        </a>
        
        
        <a  class="All CI-CD GitHubActions "
           href="/2024/10/17/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 3">GitHubActions CICD With SpringBoot - 3</span>
            <span class="post-date" title="2024-10-17 07:47:42">2024/10/17</span>
        </a>
        
        
        <a  class="All CI-CD GitHubActions "
           href="/2024/10/14/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 2">GitHubActions CICD With SpringBoot - 2</span>
            <span class="post-date" title="2024-10-14 07:47:42">2024/10/14</span>
        </a>
        
        
        <a  class="All CI-CD GitHubActions "
           href="/2024/10/14/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 1">GitHubActions CICD With SpringBoot - 1</span>
            <span class="post-date" title="2024-10-14 07:47:42">2024/10/14</span>
        </a>
        
        
        <a  class="All DB Mysql Paging "
           href="/2024/10/06/DB/Mysql/PagingQuery/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Paging Query 성능 개선 및 처리 방법 - 튜닝편">Paging Query 성능 개선 및 처리 방법 - 튜닝편</span>
            <span class="post-date" title="2024-10-06 07:47:42">2024/10/06</span>
        </a>
        
        
        <a  class="All DB Mysql DBCP "
           href="/2024/10/02/DB/Mysql/mysqlDBCP/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="DBCP 설정 방법">DBCP 설정 방법</span>
            <span class="post-date" title="2024-10-02 07:47:42">2024/10/02</span>
        </a>
        
        
        <a  class="All JAVA Object "
           href="/2024/08/24/JAVA/Object/InheritanceComposition2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="상속과 합성 이야기-2">상속과 합성 이야기-2</span>
            <span class="post-date" title="2024-08-24 15:50:00">2024/08/24</span>
        </a>
        
        
        <a  class="All JAVA Object "
           href="/2024/08/23/JAVA/Object/InheritanceComposition1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="상속과 합성 이야기-1">상속과 합성 이야기-1</span>
            <span class="post-date" title="2024-08-23 15:50:00">2024/08/23</span>
        </a>
        
        
        <a  class="All JAVA Payment "
           href="/2024/08/06/JAVA/Payment/PaymentTransactionalOutboxpattern/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 5">결제 시스템 구축 - 5</span>
            <span class="post-date" title="2024-08-06 15:50:00">2024/08/06</span>
        </a>
        
        
        <a  class="All JAVA Payment "
           href="/2024/08/05/JAVA/Payment/PaymentRetry/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 4">결제 시스템 구축 - 4</span>
            <span class="post-date" title="2024-08-05 15:50:00">2024/08/05</span>
        </a>
        
        
        <a  class="All JAVA Payment "
           href="/2024/07/28/JAVA/Payment/BuildingPaymentSystem/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 1">결제 시스템 구축 - 1</span>
            <span class="post-date" title="2024-07-28 15:50:00">2024/07/28</span>
        </a>
        
        
        <a  class="All JAVA Payment "
           href="/2024/07/28/JAVA/Payment/PaymentCheckOut/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 2">결제 시스템 구축 - 2</span>
            <span class="post-date" title="2024-07-28 15:50:00">2024/07/28</span>
        </a>
        
        
        <a  class="All JAVA Payment "
           href="/2024/07/28/JAVA/Payment/PaymentConfirm/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 3">결제 시스템 구축 - 3</span>
            <span class="post-date" title="2024-07-28 15:50:00">2024/07/28</span>
        </a>
        
        
        <a  class="All "
           href="/2024/05/31/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2024-05-31 22:32:19">2024/05/31</span>
        </a>
        
        
        <a  class="All "
           href="/2024/05/31/README/"
           data-tag=""
           data-author="" >
            <span class="post-title" title=""></span>
            <span class="post-date" title="2024-05-31 22:32:19">2024/05/31</span>
        </a>
        
        
        <a  class="All JAVA Security "
           href="/2024/05/30/JAVA/Security/AnonymousAuthenticationFilter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AnonymousAuthenticationFilter">AnonymousAuthenticationFilter</span>
            <span class="post-date" title="2024-05-30 10:04:43">2024/05/30</span>
        </a>
        
        
        <a  class="All "
           href="/2024/02/01/HIGH_VOLUME_TRAFFIC/AccessorQueuingSystem2/AccessorQueuingSystem/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="패스트캠퍼스 9개 프로젝트로 경험하는 대용량 트래픽 &amp; 데이터 처리 초격차 패키지 Online. 수강">패스트캠퍼스 9개 프로젝트로 경험하는 대용량 트래픽 &amp; 데이터 처리 초격차 패키지 Online. 수강</span>
            <span class="post-date" title="2024-02-01 00:00:00">2024/02/01</span>
        </a>
        
        
        <a  class="All Authentication JWT "
           href="/2021/11/27/AUTHTICATION/JWT/jwt/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="JWT (JSON Web Token) 이해하기">JWT (JSON Web Token) 이해하기</span>
            <span class="post-date" title="2021-11-27 07:47:42">2021/11/27</span>
        </a>
        
        
        <a  class="All Authentication Oauth "
           href="/2021/11/27/AUTHTICATION/OAUTH/oauth/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="OAUTH 2.0 이해하기">OAUTH 2.0 이해하기</span>
            <span class="post-date" title="2021-11-27 07:47:42">2021/11/27</span>
        </a>
        
        
        <a  class="All JAVA HTTP FeignClient "
           href="/2021/11/08/JAVA/HTTP/FeignClient/FeignClient/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="FeignClient 활용도">FeignClient 활용도</span>
            <span class="post-date" title="2021-11-08 10:04:43">2021/11/08</span>
        </a>
        
        
        <a  class="All JAVA SpringBatch "
           href="/2021/11/04/JAVA/Batch/SpringBatch5/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch - Chunk 5">Spring Batch - Chunk 5</span>
            <span class="post-date" title="2021-11-04 07:47:42">2021/11/04</span>
        </a>
        
        
        <a  class="All JAVA SpringBatch "
           href="/2021/10/30/JAVA/Batch/SpringBatch4/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch - Flow 4">Spring Batch - Flow 4</span>
            <span class="post-date" title="2021-10-30 07:47:42">2021/10/30</span>
        </a>
        
        
        <a  class="All JAVA SpringBatch "
           href="/2021/10/24/JAVA/Batch/SpringBatch3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch - 메타데이터 스키마 3">Spring Batch - 메타데이터 스키마 3</span>
            <span class="post-date" title="2021-10-24 07:47:42">2021/10/24</span>
        </a>
        
        
        <a  class="All JAVA SpringBatch "
           href="/2021/10/19/JAVA/Batch/SpringBatch2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch - Job, Step 2">Spring Batch - Job, Step 2</span>
            <span class="post-date" title="2021-10-19 07:47:42">2021/10/19</span>
        </a>
        
        
        <a  class="All JAVA SpringBatch "
           href="/2021/10/17/JAVA/Batch/SpringBatch1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch 1">Spring Batch 1</span>
            <span class="post-date" title="2021-10-17 07:47:42">2021/10/17</span>
        </a>
        
        
        <a  class="All JAVA SpringCloudConfig "
           href="/2021/09/13/JAVA/SpringCloudConfig/spring-cloud-config4/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="비대칭키를 이용한 application.yml 설정값 암호화">비대칭키를 이용한 application.yml 설정값 암호화</span>
            <span class="post-date" title="2021-09-13 07:47:45">2021/09/13</span>
        </a>
        
        
        <a  class="All JAVA SpringCloudConfig "
           href="/2021/09/13/JAVA/SpringCloudConfig/spring-cloud-config3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Cloud Bus">Spring Cloud Bus</span>
            <span class="post-date" title="2021-09-13 07:47:44">2021/09/13</span>
        </a>
        
        
        <a  class="All JAVA SpringCloudConfig "
           href="/2021/09/13/JAVA/SpringCloudConfig/spring-cloud-config2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Boot Actuator">Spring Boot Actuator</span>
            <span class="post-date" title="2021-09-13 07:47:43">2021/09/13</span>
        </a>
        
        
        <a  class="All JAVA SpringCloudConfig "
           href="/2021/09/13/JAVA/SpringCloudConfig/spring-cloud-config/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Cloud Config">Spring Cloud Config</span>
            <span class="post-date" title="2021-09-13 07:47:42">2021/09/13</span>
        </a>
        
        
        <a  class="All JAVA Transaction "
           href="/2021/03/14/JAVA/Transaction/multi-transaction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java Multi-Transaction 관리">Java Multi-Transaction 관리</span>
            <span class="post-date" title="2021-03-14 07:47:42">2021/03/14</span>
        </a>
        
        
        <a  class="All JAVA Validator "
           href="/2020/12/18/JAVA/VALIDATOR/validator/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java Validator 관리">Java Validator 관리</span>
            <span class="post-date" title="2020-12-18 07:47:42">2020/12/18</span>
        </a>
        
        
        <a  class="All JAVA Security "
           href="/2020/11/19/JAVA/Security/SessionManagementFilterAndConcurrentSessionFilter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SessionManagementFilterAndConcurrentSessionFilter">SessionManagementFilterAndConcurrentSessionFilter</span>
            <span class="post-date" title="2020-11-19 18:02:23">2020/11/19</span>
        </a>
        
        
        <a  class="All JAVA Security "
           href="/2020/11/14/JAVA/Security/RememberMeAuthenticationFilter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RememberMeAuthenticationFilter">RememberMeAuthenticationFilter</span>
            <span class="post-date" title="2020-11-14 07:40:06">2020/11/14</span>
        </a>
        
        
        <a  class="All JAVA Security "
           href="/2020/11/13/JAVA/Security/UsernamePasswordAuthenticationFilter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="UsernamePasswordAuthenticationFilter">UsernamePasswordAuthenticationFilter</span>
            <span class="post-date" title="2020-11-13 08:51:13">2020/11/13</span>
        </a>
        
        
        <a  class="All CI-CD Jenkins "
           href="/2020/11/09/CI-CD/Jenkins/JenkinsGitLabConnect/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Jenkins_GitLab_연동">Jenkins_GitLab_연동</span>
            <span class="post-date" title="2020-11-09 07:47:42">2020/11/09</span>
        </a>
        
        
        <a  class="All CI-CD Jenkins "
           href="/2020/11/08/CI-CD/Jenkins/JenkinsGitLabSshConnect/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="젠킨스와 GitLab ssh 연동하기">젠킨스와 GitLab ssh 연동하기</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="All JAVA JPA "
           href="/2020/11/08/JAVA/JPA/eagerJpqlNplus1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="eagerJpqlNplus1">eagerJpqlNplus1</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="All JAVA SpringBootAndSecurityAndJWT "
           href="/2020/11/08/JAVA/SpringBootAndSecurityAndJWT/spring-boot-security-jwt-social/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Boot 를 이용해 JWT + Social 로그인 처리 - Authorization Server (일반 로그인)">Spring Boot 를 이용해 JWT + Social 로그인 처리 - Authorization Server (일반 로그인)</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="All JAVA SpringBootAndSecurityAndJWT "
           href="/2020/11/08/JAVA/SpringBootAndSecurityAndJWT/spring-boot-security-jwt-social2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Boot 를 이용해 JWT + Social 로그인 처리 - Authorization Server (Social 로그인)">Spring Boot 를 이용해 JWT + Social 로그인 처리 - Authorization Server (Social 로그인)</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="All JAVA SpringBootAndSecurityAndJWT "
           href="/2020/11/08/JAVA/SpringBootAndSecurityAndJWT/spring-boot-security-jwt-social3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Boot 를 이용해 JWT + Social 로그인 처리 - Resource Server">Spring Boot 를 이용해 JWT + Social 로그인 처리 - Resource Server</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="All J Jenkins "
           href="/2020/11/07/JAVA/Security/JKSGenerate/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="JKSGenerate">JKSGenerate</span>
            <span class="post-date" title="2020-11-07 13:46:21">2020/11/07</span>
        </a>
        
        
        <a  class="All CI-CD Jenkins "
           href="/2020/11/07/CI-CD/Jenkins/JenkinsInstall/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="쿠버네티스 환경 구성">쿠버네티스 환경 구성</span>
            <span class="post-date" title="2020-11-07 07:47:42">2020/11/07</span>
        </a>
        
        
        <a  class="All DB Mysql "
           href="/2020/11/07/DB/Mysql/mysqlReplicationSetting/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Mysql_Replication_설정">Mysql_Replication_설정</span>
            <span class="post-date" title="2020-11-07 07:47:42">2020/11/07</span>
        </a>
        
        
        <a  class="All KUBERNETES "
           href="/2020/11/07/KUBERNETES/%EC%89%BD%EA%B2%8C_%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94_%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4_%ED%99%98%EA%B2%BD_%EA%B5%AC%EC%84%B1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Jenkins_설치">Jenkins_설치</span>
            <span class="post-date" title="2020-11-07 07:47:42">2020/11/07</span>
        </a>
        
        
        <a  class="All R "
           href="/2020/10/17/R/RServerInstall/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RServer 설치">RServer 설치</span>
            <span class="post-date" title="2020-10-17 07:47:42">2020/10/17</span>
        </a>
        
        
        <a  class="All JavaScript Webpack "
           href="/2020/10/17/JAVASCRIPT/Webpack/devtool/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="WebPack - DevTool">WebPack - DevTool</span>
            <span class="post-date" title="2020-10-17 07:47:42">2020/10/17</span>
        </a>
        
        
        <a  class="All "
           href="/2018/12/02/%EB%A9%B4%EC%A0%91%EC%A4%80%EB%B9%84/test/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="그냥... 잡다한 지식 모음집">그냥... 잡다한 지식 모음집</span>
            <span class="post-date" title="2018-12-02 15:50:00">2018/12/02</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="Toggle full screen shortcut key s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-JAVA/TEST/PaymentTesting/PaymentTesting1" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">결제 Testing - 1</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="JAVA">JAVA</a> > 
            
            <a  data-rel="JAVA&lt;---&gt;Spring">Spring</a> > 
            
            <a  data-rel="JAVA&lt;---&gt;Spring&lt;---&gt;Payment">Payment</a> > 
            
            <a  data-rel="JAVA&lt;---&gt;Spring&lt;---&gt;Payment&lt;---&gt;junit5">junit5</a> > 
            
            <a  data-rel="JAVA&lt;---&gt;Spring&lt;---&gt;Payment&lt;---&gt;junit5&lt;---&gt;Mockito">Mockito</a>
            
        </span>
        
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2024-12-20 07:39:37'>2024-12-02 15:50</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views 👀 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%EC%98%88%EC%A0%9C-%EC%86%8C%EC%8A%A4-%EC%BD%94%EB%93%9C"><span class="toc-text">예제 소스 코드</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%EA%B2%B0%EC%A0%9C-TEST-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0"><span class="toc-text">결제 TEST 구현하기</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TEST-%EC%BD%94%EB%93%9C%EA%B0%80-%EC%9E%88%EC%9D%8C%EC%9C%BC%EB%A1%9C-%EC%9E%A5%EC%A0%90"><span class="toc-text">TEST 코드가 있음으로 장점</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TEST-%EB%8C%80%EC%83%81%EC%9D%B4-%EB%90%98%EB%8A%94-%EA%B2%B0%EC%A0%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C"><span class="toc-text">TEST 대상이 되는 결제 시스템</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Junit-5-%EB%A1%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1-%ED%95%B4%EB%B3%B4%EA%B8%B0"><span class="toc-text">Junit 5 로 테스트 코드 작성 해보기</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TDD-%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C"><span class="toc-text">TDD 란 무엇일까?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Layered-Architecture-%EB%A0%88%EC%9D%B4%EC%96%B4%EB%93%9C-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98"><span class="toc-text">Layered Architecture 레이어드 아키텍처</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%86%B5%ED%95%A9-%ED%85%8C%EC%8A%A4%ED%8A%B8-Integration-Test"><span class="toc-text">통합 테스트 (Integration Test)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Persistence-Layer-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">Persistence Layer 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBootTest-VS-DataJpaTest"><span class="toc-text">@SpringBootTest VS @DataJpaTest</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Business-Layer-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">Business Layer 테스트</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="예제-소스-코드"><a href="#예제-소스-코드" class="headerlink" title="예제 소스 코드"></a>예제 소스 코드</h1><p>이번 블로그에 사용되는 코드는 아래 링크 통해 확인 할 수 있습니다.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/syh8088/payment_testing">https://github.com/syh8088/payment_testing</a></p>
<h1 id="결제-TEST-구현하기"><a href="#결제-TEST-구현하기" class="headerlink" title="결제 TEST 구현하기"></a>결제 TEST 구현하기</h1><p>안녕하세요. 이번에 결제 프로세스를 통해 Spring Boot 에서 테스트 구현에 있어 한번 준비 해보았습니다. 일단 TEST 는 왜 필요 하는지 알아야 될<br>것 같은데요. </p>
<p>예를들어 회사에 취업을 하고 결제 프로젝트를 맡게 되면서 서비스를 구현 했다고 가정 하겠습니다. 스타트업인 만큼 빠르게 성과를 보여줘야 하기 때문에<br>TEST 코드는 준비 하지 않고 런칭 하게 되었습니다. 빠르게 성과를 보여줬지만 문제는 지금부터 입니다. </p>
<p>서비스란 서비스 출시 이후 작성했던 코드들은 부분적으로 수정도 해야하고 추가도 해야 할것 입니다. TEST 코드를 작성하지 않는 상태에서 기존에 작성했던<br>비지니스 로직들은 영향이 미칠것 입니다. 예를들어 특정 기능을 구현하기 위해 A 객체와 B 객체 서로 간의 역활을 위임하고 책임을 분배하고 있는 상황에서<br>A 객체 기능 수정 및 추가로 인해 B 객체에서도 영향이 있을 것 입니다.</p>
<p>즉 A 객체를 기능 수정이 일어나고 이후 B 객체에 영향으로 인해 버그가 발생 할 수 있는 소지가 있습니다. 개발자는 이런 상황을 감지 하지 못 하고 상용 배포를 할 경우<br>서비스에 대한 큰 문제가 발생 할 수 있습니다. 즉 소프트웨어의 안정성을 보장 할 수 없게 됩니다.</p>
<p>앞써 이야기 한대로 앞으로 기능 추가 할때마다 발생 할 수 있는 모든 TEST Case 를 고려 해야 합니다. TEST 코드를 작성하지 않을시 매순간 이러한 모든 Case 를 고려를 해야 할것 입니다.</p>
<h2 id="TEST-코드가-있음으로-장점"><a href="#TEST-코드가-있음으로-장점" class="headerlink" title="TEST 코드가 있음으로 장점"></a>TEST 코드가 있음으로 장점</h2><p>앞써 TEST 코드가 없다면 발생 할 수 있는 문제에 대해 알아보았는데요. 그럼 번거롭지만 TEST 코드를 작성시 발생 할 수 있는 장점을 무엇 일까요?<br>우선 앞으로 점차 서비스가 커지고 기능을 추가되면서 여러 기능을 추가 할때마다 발생 할 수 있는 여러 Case 를 빠르게 인지 하고 TEST 할 수 있습니다.</p>
<p>그리고 TEST 코드를 통해 TEST 를 하게 된다면 수동적으로 TEST 를 한것 보다 속도면에서도 빠른 강점을 볼 수 있습니다.</p>
<p>초기 TEST 코드 작성하는데 있어서 비용적인 문제가 없다고 할 수 없지만 길게 본다면 분명 큰 장점 이라고 생각 됩니다.</p>
<h2 id="TEST-대상이-되는-결제-시스템"><a href="#TEST-대상이-되는-결제-시스템" class="headerlink" title="TEST 대상이 되는 결제 시스템"></a>TEST 대상이 되는 결제 시스템</h2><p>이번에 TEST 대상이 되는 서비스 시스템은 결제 시스템 입니다. 여기서 제가 TEST 대상이 되는 여러 시스템이 있지만 결제 시스템으로 선택한 이유는<br>사용자가 결제를 시도 하면서 실제로 비용이 발생되고 이에 따르 서비스 제공자는 단 1원도 오차 없이 작동 해야 하기 때문입니다. </p>
<p>예를들어 사용자가 결제를 했는데도 특정 에러로 결제는 했지만 결제로 인한 상태 데이터가 업데이트가 되지 않으면서 이에 따른 소비자에게 손실이 발생 하면 신뢰도는 저하 될 것 입니다.</p>
<p>이러한 문제를 발생하지 않도록 견고하게 특정 에러가 발생되더라도 자동적으로 시스템이 이를 감지하고 문제 해결을 할 수만 있다면 좋겠지만 이런 문제를 사전에 방지 하기 위해서라도<br>여러 기능에 대한 TEST 코드를 만들면서 시스템의 안정성을 확보 해야 합니다.</p>
<p><img src="/../../../../img/JAVA/TEST/PaymentTesting/paymentProcess.png" alt="결제 프로세스"></p>
<p>간단하게 TEST 대상이 되는 결제 시스템에 대해 설명 하도록 하겠습니다. </p>
<ol>
<li>우선 사용자가 결제 버튼을 클릭하면 ‘Checkout’ 이벤트가 발생되면서 사용자가 특정 상품에 대한 구매 이벤트를 발생 하도록 합니다.</li>
<li>‘Checkout’ 이벤트가 발생되면서 서비스단에서는 PaymentEvent 가 생성되고 더불어 해당 이벤트에 대한 unique id 값을 생성 하도록 합니다.</li>
</ol>
<p><img src="/../../../../img/JAVA/TEST/PaymentTesting/tossPaymentWidget.png" alt="토스 결제 위젯"></p>
<ol start="3">
<li>특정 결제 unique id 값 포함해서 상품 가격 데이터를 Toss 서버에 전달 하게 되고 이에 응답으로 Toss 에서 제공하는 결제 위젯 페이지를 띄우게 됩니다. </li>
<li>사용자가 Toss 에서 제공하는 위젯페이지 통해 실질적으로 결제가 진행 됩니다.</li>
<li>결제가 진행되고 Toss 는 사용자에게 결제 결과 응답을 해줍니다.</li>
<li>응답과 동시에 결제 서비스 서버로 Redirect 발생됩니다. </li>
<li>최종적으로 결제 승인을 처리 하기 위해 사용자가 구매한 결제를 최종적으로 성공 했다는 사실을 Toss 서버에 전달 합니다. 성공시 최종적으로 결제가 완료 됩니다. 동시에 결제 상태 업데이트를 하게 됩니다.</li>
</ol>
<h2 id="Junit-5-로-테스트-코드-작성-해보기"><a href="#Junit-5-로-테스트-코드-작성-해보기" class="headerlink" title="Junit 5 로 테스트 코드 작성 해보기"></a>Junit 5 로 테스트 코드 작성 해보기</h2><p>지금까지 TEST 대상이 되는 결제 시스템을 간단히 알아보았습니다. 이제부터 본격적으로 TEST 코드를 작성 해보겠습니다. 사용되는 테스트 프레임워크로는 JUnit5 과 Mockito 를 사용하겠습니다.<br>JUnit5 경우는 자바에서 사용되는 단위 테스트를 작성하는데 사용되는 프레임워크 입니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testImplementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-test&#x27;</span></span><br></pre></td></tr></table></figure>
<p>build.gradle 에서 해당 의존성을 추가 하면 자동으로 Junit 라이브러리를 내장 하게 됩니다.</p>
<h2 id="TDD-란-무엇일까"><a href="#TDD-란-무엇일까" class="headerlink" title="TDD 란 무엇일까?"></a>TDD 란 무엇일까?</h2><p>TEST 에 대해 알아보기전 TDD (Test Driven Development) 관련해서 알아보는것도 중요하다 생각하여 한번 추가 해보았습니다.<br>구현 순서로 생각해보자면 먼저 기능을 구현 한 뒤에 그 다음 TEST 를 구현한다고 생각하기 쉽다고 생각 할 수 있습니다. ‘TDD’ 경우는 기능을 구현하전<br>먼저 TEST 를 구현하고 기능을 구현 하는 개발 방법론 입니다.</p>
<p><img src="/../../../../img/JAVA/TEST/PaymentTesting/TDD_RedGreenRefactor.png" alt="TDD Red-Green-Refactor"></p>
<p>TDD 의 대표적인 개발주기인 Red, Green, Refactor 입니다. 각각 단어를 설명 하자면</p>
<ol>
<li>‘Red’ 단계 경우 실패하는 테스트 코드를 먼저 작성 합니다.</li>
<li>‘Green’ 단계 테스트 코드를 성공시키기 위한 기능이 되는 실제 코드를 작업 합니다.</li>
<li>‘Yellow’ 단계 경우 중복 코드 제거 그리고 일반화 등의 리팩토링을 수행 하는 작업 입니다.</li>
</ol>
<p>이렇게 먼저 테스트 코드를 작성하고 이후 기능 구현 순서로 가야 하는 이유는 여러가지가 있을수 있겠습니다. 사람의 심리상 기능 구현을 한 다음 시간이 없다 생각하여<br>TEST 구현을 못 할수도 있습니다. 이러한 실수를 방지 하기위해 TEST 구현 부터 하는 이유 중 하나 이겠습니다.</p>
<p>그리고 또 하나는 기능 구현부터 한다면 미리 작성한 기능 구현 베이스로 TEST 를 작성을 하기 때문에 이미 어느정도 작동이 잘되는 소스 코드 기반으로 TEST 구현 하기 때문 입니다.<br>이러한 긍정적인 사고로 인해 해당 오퍼레이션에서 예외가 발생 할 수 있는 케이스를 누락 될 수 있는 실수가 발생 할 수 있습니다.</p>
<p>먼저 TEST 구현하고 나중에 기능 구현을 하게 된다면 TEST 구현하는 과정에서 이전 보다 놓치기 쉬운 더 많은 예외 케이스에 대한 사고가 더해지면서 결국 소프트웨어가 안정화 될수 있겠습니다.</p>
<h2 id="Layered-Architecture-레이어드-아키텍처"><a href="#Layered-Architecture-레이어드-아키텍처" class="headerlink" title="Layered Architecture 레이어드 아키텍처"></a>Layered Architecture 레이어드 아키텍처</h2><p><img src="/../../../../img/JAVA/TEST/PaymentTesting/LayeredArchitecture.png" alt="Layered Architecture 계층"></p>
<p>TEST 구현하기 전 ‘Layered Architecture’ 에 대해 알아볼려고 합니다. 이렇게 각각의 레이어를 분리 하는 이유는 ‘관심사’ 의 분리로 시작 한다고 보면 될 것 같습니다.</p>
<p>여러 기능을 각각의 역활을 분리 하면서 관심사를 분리 하므로써 레이어를 분리 하는 것 입니다. 즉 관심사를 분리해 각각의 책임을 나누고 유지보수를 조금 더<br>용이 하기 위함이라고 보면 됩니다.</p>
<p>그럼 TEST 코드 작성시에도 이렇게 레이어로 분리 해보면서 관심사를 분리 해보는 것이 어떨까 입니다. </p>
<h2 id="통합-테스트-Integration-Test"><a href="#통합-테스트-Integration-Test" class="headerlink" title="통합 테스트 (Integration Test)"></a>통합 테스트 (Integration Test)</h2><p><img src="/../../../../img/JAVA/TEST/PaymentTesting/IntegrationTest.png" alt="통합 테스트 예시"></p>
<p>객체지향 개발 방식에서 예를들어 각각의 A 객체 B 객체 서로 협력 하면서 동작 하게 됩니다. 각각 단일 테스트로는 A 객체 그리고 B 객체 어떤 결과가 발생<br>되는지 예측하기 쉬웠지만 이를 서로 협력 통해 통합 하면서 생각하면 어떻게 동작을 하는지 예측하기 어렵게 됩니다.</p>
<p>‘통합 테스트 (Integration Test)’ 통해 여러 모듈이 협력하는 기능을 통합적으로 검증 하는 테스트가 나온것 입니다.</p>
<p>서로 협력을 통해 일반적으로 단일 테스트로는 예측하기 어려운 문제를 통합 테스트를 통해 이를 해결하자는 이야기 입니다. </p>
<p>이번 테스트 경우는 앞써 Layered Architecture 를 설명한 대로 각각의 레이어 단위로 테스트를 하고 서로 협력 하는 레이어 부분은 통합 테스트를 통해 진행 해볼려고 합니다.</p>
<h2 id="Persistence-Layer-테스트"><a href="#Persistence-Layer-테스트" class="headerlink" title="Persistence Layer 테스트"></a>Persistence Layer 테스트</h2><p><img src="/../../../../img/JAVA/TEST/PaymentTesting/PersistenceLayerTest.png" alt="Persistence Layer Test"></p>
<p>먼저 ‘Persistence Layer’ 에서 등록된 상품을 조회 하는 테스트 작성을 진행 해볼려고 합니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title class_">ActiveProfiles</span>(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">@<span class="title class_">SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProductRepositoryTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">ProductRepository</span> productRepository;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Test</span></span><br><span class="line">    @<span class="title class_">DisplayName</span>(<span class="string">&quot;등록된 상품들을 조회한다.&quot;</span>)</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">selectProduct</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="title class_">Product</span> product1 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;AAA&quot;</span>, <span class="string">&quot;상품A&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">1000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product2 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;BBB&quot;</span>, <span class="string">&quot;상품B&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">2000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product3 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;CCC&quot;</span>, <span class="string">&quot;상품C&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">3000</span>));</span><br><span class="line"></span><br><span class="line">        productRepository.<span class="title function_">saveAll</span>(<span class="title class_">List</span>.<span class="title function_">of</span>(product1, product2, product3));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Product</span>&gt; products = productRepository.<span class="title function_">selectProductAll</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        <span class="title function_">assertThat</span>(products).<span class="title function_">hasSize</span>(<span class="number">3</span>)</span><br><span class="line">                .<span class="title function_">extracting</span>(<span class="string">&quot;productId&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;price&quot;</span>)</span><br><span class="line">                .<span class="title function_">usingRecursiveFieldByFieldElementComparator</span>(</span><br><span class="line">                        <span class="title class_">RecursiveComparisonConfiguration</span>.<span class="title function_">builder</span>()</span><br><span class="line">                                .<span class="title function_">withComparatorForType</span>(<span class="title class_">BigDecimal</span>::compareTo, <span class="title class_">BigDecimal</span>.<span class="property">class</span>).<span class="title function_">build</span>()</span><br><span class="line">                )</span><br><span class="line">                .<span class="title function_">containsExactlyInAnyOrder</span>(</span><br><span class="line">                        <span class="title function_">tuple</span>(<span class="string">&quot;AAA&quot;</span>, <span class="string">&quot;상품A&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">1000</span>)),</span><br><span class="line">                        <span class="title function_">tuple</span>(<span class="string">&quot;BBB&quot;</span>, <span class="string">&quot;상품B&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">2000</span>)),</span><br><span class="line">                        <span class="title function_">tuple</span>(<span class="string">&quot;CCC&quot;</span>, <span class="string">&quot;상품C&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">3000</span>))</span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title class_">Product</span> <span class="title function_">createProduct</span>(<span class="params"><span class="built_in">String</span> productId, <span class="built_in">String</span> name, BigDecimal price</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Product</span>.<span class="title function_">of</span>(productId, name, price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TEST 코드를 보면 단순하게 등록된 상품을 조회 하는 역활인데 이것을 TEST 를 굳이 해야 하는가? 라는 의문이 생길수 있습니다. 하지만 지금은 예측이<br>쉽게 가능한 단순 상품 조회이지만 나중에 상품 조회 기능이 더욱 복잡해지고 기능이 추가 되면서 이에 보장 할 수 있는 미리 TEST 코드를 작성 하면서 신뢰성 있는<br>기능 추가가 가능해집니다.</p>
<p>Persistence Layer 테스트 주요 목표는 데이터 Access 가 정상적으로 역할을 잘 수행 하고 있는지 그리고 오로지 Data 에 대한 CRUD 관련 TEST 만 진행 하는 것이 좋습니다.<br>즉 그외 비지니스 가공 로직에 포함 되어서는 안됩니다.</p>
<h2 id="SpringBootTest-VS-DataJpaTest"><a href="#SpringBootTest-VS-DataJpaTest" class="headerlink" title="@SpringBootTest VS @DataJpaTest"></a>@SpringBootTest VS @DataJpaTest</h2><p>상품 조회 기능 테스트를 하기 위해서 JPA 기술 통해 조회를 하고 있는데요. 그러면 생각 할 수 있는 부분이 ‘@SpringBootTest’ 사용하지 않고<br>‘@DataJpaTest’ 를 사용하면서 불필요한 빈을 최소화 하면 어떨까 생각이 발생 할 수 있습니다. </p>
<p>@DataJpaTest 경우는 @SpringBootTest 다르게 JPA 관련된 빈들만 등록해주기 때문에 더 가볍다는 장점이 있습니다. </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title class_">Target</span>(value=<span class="variable constant_">TYPE</span>)</span><br><span class="line">@<span class="title class_">Retention</span>(value=<span class="variable constant_">RUNTIME</span>)</span><br><span class="line">@<span class="title class_">Documented</span></span><br><span class="line">@<span class="title class_">Inherited</span> @<span class="title class_">BootstrapWith</span>(value=org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">test</span>.<span class="property">autoconfigure</span>.<span class="property">orm</span>.<span class="property">jpa</span>.<span class="property">DataJpaTestContextBootstrapper</span>.<span class="property">class</span>)</span><br><span class="line">@<span class="title class_">ExtendWith</span>(value=org.<span class="property">springframework</span>.<span class="property">test</span>.<span class="property">context</span>.<span class="property">junit</span>.<span class="property">jupiter</span>.<span class="property">SpringExtension</span>.<span class="property">class</span>)</span><br><span class="line">@<span class="title class_">OverrideAutoConfiguration</span>(enabled=<span class="literal">false</span>)</span><br><span class="line">@<span class="title class_">TypeExcludeFilters</span>(value=<span class="title class_">DataJpaTypeExcludeFilter</span>.<span class="property">class</span>)</span><br><span class="line">@<span class="title class_">Transactional</span></span><br><span class="line">@<span class="title class_">AutoConfigureCache</span></span><br><span class="line">@<span class="title class_">AutoConfigureDataJpa</span></span><br><span class="line">@<span class="title class_">AutoConfigureTestDatabase</span></span><br><span class="line">@<span class="title class_">AutoConfigureTestEntityManager</span></span><br><span class="line">@<span class="title class_">ImportAutoConfiguration</span></span><br><span class="line">public @interface <span class="title class_">DataJpaTest</span></span><br></pre></td></tr></table></figure>

<p>개인적으로 @DataJpaTest 보다 @SpringBootTest 이 선호 하는데요. ‘@DataJpaTest’ 안에 들어다 보면 @Transaction 에노테이션을 확인 할수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title class_">Target</span>(value=<span class="variable constant_">TYPE</span>)</span><br><span class="line">@<span class="title class_">Retention</span>(value=<span class="variable constant_">RUNTIME</span>)</span><br><span class="line">@<span class="title class_">Documented</span></span><br><span class="line">@<span class="title class_">Inherited</span></span><br><span class="line">@<span class="title class_">BootstrapWith</span>(value=<span class="title class_">SpringBootTestContextBootstrapper</span>.<span class="property">class</span>)</span><br><span class="line">@<span class="title class_">ExtendWith</span>(value=org.<span class="property">springframework</span>.<span class="property">test</span>.<span class="property">context</span>.<span class="property">junit</span>.<span class="property">jupiter</span>.<span class="property">SpringExtension</span>.<span class="property">class</span>)</span><br><span class="line">public @interface <span class="title class_">SpringBootTest</span></span><br></pre></td></tr></table></figure>

<p>하지만 반대로 @SpringBootTest 는 @Transaction 에노테이션이 없는것을 확인 할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title class_">Test</span></span><br><span class="line"><span class="keyword">void</span> A상품_조회() &#123;</span><br><span class="line">    <span class="comment">// given</span></span><br><span class="line">    <span class="comment">// A 상품 등록 - 1개 등록</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// when</span></span><br><span class="line">    <span class="comment">// 등록한 상품 조회</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// then</span></span><br><span class="line">    <span class="comment">// 등록 한 상품 count 비교</span></span><br><span class="line">    <span class="comment">// 1개라고 예상</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Test</span></span><br><span class="line"><span class="keyword">void</span> B상품_조회() &#123;</span><br><span class="line">    <span class="comment">// given</span></span><br><span class="line">    <span class="comment">// B 상품 등록 - 1개 등록</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// when</span></span><br><span class="line">    <span class="comment">// 등록한 상품 조회</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// then</span></span><br><span class="line">    <span class="comment">// 등록 한 상품 count 비교</span></span><br><span class="line">    <span class="comment">// 1개라고 예상</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>한번 시나리오를 작성 해보겠습니다. @Transaction 이 있으면 ‘A상품_조회’ TEST 를 완료 하면 자동으로 롤백이 진행 되고 (상품 테이블 디비 등록 롤백) ‘B상품_조회’ TEST 를 진행 할것 입니다.<br>그러면 ‘B상품_조회’ TEST 를 진행 하면 상품 테이블에 한개 상품이 등록되면서 총 1개 상품이 등록되어져 있습니다. (‘B상품_조회’ TEST 가 끝나면 롤백 진행) </p>
<p>하지만 TEST 코드에서 @Transaction 추가시 고려해야 할 상황들이 있는데요. 앞써 이야기한 TDD 방식 그러니깐 TEST 코드를 먼저 작성 하고 기능을 구현 하는 과정에서<br>실수 할 수 있는 부분이 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@<span class="title class_">DataJpaTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProductRepositoryTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Test</span></span><br><span class="line">    <span class="keyword">void</span> A상품_조회() &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="comment">// A 상품 등록 - 1개 등록</span></span><br><span class="line">        <span class="comment">// 등록된 A 상품 재고 수량 5로 변경 (JPA 변경 감지 기능 통해 디비 업데이트 진행)    </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="comment">// 등록한 상품 조회</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        <span class="comment">// 등록 한 상품 재고 수량 비교</span></span><br><span class="line">        <span class="comment">// 재고 수량 5개라고 예상</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>상품 등록 후 재고 수량을 5개로 업데이트 하고 수량 비교 하는 TEST 코드 입니다. @Transaction 내에 실행 되는 코드이니 JPA 변경 감지 기능 통해 정상적으로 변경된 재고 수량으로<br>업데이트가 발생 할 것 입니다.</p>
<p>하지만 이렇게 의도한 대로 선 TEST 코드 작성 후 기능 구현 진행하는 과정에서 이렇게 정상적으로 TEST 진행되는 것을 착각 하고<br>재고 수량 변경 하는 기능 구현하는 단계에 정작 필요한 @Transaction 에노테이션을 추가 하지 않는 실수를 범하면 이야기가 달라집니다.</p>
<p>실제로 이대로 배포를 하고 사용자가 이 프로세스대로 진행시 분명 에러가 발생 할 것 입니다. 구현단에는 @Transaction 기능을 추가 하지 않는 상태이니<br>JPA 변경감지가 발동하지 않고 제품 수량이 업데이트가 되지 않는 문제가 발생 할 것 입니다.</p>
<p>이러한 실수를 방지 하기 위해 저같은 경우 @SpringBootTest 사용해서 실수를 사전에 방지 하도록 합니다.</p>
<h2 id="Business-Layer-테스트"><a href="#Business-Layer-테스트" class="headerlink" title="Business Layer 테스트"></a>Business Layer 테스트</h2><p><img src="/../../../../img/JAVA/TEST/PaymentTesting/BusinessLayerTest.png" alt="Business Layer Test"></p>
<p>Business Layer 테스트 알아보겠습니다. 말 그대로 비지니스 관련 로직 정상적으로 구현되고 있는지 체크 하는 역활 입니다.<br>이전에 알아보았던 Persistence Layer 테스트와 함께 상호 작용을 하면서 Business Layer 테스트 진행 하도록 합니다.</p>
<p>그리고 중요한 것이 트랜잭션이 정상적으로 보장이 되고 있는지 체크도 해야 합니다. 예외 Exception 이 정상적으로 발생되는 TEST 진행 하면서<br>정상적으로 롤백이 잘 진행 되었는지 체크도 해야 합니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title class_">ActiveProfiles</span>(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">@<span class="title class_">SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentConfirmApiServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">ProductRepository</span> productRepository;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">PaymentEventRepository</span> paymentEventRepository;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">PaymentOrderRepository</span> paymentOrderRepository;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">PaymentOrderHistoryRepository</span> paymentOrderHistoryRepository;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">PaymentCheckOutApiService</span> paymentCheckOutApiService;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">PaymentConfirmApiService</span> paymentConfirmApiService;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Autowired</span></span><br><span class="line">    private <span class="title class_">PaymentEventQueryService</span> paymentEventQueryService;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">MockBean</span></span><br><span class="line">    protected <span class="title class_">TossPaymentClient</span> tossPaymentClient;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">        paymentOrderHistoryRepository.<span class="title function_">deleteAllInBatch</span>();</span><br><span class="line">        paymentOrderRepository.<span class="title function_">deleteAllInBatch</span>();</span><br><span class="line">        productRepository.<span class="title function_">deleteAllInBatch</span>();</span><br><span class="line">        paymentEventRepository.<span class="title function_">deleteAllInBatch</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Test</span></span><br><span class="line">    @<span class="title class_">DisplayName</span>(<span class="string">&quot;상품 주문 하기 위한 Confirm 기능을 실행 합니다.&quot;</span>)</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paymentConfirm</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="title class_">Product</span> product1 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;AAA&quot;</span>, <span class="string">&quot;상품A&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">1000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product2 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;BBB&quot;</span>, <span class="string">&quot;상품B&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">2000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product3 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;CCC&quot;</span>, <span class="string">&quot;상품C&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">3000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Product</span>&gt; productList = productRepository.<span class="title function_">saveAll</span>(<span class="title class_">List</span>.<span class="title function_">of</span>(product1, product2, product3));</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">ProductOutPut</span>&gt; productOutPutList = <span class="title class_">ProductOutPut</span>.<span class="title function_">of</span>(productList);</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Long</span>&gt; productNoList = productOutPutList.<span class="title function_">stream</span>()</span><br><span class="line">                .<span class="title function_">map</span>(<span class="title class_">ProductOutPut</span>::getNo)</span><br><span class="line">                .<span class="title function_">toList</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">PaymentCheckOutRequest</span> paymentCheckOutRequest = <span class="title class_">PaymentCheckOutRequest</span>.<span class="title function_">of</span>(productNoList);</span><br><span class="line">        <span class="title class_">PaymentCheckOutResponse</span> paymentCheckOutResponse = paymentCheckOutApiService.<span class="title function_">paymentCheckOut</span>(paymentCheckOutRequest);</span><br><span class="line"></span><br><span class="line">        int intTotalAmount = <span class="number">6000</span>;</span><br><span class="line">        <span class="title class_">String</span> totalAmount = <span class="title class_">String</span>.<span class="title function_">valueOf</span>(intTotalAmount);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> paymentKey = <span class="variable language_">this</span>.<span class="title function_">paymentIdb64uuid</span>();</span><br><span class="line">        <span class="title class_">PaymentConfirmRequest</span> paymentConfirmRequest</span><br><span class="line">                = <span class="title class_">PaymentConfirmRequest</span>.<span class="title function_">of</span>(</span><br><span class="line">                    paymentKey,</span><br><span class="line">                    paymentCheckOutResponse.<span class="title function_">getOrderId</span>(),</span><br><span class="line">                    totalAmount</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// stubbing</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">createStubbingTossPostPayment</span>(paymentKey, paymentCheckOutResponse.<span class="title function_">getOrderId</span>(), totalAmount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        paymentConfirmApiService.<span class="title function_">paymentConfirm</span>(paymentConfirmRequest);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">PaymentEventOutPut</span>&gt; paymentEventOutPutList = paymentEventQueryService.<span class="title function_">selectPayments</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">assertThat</span>(paymentEventOutPutList).<span class="title function_">hasSize</span>(<span class="number">1</span>)</span><br><span class="line">                .<span class="title function_">extracting</span>(<span class="string">&quot;paymentKey&quot;</span>, <span class="string">&quot;orderId&quot;</span>, <span class="string">&quot;isPaymentDone&quot;</span>)</span><br><span class="line">                .<span class="title function_">usingRecursiveFieldByFieldElementComparator</span>(</span><br><span class="line">                        <span class="title class_">RecursiveComparisonConfiguration</span>.<span class="title function_">builder</span>()</span><br><span class="line">                                .<span class="title function_">withComparatorForType</span>(<span class="title class_">BigDecimal</span>::compareTo, <span class="title class_">BigDecimal</span>.<span class="property">class</span>).<span class="title function_">build</span>()</span><br><span class="line">                )</span><br><span class="line">                .<span class="title function_">containsExactlyInAnyOrder</span>(</span><br><span class="line">                        <span class="title function_">tuple</span>(paymentKey, paymentCheckOutResponse.<span class="title function_">getOrderId</span>(), <span class="literal">true</span>)</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">PaymentEventOutPut</span> paymentEventOutPut : paymentEventOutPutList) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="title class_">BigDecimal</span> responseTotalAmount = paymentEventOutPut.<span class="title function_">getTotalAmount</span>();</span><br><span class="line">            <span class="title function_">assertThat</span>(responseTotalAmount).<span class="title function_">isEqualByComparingTo</span>(<span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(intTotalAmount));</span><br><span class="line"></span><br><span class="line">            <span class="title class_">List</span>&lt;<span class="title class_">PaymentOrderOutPut</span>&gt; paymentOrderList = paymentEventOutPut.<span class="title function_">getPaymentOrderList</span>();</span><br><span class="line"></span><br><span class="line">            <span class="title function_">assertThat</span>(paymentOrderList).<span class="title function_">hasSize</span>(<span class="number">3</span>)</span><br><span class="line">                    .<span class="title function_">extracting</span>(<span class="string">&quot;productId&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;amount&quot;</span>, <span class="string">&quot;status&quot;</span>)</span><br><span class="line">                    .<span class="title function_">usingRecursiveFieldByFieldElementComparator</span>(</span><br><span class="line">                            <span class="title class_">RecursiveComparisonConfiguration</span>.<span class="title function_">builder</span>()</span><br><span class="line">                                    .<span class="title function_">withComparatorForType</span>(<span class="title class_">BigDecimal</span>::compareTo, <span class="title class_">BigDecimal</span>.<span class="property">class</span>).<span class="title function_">build</span>()</span><br><span class="line">                    )</span><br><span class="line">                    .<span class="title function_">containsExactlyInAnyOrder</span>(</span><br><span class="line">                            <span class="title function_">tuple</span>(<span class="string">&quot;AAA&quot;</span>, <span class="string">&quot;상품A&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">1000</span>), <span class="title class_">PaymentOrderStatus</span>.<span class="property">SUCCESS</span>),</span><br><span class="line">                            <span class="title function_">tuple</span>(<span class="string">&quot;BBB&quot;</span>, <span class="string">&quot;상품B&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">2000</span>), <span class="title class_">PaymentOrderStatus</span>.<span class="property">SUCCESS</span>),</span><br><span class="line">                            <span class="title function_">tuple</span>(<span class="string">&quot;CCC&quot;</span>, <span class="string">&quot;상품C&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">3000</span>), <span class="title class_">PaymentOrderStatus</span>.<span class="property">SUCCESS</span>)</span><br><span class="line">                    );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Test</span></span><br><span class="line">    @<span class="title class_">DisplayName</span>(<span class="string">&quot;상품 주문 하기 위한 Confirm 기능을 실행시 경우 예외가 발생 합니다. - 재시도가 가능하지 않는 결제 에러&quot;</span>)</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paymentConfirmThenThrow</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="title class_">Product</span> product1 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;AAA&quot;</span>, <span class="string">&quot;상품A&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">1000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product2 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;BBB&quot;</span>, <span class="string">&quot;상품B&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">2000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product3 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;CCC&quot;</span>, <span class="string">&quot;상품C&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">3000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Product</span>&gt; productList = productRepository.<span class="title function_">saveAll</span>(<span class="title class_">List</span>.<span class="title function_">of</span>(product1, product2, product3));</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">ProductOutPut</span>&gt; productOutPutList = <span class="title class_">ProductOutPut</span>.<span class="title function_">of</span>(productList);</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Long</span>&gt; productNoList = productOutPutList.<span class="title function_">stream</span>()</span><br><span class="line">                .<span class="title function_">map</span>(<span class="title class_">ProductOutPut</span>::getNo)</span><br><span class="line">                .<span class="title function_">toList</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">PaymentCheckOutRequest</span> paymentCheckOutRequest = <span class="title class_">PaymentCheckOutRequest</span>.<span class="title function_">of</span>(productNoList);</span><br><span class="line">        <span class="title class_">PaymentCheckOutResponse</span> paymentCheckOutResponse = paymentCheckOutApiService.<span class="title function_">paymentCheckOut</span>(paymentCheckOutRequest);</span><br><span class="line"></span><br><span class="line">        int intTotalAmount = <span class="number">6000</span>;</span><br><span class="line">        <span class="title class_">String</span> totalAmount = <span class="title class_">String</span>.<span class="title function_">valueOf</span>(intTotalAmount);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> paymentKey = <span class="variable language_">this</span>.<span class="title function_">paymentIdb64uuid</span>();</span><br><span class="line">        <span class="title class_">PaymentConfirmRequest</span> paymentConfirmRequest</span><br><span class="line">                = <span class="title class_">PaymentConfirmRequest</span>.<span class="title function_">of</span>(</span><br><span class="line">                paymentKey,</span><br><span class="line">                paymentCheckOutResponse.<span class="title function_">getOrderId</span>(),</span><br><span class="line">                totalAmount</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// stubbing</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">createStubbingTossPostPaymentThenThrow</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        paymentConfirmApiService.<span class="title function_">paymentConfirm</span>(paymentConfirmRequest);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">PaymentEventOutPut</span>&gt; paymentEventOutPutList = paymentEventQueryService.<span class="title function_">selectPayments</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">assertThat</span>(paymentEventOutPutList).<span class="title function_">hasSize</span>(<span class="number">1</span>)</span><br><span class="line">                .<span class="title function_">extracting</span>(<span class="string">&quot;paymentKey&quot;</span>, <span class="string">&quot;orderId&quot;</span>, <span class="string">&quot;isPaymentDone&quot;</span>)</span><br><span class="line">                .<span class="title function_">usingRecursiveFieldByFieldElementComparator</span>(</span><br><span class="line">                        <span class="title class_">RecursiveComparisonConfiguration</span>.<span class="title function_">builder</span>()</span><br><span class="line">                                .<span class="title function_">withComparatorForType</span>(<span class="title class_">BigDecimal</span>::compareTo, <span class="title class_">BigDecimal</span>.<span class="property">class</span>).<span class="title function_">build</span>()</span><br><span class="line">                )</span><br><span class="line">                .<span class="title function_">containsExactlyInAnyOrder</span>(</span><br><span class="line">                        <span class="title function_">tuple</span>(paymentKey, paymentCheckOutResponse.<span class="title function_">getOrderId</span>(), <span class="literal">false</span>)</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">PaymentEventOutPut</span> paymentEventOutPut : paymentEventOutPutList) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="title class_">BigDecimal</span> responseTotalAmount = paymentEventOutPut.<span class="title function_">getTotalAmount</span>();</span><br><span class="line">            <span class="title function_">assertThat</span>(responseTotalAmount).<span class="title function_">isEqualByComparingTo</span>(<span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(intTotalAmount));</span><br><span class="line"></span><br><span class="line">            <span class="title class_">List</span>&lt;<span class="title class_">PaymentOrderOutPut</span>&gt; paymentOrderList = paymentEventOutPut.<span class="title function_">getPaymentOrderList</span>();</span><br><span class="line"></span><br><span class="line">            <span class="title function_">assertThat</span>(paymentOrderList).<span class="title function_">hasSize</span>(<span class="number">3</span>)</span><br><span class="line">                    .<span class="title function_">extracting</span>(<span class="string">&quot;productId&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;amount&quot;</span>, <span class="string">&quot;status&quot;</span>)</span><br><span class="line">                    .<span class="title function_">usingRecursiveFieldByFieldElementComparator</span>(</span><br><span class="line">                            <span class="title class_">RecursiveComparisonConfiguration</span>.<span class="title function_">builder</span>()</span><br><span class="line">                                    .<span class="title function_">withComparatorForType</span>(<span class="title class_">BigDecimal</span>::compareTo, <span class="title class_">BigDecimal</span>.<span class="property">class</span>).<span class="title function_">build</span>()</span><br><span class="line">                    )</span><br><span class="line">                    .<span class="title function_">containsExactlyInAnyOrder</span>(</span><br><span class="line">                            <span class="title function_">tuple</span>(<span class="string">&quot;AAA&quot;</span>, <span class="string">&quot;상품A&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">1000</span>), <span class="title class_">PaymentOrderStatus</span>.<span class="property">FAILURE</span>),</span><br><span class="line">                            <span class="title function_">tuple</span>(<span class="string">&quot;BBB&quot;</span>, <span class="string">&quot;상품B&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">2000</span>), <span class="title class_">PaymentOrderStatus</span>.<span class="property">FAILURE</span>),</span><br><span class="line">                            <span class="title function_">tuple</span>(<span class="string">&quot;CCC&quot;</span>, <span class="string">&quot;상품C&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">3000</span>), <span class="title class_">PaymentOrderStatus</span>.<span class="property">FAILURE</span>)</span><br><span class="line">                    );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Test</span></span><br><span class="line">    @<span class="title class_">DisplayName</span>(<span class="string">&quot;상품 주문 하기 위한 Confirm 기능을 실행시 경우 예외가 발생 합니다. - 이미 완료된 결제건&quot;</span>)</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">paymentConfirmAlreadyCompletedPaymentThenThrow</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="title class_">Product</span> product1 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;AAA&quot;</span>, <span class="string">&quot;상품A&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">1000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product2 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;BBB&quot;</span>, <span class="string">&quot;상품B&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">2000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product3 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;CCC&quot;</span>, <span class="string">&quot;상품C&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">3000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Product</span>&gt; productList = productRepository.<span class="title function_">saveAll</span>(<span class="title class_">List</span>.<span class="title function_">of</span>(product1, product2, product3));</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">ProductOutPut</span>&gt; productOutPutList = <span class="title class_">ProductOutPut</span>.<span class="title function_">of</span>(productList);</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Long</span>&gt; productNoList = productOutPutList.<span class="title function_">stream</span>()</span><br><span class="line">                .<span class="title function_">map</span>(<span class="title class_">ProductOutPut</span>::getNo)</span><br><span class="line">                .<span class="title function_">toList</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">PaymentCheckOutRequest</span> paymentCheckOutRequest = <span class="title class_">PaymentCheckOutRequest</span>.<span class="title function_">of</span>(productNoList);</span><br><span class="line">        <span class="title class_">PaymentCheckOutResponse</span> paymentCheckOutResponse = paymentCheckOutApiService.<span class="title function_">paymentCheckOut</span>(paymentCheckOutRequest);</span><br><span class="line"></span><br><span class="line">        int intTotalAmount = <span class="number">6000</span>;</span><br><span class="line">        <span class="title class_">String</span> totalAmount = <span class="title class_">String</span>.<span class="title function_">valueOf</span>(intTotalAmount);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> paymentKey = <span class="variable language_">this</span>.<span class="title function_">paymentIdb64uuid</span>();</span><br><span class="line">        <span class="title class_">PaymentConfirmRequest</span> paymentConfirmRequest</span><br><span class="line">                = <span class="title class_">PaymentConfirmRequest</span>.<span class="title function_">of</span>(</span><br><span class="line">                paymentKey,</span><br><span class="line">                paymentCheckOutResponse.<span class="title function_">getOrderId</span>(),</span><br><span class="line">                totalAmount</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// stubbing</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">createStubbingAlreadyCompletedTossPostPaymentThenThrow</span>(paymentKey, paymentCheckOutResponse.<span class="title function_">getOrderId</span>(), totalAmount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        paymentConfirmApiService.<span class="title function_">paymentConfirm</span>(paymentConfirmRequest);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">PaymentEventOutPut</span>&gt; paymentEventOutPutList = paymentEventQueryService.<span class="title function_">selectPayments</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_">assertThat</span>(paymentEventOutPutList).<span class="title function_">hasSize</span>(<span class="number">1</span>)</span><br><span class="line">                .<span class="title function_">extracting</span>(<span class="string">&quot;paymentKey&quot;</span>, <span class="string">&quot;orderId&quot;</span>, <span class="string">&quot;isPaymentDone&quot;</span>)</span><br><span class="line">                .<span class="title function_">usingRecursiveFieldByFieldElementComparator</span>(</span><br><span class="line">                        <span class="title class_">RecursiveComparisonConfiguration</span>.<span class="title function_">builder</span>()</span><br><span class="line">                                .<span class="title function_">withComparatorForType</span>(<span class="title class_">BigDecimal</span>::compareTo, <span class="title class_">BigDecimal</span>.<span class="property">class</span>).<span class="title function_">build</span>()</span><br><span class="line">                )</span><br><span class="line">                .<span class="title function_">containsExactlyInAnyOrder</span>(</span><br><span class="line">                        <span class="title function_">tuple</span>(paymentKey, paymentCheckOutResponse.<span class="title function_">getOrderId</span>(), <span class="literal">true</span>)</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">PaymentEventOutPut</span> paymentEventOutPut : paymentEventOutPutList) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="title class_">BigDecimal</span> responseTotalAmount = paymentEventOutPut.<span class="title function_">getTotalAmount</span>();</span><br><span class="line">            <span class="title function_">assertThat</span>(responseTotalAmount).<span class="title function_">isEqualByComparingTo</span>(<span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(intTotalAmount));</span><br><span class="line"></span><br><span class="line">            <span class="title class_">List</span>&lt;<span class="title class_">PaymentOrderOutPut</span>&gt; paymentOrderList = paymentEventOutPut.<span class="title function_">getPaymentOrderList</span>();</span><br><span class="line"></span><br><span class="line">            <span class="title function_">assertThat</span>(paymentOrderList).<span class="title function_">hasSize</span>(<span class="number">3</span>)</span><br><span class="line">                    .<span class="title function_">extracting</span>(<span class="string">&quot;productId&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;amount&quot;</span>, <span class="string">&quot;status&quot;</span>)</span><br><span class="line">                    .<span class="title function_">usingRecursiveFieldByFieldElementComparator</span>(</span><br><span class="line">                            <span class="title class_">RecursiveComparisonConfiguration</span>.<span class="title function_">builder</span>()</span><br><span class="line">                                    .<span class="title function_">withComparatorForType</span>(<span class="title class_">BigDecimal</span>::compareTo, <span class="title class_">BigDecimal</span>.<span class="property">class</span>).<span class="title function_">build</span>()</span><br><span class="line">                    )</span><br><span class="line">                    .<span class="title function_">containsExactlyInAnyOrder</span>(</span><br><span class="line">                            <span class="title function_">tuple</span>(<span class="string">&quot;AAA&quot;</span>, <span class="string">&quot;상품A&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">1000</span>), <span class="title class_">PaymentOrderStatus</span>.<span class="property">SUCCESS</span>),</span><br><span class="line">                            <span class="title function_">tuple</span>(<span class="string">&quot;BBB&quot;</span>, <span class="string">&quot;상품B&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">2000</span>), <span class="title class_">PaymentOrderStatus</span>.<span class="property">SUCCESS</span>),</span><br><span class="line">                            <span class="title function_">tuple</span>(<span class="string">&quot;CCC&quot;</span>, <span class="string">&quot;상품C&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">3000</span>), <span class="title class_">PaymentOrderStatus</span>.<span class="property">SUCCESS</span>)</span><br><span class="line">                    );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Test</span></span><br><span class="line">    @<span class="title class_">DisplayName</span>(<span class="string">&quot;결제 금액이 유효하지 않을 경우 예외가 발생 합니다.&quot;</span>)</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">invalidPaymentAmountThenThrow</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="title class_">Product</span> product1 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;AAA&quot;</span>, <span class="string">&quot;상품A&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">1000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product2 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;BBB&quot;</span>, <span class="string">&quot;상품B&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">2000</span>));</span><br><span class="line">        <span class="title class_">Product</span> product3 = <span class="variable language_">this</span>.<span class="title function_">createProduct</span>(<span class="string">&quot;CCC&quot;</span>, <span class="string">&quot;상품C&quot;</span>, <span class="title class_">BigDecimal</span>.<span class="title function_">valueOf</span>(<span class="number">3000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Product</span>&gt; productList = productRepository.<span class="title function_">saveAll</span>(<span class="title class_">List</span>.<span class="title function_">of</span>(product1, product2, product3));</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">ProductOutPut</span>&gt; productOutPutList = <span class="title class_">ProductOutPut</span>.<span class="title function_">of</span>(productList);</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">Long</span>&gt; productNoList = productOutPutList.<span class="title function_">stream</span>()</span><br><span class="line">                .<span class="title function_">map</span>(<span class="title class_">ProductOutPut</span>::getNo)</span><br><span class="line">                .<span class="title function_">toList</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">PaymentCheckOutRequest</span> paymentCheckOutRequest = <span class="title class_">PaymentCheckOutRequest</span>.<span class="title function_">of</span>(productNoList);</span><br><span class="line">        <span class="title class_">PaymentCheckOutResponse</span> paymentCheckOutResponse = paymentCheckOutApiService.<span class="title function_">paymentCheckOut</span>(paymentCheckOutRequest);</span><br><span class="line"></span><br><span class="line">        int intTotalAmount = <span class="number">5000</span>;</span><br><span class="line">        <span class="title class_">String</span> totalAmount = <span class="title class_">String</span>.<span class="title function_">valueOf</span>(intTotalAmount);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> paymentKey = <span class="variable language_">this</span>.<span class="title function_">paymentIdb64uuid</span>();</span><br><span class="line">        <span class="title class_">PaymentConfirmRequest</span> paymentConfirmRequest</span><br><span class="line">                = <span class="title class_">PaymentConfirmRequest</span>.<span class="title function_">of</span>(</span><br><span class="line">                paymentKey,</span><br><span class="line">                paymentCheckOutResponse.<span class="title function_">getOrderId</span>(),</span><br><span class="line">                totalAmount</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when // then</span></span><br><span class="line">        <span class="title function_">assertThatThrownBy</span>(() -&gt; paymentConfirmApiService.<span class="title function_">paymentConfirm</span>(paymentConfirmRequest))</span><br><span class="line">                .<span class="title function_">isInstanceOf</span>(<span class="title class_">BusinessException</span>.<span class="property">class</span>)</span><br><span class="line">                .<span class="title function_">hasMessage</span>(<span class="string">&quot;결제 금액이 유효하지 않습니다.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> <span class="title function_">createStubbingTossPostPayment</span>(<span class="params"><span class="built_in">String</span> paymentKey, <span class="built_in">String</span> orderId, <span class="built_in">String</span> amount</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> responsePostPaymentsBody = <span class="string">&quot;&#123;\&quot;mId\&quot;:\&quot;tvivarepublica\&quot;,\&quot;lastTransactionKey\&quot;:\&quot;F69384D0887558A85A78199D534FBBD5\&quot;,\&quot;paymentKey\&quot;:\&quot;&quot;</span> + paymentKey + <span class="string">&quot;\&quot;,\&quot;orderId\&quot;:\&quot;&quot;</span> + orderId + <span class="string">&quot;\&quot;,\&quot;orderName\&quot;:\&quot;상품A 그외\&quot;,\&quot;taxExemptionAmount\&quot;:0,\&quot;status\&quot;:\&quot;DONE\&quot;,\&quot;requestedAt\&quot;:\&quot;2024-11-30T16:53:34+09:00\&quot;,\&quot;approvedAt\&quot;:\&quot;2024-11-30T16:53:57+09:00\&quot;,\&quot;useEscrow\&quot;:false,\&quot;cultureExpense\&quot;:false,\&quot;card\&quot;:&#123;\&quot;issuerCode\&quot;:\&quot;11\&quot;,\&quot;acquirerCode\&quot;:\&quot;11\&quot;,\&quot;number\&quot;:\&quot;52361232****606*\&quot;,\&quot;installmentPlanMonths\&quot;:0,\&quot;isInterestFree\&quot;:false,\&quot;interestPayer\&quot;:null,\&quot;approveNo\&quot;:\&quot;00000000\&quot;,\&quot;useCardPoint\&quot;:false,\&quot;cardType\&quot;:\&quot;신용\&quot;,\&quot;ownerType\&quot;:\&quot;개인\&quot;,\&quot;acquireStatus\&quot;:\&quot;READY\&quot;,\&quot;amount\&quot;:&quot;</span> + amount + <span class="string">&quot;&#125;,\&quot;virtualAccount\&quot;:null,\&quot;transfer\&quot;:null,\&quot;mobilePhone\&quot;:null,\&quot;giftCertificate\&quot;:null,\&quot;cashReceipt\&quot;:null,\&quot;cashReceipts\&quot;:null,\&quot;discount\&quot;:null,\&quot;cancels\&quot;:null,\&quot;secret\&quot;:\&quot;ps_GePWvyJnrKvelyyyB2pLVgLzN97E\&quot;,\&quot;type\&quot;:\&quot;NORMAL\&quot;,\&quot;easyPay\&quot;:null,\&quot;country\&quot;:\&quot;KR\&quot;,\&quot;failure\&quot;:null,\&quot;isPartialCancelable\&quot;:true,\&quot;receipt\&quot;:&#123;\&quot;url\&quot;:\&quot;https://dashboard.tosspayments.com/receipt/redirection?transactionId=tviva20241130165334qVdY4&amp;ref=PX\&quot;&#125;,\&quot;checkout\&quot;:&#123;\&quot;url\&quot;:\&quot;https://api.tosspayments.com/v1/payments/tviva20241130165334qVdY4/checkout\&quot;&#125;,\&quot;currency\&quot;:\&quot;KRW\&quot;,\&quot;totalAmount\&quot;:&quot;</span> + amount + <span class="string">&quot;,\&quot;balanceAmount\&quot;:6000,\&quot;suppliedAmount\&quot;:5455,\&quot;vat\&quot;:545,\&quot;taxFreeAmount\&quot;:0,\&quot;method\&quot;:\&quot;카드\&quot;,\&quot;version\&quot;:\&quot;2022-11-16\&quot;,\&quot;metadata\&quot;:null&#125;&quot;</span>;</span><br><span class="line">        <span class="title function_">when</span>(tossPaymentClient.<span class="title function_">paymentConfirm</span>(</span><br><span class="line">                <span class="title function_">any</span>(<span class="title class_">String</span>.<span class="property">class</span>), <span class="title function_">any</span>(<span class="title class_">PaymentConfirmInPut</span>.<span class="property">class</span>)</span><br><span class="line">        )).<span class="title function_">thenReturn</span>(<span class="title class_">ResponseEntity</span>.<span class="title function_">ok</span>(responsePostPaymentsBody));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> <span class="title function_">createStubbingTossPostPaymentThenThrow</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">PaymentException</span> paymentException = <span class="keyword">new</span> <span class="title class_">PaymentException</span>(</span><br><span class="line">                <span class="title class_">PSPErrorCode</span>.<span class="property">CLIENT_ERROR</span>,</span><br><span class="line">                <span class="string">&quot;INVALID_STOPPED_CARD&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;정지된 카드 입니다.&quot;</span>&#125;,</span><br><span class="line">                <span class="string">&quot;&#123; \&quot;code\&quot;: \&quot;INVALID_STOPPED_CARD\&quot;, \&quot;message\&quot;: \&quot;정지된 카드 입니다.\&quot; &#125;&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="title function_">when</span>(tossPaymentClient.<span class="title function_">paymentConfirm</span>(</span><br><span class="line">                <span class="title function_">any</span>(<span class="title class_">String</span>.<span class="property">class</span>), <span class="title function_">any</span>(<span class="title class_">PaymentConfirmInPut</span>.<span class="property">class</span>)</span><br><span class="line">        )).<span class="title function_">thenThrow</span>(paymentException);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> <span class="title function_">createStubbingAlreadyCompletedTossPostPaymentThenThrow</span>(<span class="params"><span class="built_in">String</span> paymentKey, <span class="built_in">String</span> orderId, <span class="built_in">String</span> amount</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">PaymentException</span> paymentException = <span class="keyword">new</span> <span class="title class_">PaymentException</span>(</span><br><span class="line">                <span class="title class_">PSPErrorCode</span>.<span class="property">CLIENT_ERROR</span>,</span><br><span class="line">                <span class="string">&quot;ALREADY_COMPLETED_PAYMENT&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;이미 완료된 결제 입니다.&quot;</span>&#125;,</span><br><span class="line">                <span class="string">&quot;&#123; \&quot;code\&quot;: \&quot;ALREADY_COMPLETED_PAYMENT\&quot;, \&quot;message\&quot;: \&quot;이미 완료된 결제 입니다.\&quot; &#125;&quot;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="title function_">when</span>(tossPaymentClient.<span class="title function_">paymentConfirm</span>(</span><br><span class="line">                <span class="title function_">any</span>(<span class="title class_">String</span>.<span class="property">class</span>), <span class="title function_">any</span>(<span class="title class_">PaymentConfirmInPut</span>.<span class="property">class</span>)</span><br><span class="line">        )).<span class="title function_">thenThrow</span>(paymentException);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> responsePostPaymentsBody = <span class="string">&quot;&#123;\&quot;mId\&quot;:\&quot;tvivarepublica\&quot;,\&quot;lastTransactionKey\&quot;:\&quot;F69384D0887558A85A78199D534FBBD5\&quot;,\&quot;paymentKey\&quot;:\&quot;&quot;</span> + paymentKey + <span class="string">&quot;\&quot;,\&quot;orderId\&quot;:\&quot;&quot;</span> + orderId + <span class="string">&quot;\&quot;,\&quot;orderName\&quot;:\&quot;상품A 그외\&quot;,\&quot;taxExemptionAmount\&quot;:0,\&quot;status\&quot;:\&quot;DONE\&quot;,\&quot;requestedAt\&quot;:\&quot;2024-11-30T16:53:34+09:00\&quot;,\&quot;approvedAt\&quot;:\&quot;2024-11-30T16:53:57+09:00\&quot;,\&quot;useEscrow\&quot;:false,\&quot;cultureExpense\&quot;:false,\&quot;card\&quot;:&#123;\&quot;issuerCode\&quot;:\&quot;11\&quot;,\&quot;acquirerCode\&quot;:\&quot;11\&quot;,\&quot;number\&quot;:\&quot;52361232****606*\&quot;,\&quot;installmentPlanMonths\&quot;:0,\&quot;isInterestFree\&quot;:false,\&quot;interestPayer\&quot;:null,\&quot;approveNo\&quot;:\&quot;00000000\&quot;,\&quot;useCardPoint\&quot;:false,\&quot;cardType\&quot;:\&quot;신용\&quot;,\&quot;ownerType\&quot;:\&quot;개인\&quot;,\&quot;acquireStatus\&quot;:\&quot;READY\&quot;,\&quot;amount\&quot;:&quot;</span> + amount + <span class="string">&quot;&#125;,\&quot;virtualAccount\&quot;:null,\&quot;transfer\&quot;:null,\&quot;mobilePhone\&quot;:null,\&quot;giftCertificate\&quot;:null,\&quot;cashReceipt\&quot;:null,\&quot;cashReceipts\&quot;:null,\&quot;discount\&quot;:null,\&quot;cancels\&quot;:null,\&quot;secret\&quot;:\&quot;ps_GePWvyJnrKvelyyyB2pLVgLzN97E\&quot;,\&quot;type\&quot;:\&quot;NORMAL\&quot;,\&quot;easyPay\&quot;:null,\&quot;country\&quot;:\&quot;KR\&quot;,\&quot;failure\&quot;:null,\&quot;isPartialCancelable\&quot;:true,\&quot;receipt\&quot;:&#123;\&quot;url\&quot;:\&quot;https://dashboard.tosspayments.com/receipt/redirection?transactionId=tviva20241130165334qVdY4&amp;ref=PX\&quot;&#125;,\&quot;checkout\&quot;:&#123;\&quot;url\&quot;:\&quot;https://api.tosspayments.com/v1/payments/tviva20241130165334qVdY4/checkout\&quot;&#125;,\&quot;currency\&quot;:\&quot;KRW\&quot;,\&quot;totalAmount\&quot;:&quot;</span> + amount + <span class="string">&quot;,\&quot;balanceAmount\&quot;:6000,\&quot;suppliedAmount\&quot;:5455,\&quot;vat\&quot;:545,\&quot;taxFreeAmount\&quot;:0,\&quot;method\&quot;:\&quot;카드\&quot;,\&quot;version\&quot;:\&quot;2022-11-16\&quot;,\&quot;metadata\&quot;:null&#125;&quot;</span>;</span><br><span class="line">        <span class="title function_">when</span>(tossPaymentClient.<span class="title function_">getPayments</span>(</span><br><span class="line">                <span class="title function_">any</span>(<span class="title class_">String</span>.<span class="property">class</span>)</span><br><span class="line">        )).<span class="title function_">thenReturn</span>(<span class="title class_">ResponseEntity</span>.<span class="title function_">ok</span>(responsePostPaymentsBody));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title class_">Product</span> <span class="title function_">createProduct</span>(<span class="params"><span class="built_in">String</span> productId, <span class="built_in">String</span> name, BigDecimal price</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Product</span>.<span class="title function_">of</span>(productId, name, price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="title class_">String</span> <span class="title function_">paymentIdb64uuid</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">SecureRandom</span> secureRandom = <span class="keyword">new</span> <span class="title class_">SecureRandom</span>();</span><br><span class="line">        byte[] randomBytes = <span class="keyword">new</span> byte[<span class="number">25</span>];</span><br><span class="line">        secureRandom.<span class="title function_">nextBytes</span>(randomBytes);</span><br><span class="line">        <span class="title class_">String</span> identifier = <span class="title class_">Base64</span>.<span class="title function_">getUrlEncoder</span>().<span class="title function_">withoutPadding</span>().<span class="title function_">encodeToString</span>(randomBytes);</span><br><span class="line">        <span class="keyword">return</span> identifier.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Business Layer 테스트에서는 총 4가지 TEST 를 진행 할려고 합니다.</p>
<ol>
<li>상품 주문 하기 위한 Confirm 기능을 실행 합니다.</li>
<li>상품 주문 하기 위한 Confirm 기능을 실행시 경우 예외가 발생 합니다. - 재시도가 가능하지 않는 결제 에러</li>
<li>상품 주문 하기 위한 Confirm 기능을 실행시 경우 예외가 발생 합니다. - 이미 완료된 결제건</li>
<li>결제 금액이 유효하지 않을 경우 예외가 발생 합니다.</li>
</ol>
<p>앞써 최종 결제 승인이 완료 될려면 이전에 checkout 기능 통해 구매 이벤트를 발생 하도록 하고 마지막으로 confirm 기능으로 최종 결제 승인이 발생 하도록 합니다.</p>
<p><img src="/../../../../img/JAVA/Payment/Idempotency.png" alt="멱등성1.png"><br><img src="/../../../../img/JAVA/Payment/Idempotency2.png" alt="멱등성2.png"></p>
<p>결제 시도하는 과정에서 토스 PSP 사 잠시동안 서버 불안정으로 결제 승인 실패 하는 경우 retry 기능을 통해 다시 결제 승인 시도를 하지만 재시도가 불가능한 결제 에러 발생 한 경우는<br>이에 맞는 적절한 예외가 발생되는지 TEST 도 추가 해보았습니다.</p>
<p>마지막으로 이미 결제건에 대해 다시 시도 할 경우에도 적절 하게 예외 처리 하였는지도 체크 합니다.</p>

      
       <hr><span style="font-style: italic;color: gray;"> Copyright 201- syh8088. 무단 전재 및 재배포 금지. 출처 표기 시 인용 가능. </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">💰</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2017 Seo Yang Hun
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="Toggle full screen shortcut key s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>Help us with donation</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
