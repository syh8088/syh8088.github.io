<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AWS EKS 서버 배포 - CI/CD | Seo Yang Hun Blog</title>
  <meta name="keywords" content="">
  <meta name="description" content="AWS EKS 서버 배포 - CI/CD | Seo Yang Hun Blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="AWS EKS 서버 배포 - CI&#x2F;CD쿠버네티스 (k8s) Kubernetes (k8s) 는 컨테이너화된 애플리케이션을 대규모로 운영하기 위한 오케스트레이션 입니다. 즉 배포, 확장, 관리를 자동화하는 오픈소스 플랫폼 인데요. 주로 Docker와 같은 컨테이너 기술과 결합하여 컨테이너 관리 플랫폼으로 사용 하게 됩니다. Kubernetes 는 Cl">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS EKS 서버 배포 - CI&#x2F;CD">
<meta property="og:url" content="https://syh8088.github.io/2025/08/15/CI-CD/AWS_EKS_CICD/aws_eks_cicd/index.html">
<meta property="og:site_name" content="Seo Yang Hun Blog">
<meta property="og:description" content="AWS EKS 서버 배포 - CI&#x2F;CD쿠버네티스 (k8s) Kubernetes (k8s) 는 컨테이너화된 애플리케이션을 대규모로 운영하기 위한 오케스트레이션 입니다. 즉 배포, 확장, 관리를 자동화하는 오픈소스 플랫폼 인데요. 주로 Docker와 같은 컨테이너 기술과 결합하여 컨테이너 관리 플랫폼으로 사용 하게 됩니다. Kubernetes 는 Cl">
<meta property="og:locale">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/kubernetes_architecture.webp">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/namespace.webp">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/Pod.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/Service-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/Service-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/Replicaset.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/Deployment-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/Deployment-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/Deployment-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/Ingress-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/Ingress-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS-CI_CD-architecture.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-4.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-5.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_ACCESS_KEY_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_ACCESS_KEY_CREATE_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_ACCESS_KEY_CREATE_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_ACCESS_KEY_CREATE_1-4.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-3_IAM_ROLE_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-3_IAM_ROLE_CREATE_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-3_IAM_ROLE_CREATE_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-3_IAM_ROLE_CREATE_1-4.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-4.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-5.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-6.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-7.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-8.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-9.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-10.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-3_IAM_ROLE_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-3_IAM_ROLE_CREATE_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-3_IAM_ROLE_CREATE_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-4.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-5.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-6.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-7.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-8.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-9.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-10.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-11.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/AWS_CLI_LOCAL_SETTING_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-12.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/NAMESPACE_CREATE_DEV_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_CREATE_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_CREATE_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_RECODE_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GABIA_DOMAIN_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GABIA_DOMAIN_CREATE_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GABIA_DOMAIN_CREATE_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/ECR_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/AWS_ECR_DOCKER_BUILD_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/AWS_ECR_DOCKER_PUSH_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/AWS_ECR_DOCKER_PUSH_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/INGRESS_CONTROLLER_DEPLOY_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_RECODE_CREATE_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/KUBE_APPLY_ingress_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/NAMESPACE_CREATE_cert-manager_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/KUBE_APPLY_cert-manager-CRDs_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/KUBE_APPLY_cert-manager_deploy_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/KUBE_APPLY_https_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GITHUB_SECRET_SETTING_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GITHUB_SECRET_SETTING_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GITHUB_SECRET_SETTING_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GITHUB_SECRET_SETTING_1-4.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-4.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-5.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-6.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-7.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling-pod.webp">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling-pod2.webp">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-4.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-5.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-6.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-7.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-8.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-9.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/Autoscaling-EC2-architecture.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-1.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-2.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-4.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-3.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-5.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-6.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-7.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-8.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-9.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-10.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-11.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-12.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-13.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-14.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-15.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-16.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-17.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-18.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-19.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-20.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-21.png">
<meta property="og:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-22.png">
<meta property="article:published_time" content="2025-08-14T22:47:42.000Z">
<meta property="article:modified_time" content="2025-08-16T12:22:27.746Z">
<meta property="article:author" content="Seo Yang Hun">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://syh8088.github.io/img/CI-CD/AWS_EKS_CICD/flow/kubernetes_architecture.webp">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.2.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>Seo Yang Hun</span>
</div>

<div class="icon">
    
        
            <a title="rss"
               href="/atom.xml"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-rss"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="github"
               href="https://github.com/syh8088"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <a title="email"
               href="mailto:syh8088@gmail.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=872336115&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="모든 글">모든 글
            
                <small>(68)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="Authentication">
            <i class="fold iconfont icon-right"></i>
            Authentication
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Authentication&lt;---&gt;JWT">
            
            JWT
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="Authentication&lt;---&gt;Oauth">
            
            Oauth
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="AWS">
            <i class="fold iconfont icon-right"></i>
            AWS
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="AWS&lt;---&gt;Image Resizing">
            
            Image Resizing
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="CI-CD">
            <i class="fold iconfont icon-right"></i>
            CI-CD
            <small>(10)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;AWS">
            <i class="fold iconfont icon-right"></i>
            AWS
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;AWS&lt;---&gt;EKS">
            <i class="fold iconfont icon-right"></i>
            EKS
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;AWS&lt;---&gt;EKS&lt;---&gt;Kubernetes">
            <i class="fold iconfont icon-right"></i>
            Kubernetes
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;AWS&lt;---&gt;EKS&lt;---&gt;Kubernetes&lt;---&gt;Docker">
            
            Docker
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;GitHubActions">
            
            GitHubActions
            <small>(6)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="CI-CD&lt;---&gt;Jenkins">
            
            Jenkins
            <small>(3)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="DB">
            <i class="fold iconfont icon-right"></i>
            DB
            <small>(5)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="DB&lt;---&gt;Mysql">
            <i class="fold iconfont icon-right"></i>
            Mysql
            <small>(4)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="DB&lt;---&gt;Mysql&lt;---&gt;DBCP">
            
            DBCP
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="DB&lt;---&gt;Mysql&lt;---&gt;optimizing">
            
            optimizing
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="DB&lt;---&gt;Mysql&lt;---&gt;Paging">
            
            Paging
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="DB&lt;---&gt;MySql">
            <i class="fold iconfont icon-right"></i>
            MySql
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="DB&lt;---&gt;MySql&lt;---&gt;Collation">
            
            Collation
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="Elastic Search">
            
            Elastic Search
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="Flink">
            <i class="fold iconfont icon-right"></i>
            Flink
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Flink&lt;---&gt;Real Time">
            <i class="fold iconfont icon-right"></i>
            Real Time
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Flink&lt;---&gt;Real Time&lt;---&gt;Kafka">
            
            Kafka
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="J">
            <i class="fold iconfont icon-right"></i>
            J
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="J&lt;---&gt;Jenkins">
            
            Jenkins
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="JAVA">
            <i class="fold iconfont icon-right"></i>
            JAVA
            <small>(29)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;HTTP">
            <i class="fold iconfont icon-right"></i>
            HTTP
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;HTTP&lt;---&gt;FeignClient">
            
            FeignClient
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;JPA">
            
            JPA
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Object">
            
            Object
            <small>(2)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Payment">
            
            Payment
            <small>(5)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Security">
            
            Security
            <small>(4)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Spring">
            <i class="fold iconfont icon-right"></i>
            Spring
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Spring&lt;---&gt;Payment">
            <i class="fold iconfont icon-right"></i>
            Payment
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Spring&lt;---&gt;Payment&lt;---&gt;junit5">
            <i class="fold iconfont icon-right"></i>
            junit5
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Spring&lt;---&gt;Payment&lt;---&gt;junit5&lt;---&gt;Mockito">
            
            Mockito
            <small>(2)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;SpringBatch">
            
            SpringBatch
            <small>(5)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;SpringBootAndSecurityAndJWT">
            
            SpringBootAndSecurityAndJWT
            <small>(3)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;SpringCloudConfig">
            
            SpringCloudConfig
            <small>(4)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Transaction">
            
            Transaction
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="JAVA&lt;---&gt;Validator">
            
            Validator
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="JavaScript">
            <i class="fold iconfont icon-right"></i>
            JavaScript
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="JavaScript&lt;---&gt;Webpack">
            
            Webpack
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="Kafka">
            <i class="fold iconfont icon-right"></i>
            Kafka
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="Kafka&lt;---&gt;idempotent">
            
            idempotent
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="KUBERNETES">
            
            KUBERNETES
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="MSA">
            <i class="fold iconfont icon-right"></i>
            MSA
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment">
            <i class="fold iconfont icon-right"></i>
            Payment
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka">
            <i class="fold iconfont icon-right"></i>
            Kafka
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka&lt;---&gt;EDA">
            <i class="fold iconfont icon-right"></i>
            EDA
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka&lt;---&gt;EDA&lt;---&gt;CQRS">
            
            CQRS
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka&lt;---&gt;EDA&lt;---&gt;Saga">
            <i class="fold iconfont icon-right"></i>
            Saga
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="MSA&lt;---&gt;Payment&lt;---&gt;Kafka&lt;---&gt;EDA&lt;---&gt;Saga&lt;---&gt;Axon">
            
            Axon
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="Network">
            
            Network
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="NoSQL">
            <i class="fold iconfont icon-right"></i>
            NoSQL
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="NoSQL&lt;---&gt;Redis">
            <i class="fold iconfont icon-right"></i>
            Redis
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="NoSQL&lt;---&gt;Redis&lt;---&gt;RateLimiter">
            
            RateLimiter
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="R">
            
            R
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
                
    <li>
        <div data-rel="대용량 트래픽">
            <i class="fold iconfont icon-right"></i>
            대용량 트래픽
            <small>(3)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;EDA">
            <i class="fold iconfont icon-right"></i>
            EDA
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;EDA&lt;---&gt;Payment">
            <i class="fold iconfont icon-right"></i>
            Payment
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;EDA&lt;---&gt;Payment&lt;---&gt;Redis">
            <i class="fold iconfont icon-right"></i>
            Redis
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;EDA&lt;---&gt;Payment&lt;---&gt;Redis&lt;---&gt;Kafka">
            
            Kafka
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;Redis">
            <i class="fold iconfont icon-right"></i>
            Redis
            <small>(2)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;Redis&lt;---&gt;Kafka">
            
            Kafka
            <small>(1)</small>
        </div>
        
    </li>

                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;Redis&lt;---&gt;WebFlux">
            <i class="fold iconfont icon-right"></i>
            WebFlux
            <small>(1)</small>
        </div>
        
            <ul class="sub hide">
                
                    
    <li>
        <div data-rel="대용량 트래픽&lt;---&gt;Redis&lt;---&gt;WebFlux&lt;---&gt;접근자 대기열">
            
            접근자 대기열
            <small>(1)</small>
        </div>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

                
            </ul>
        
    </li>

            
        
    
        
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">about</a>
        
        <a style="width: 50%"
                
                                           class="friends">friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="68">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">모든 글</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="모든 글 CI-CD AWS EKS Kubernetes Docker "
           href="/2025/08/15/CI-CD/AWS_EKS_CICD/aws_eks_cicd/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AWS EKS 서버 배포 - CI/CD">AWS EKS 서버 배포 - CI/CD</span>
            <span class="post-date" title="2025-08-15 07:47:42">2025/08/15</span>
        </a>
        
        
        <a  class="모든 글 DB MySql Collation "
           href="/2025/07/23/DB/Mysql/Collation/Collation/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Mysql - Collation">Mysql - Collation</span>
            <span class="post-date" title="2025-07-23 07:47:42">2025/07/23</span>
        </a>
        
        
        <a  class="모든 글 Network "
           href="/2025/07/15/NETWORK/introduction/Network-Introduction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="네트워크 - 구조 및 공유기 원리">네트워크 - 구조 및 공유기 원리</span>
            <span class="post-date" title="2025-07-15 07:47:42">2025/07/15</span>
        </a>
        
        
        <a  class="모든 글 Kafka "
           href="/2025/07/06/KAFKA/introduction/kafka_introduction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="카프카 개념 및 실전">카프카 개념 및 실전</span>
            <span class="post-date" title="2025-07-06 07:47:42">2025/07/06</span>
        </a>
        
        
        <a  class="모든 글 "
           href="/2025/06/27/AWS/ImageResizing/imageTest/"
           data-tag=""
           data-author="" >
            <span class="post-title" title=""></span>
            <span class="post-date" title="2025-06-27 20:10:06">2025/06/27</span>
        </a>
        
        
        <a  class="모든 글 AWS Image Resizing "
           href="/2025/06/26/AWS/ImageResizing/aws-image-resizing/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AWS Image Resizing 구현하기">AWS Image Resizing 구현하기</span>
            <span class="post-date" title="2025-06-26 07:47:42">2025/06/26</span>
        </a>
        
        
        <a  class="모든 글 Elastic Search "
           href="/2025/06/16/ELASTIC_SEARCH/introduction/elasticsearch-introduction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Elastic Search 검색 활용기">Elastic Search 검색 활용기</span>
            <span class="post-date" title="2025-06-16 07:47:42">2025/06/16</span>
        </a>
        
        
        <a  class="모든 글 Flink Real Time Kafka "
           href="/2025/04/05/FLINK/introduction/Flink-Introduction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Flink 이용해서 실시간 데이터 스트림 처리 해보기">Flink 이용해서 실시간 데이터 스트림 처리 해보기</span>
            <span class="post-date" title="2025-04-05 07:47:42">2025/04/05</span>
        </a>
        
        
        <a  class="모든 글 Kafka idempotent "
           href="/2024/12/23/KAFKA/idempotent/Kafka_idempotent/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="카프카 멱등성 및 이벤트 일관성 보장하기">카프카 멱등성 및 이벤트 일관성 보장하기</span>
            <span class="post-date" title="2024-12-23 07:47:42">2024/12/23</span>
        </a>
        
        
        <a  class="모든 글 MSA Payment Kafka EDA CQRS "
           href="/2024/12/16/MSA/paymentMsa/MSA_Payment_Project_3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템으로 알아보는 MSA 3 - 쿼리 문제">결제 시스템으로 알아보는 MSA 3 - 쿼리 문제</span>
            <span class="post-date" title="2024-12-16 07:47:42">2024/12/16</span>
        </a>
        
        
        <a  class="모든 글 MSA Payment Kafka EDA Saga Axon "
           href="/2024/12/15/MSA/paymentMsa/MSA_Payment_Project_2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템으로 알아보는 MSA 2 - 분산 트랜잭션 구현">결제 시스템으로 알아보는 MSA 2 - 분산 트랜잭션 구현</span>
            <span class="post-date" title="2024-12-15 07:47:42">2024/12/15</span>
        </a>
        
        
        <a  class="모든 글 MSA Payment Kafka EDA "
           href="/2024/12/14/MSA/paymentMsa/MSA_Payment_Project_1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템으로 알아보는 MSA 1 - 기본 설명">결제 시스템으로 알아보는 MSA 1 - 기본 설명</span>
            <span class="post-date" title="2024-12-14 07:47:42">2024/12/14</span>
        </a>
        
        
        <a  class="모든 글 대용량 트래픽 EDA Payment Redis Kafka "
           href="/2024/12/13/HIGH_VOLUME_TRAFFIC/PaymentEDA/PaymentEDA/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템으로 알아보는 EDA 시스템">결제 시스템으로 알아보는 EDA 시스템</span>
            <span class="post-date" title="2024-12-13 07:47:42">2024/12/13</span>
        </a>
        
        
        <a  class="모든 글 DB Mysql optimizing "
           href="/2024/12/06/DB/Mysql/optimizing/IndexDiveOptimizaiton/IndexDiveOptimizaiton/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Index Dive 최적화">Index Dive 최적화</span>
            <span class="post-date" title="2024-12-06 07:47:42">2024/12/06</span>
        </a>
        
        
        <a  class="모든 글 JAVA Spring Payment junit5 Mockito "
           href="/2024/12/03/JAVA/TEST/PaymentTesting/PaymentTesting2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 Testing - 2">결제 Testing - 2</span>
            <span class="post-date" title="2024-12-03 15:50:00">2024/12/03</span>
        </a>
        
        
        <a  class="모든 글 JAVA Spring Payment junit5 Mockito "
           href="/2024/12/02/JAVA/TEST/PaymentTesting/PaymentTesting1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 Testing - 1">결제 Testing - 1</span>
            <span class="post-date" title="2024-12-02 15:50:00">2024/12/02</span>
        </a>
        
        
        <a  class="모든 글 대용량 트래픽 Redis WebFlux 접근자 대기열 "
           href="/2024/11/28/HIGH_VOLUME_TRAFFIC/AccessorQueuingSystem/AccessorQueuingSystem/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="대용량 트래픽 - 접근자 대기열 시스템 만들기">대용량 트래픽 - 접근자 대기열 시스템 만들기</span>
            <span class="post-date" title="2024-11-28 07:47:42">2024/11/28</span>
        </a>
        
        
        <a  class="모든 글 대용량 트래픽 Redis Kafka "
           href="/2024/11/22/HIGH_VOLUME_TRAFFIC/CreateCoupon/CreateCoupon/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="대용량 트래픽 - 선착순 쿠폰 등록 With Kafka, Redis">대용량 트래픽 - 선착순 쿠폰 등록 With Kafka, Redis</span>
            <span class="post-date" title="2024-11-22 07:47:42">2024/11/22</span>
        </a>
        
        
        <a  class="모든 글 NoSQL Redis RateLimiter "
           href="/2024/11/19/NoSQL/Redis/RateLimiter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Request Rate Limiter 구현하기">Request Rate Limiter 구현하기</span>
            <span class="post-date" title="2024-11-19 07:47:42">2024/11/19</span>
        </a>
        
        
        <a  class="모든 글 CI-CD GitHubActions "
           href="/2024/10/20/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 6">GitHubActions CICD With SpringBoot - 6</span>
            <span class="post-date" title="2024-10-20 07:47:42">2024/10/20</span>
        </a>
        
        
        <a  class="모든 글 CI-CD GitHubActions "
           href="/2024/10/19/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot5/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 5">GitHubActions CICD With SpringBoot - 5</span>
            <span class="post-date" title="2024-10-19 07:47:42">2024/10/19</span>
        </a>
        
        
        <a  class="모든 글 CI-CD GitHubActions "
           href="/2024/10/18/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot4/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 4">GitHubActions CICD With SpringBoot - 4</span>
            <span class="post-date" title="2024-10-18 07:47:42">2024/10/18</span>
        </a>
        
        
        <a  class="모든 글 CI-CD GitHubActions "
           href="/2024/10/17/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 3">GitHubActions CICD With SpringBoot - 3</span>
            <span class="post-date" title="2024-10-17 07:47:42">2024/10/17</span>
        </a>
        
        
        <a  class="모든 글 CI-CD GitHubActions "
           href="/2024/10/14/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 2">GitHubActions CICD With SpringBoot - 2</span>
            <span class="post-date" title="2024-10-14 07:47:42">2024/10/14</span>
        </a>
        
        
        <a  class="모든 글 CI-CD GitHubActions "
           href="/2024/10/14/CI-CD/GitHunActions/GitHubActionsCICDWithSpringBoot1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="GitHubActions CICD With SpringBoot - 1">GitHubActions CICD With SpringBoot - 1</span>
            <span class="post-date" title="2024-10-14 07:47:42">2024/10/14</span>
        </a>
        
        
        <a  class="모든 글 DB Mysql Paging "
           href="/2024/10/06/DB/Mysql/PagingQuery/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Paging Query 성능 개선 및 처리 방법 - 튜닝편">Paging Query 성능 개선 및 처리 방법 - 튜닝편</span>
            <span class="post-date" title="2024-10-06 07:47:42">2024/10/06</span>
        </a>
        
        
        <a  class="모든 글 DB Mysql DBCP "
           href="/2024/10/02/DB/Mysql/mysqlDBCP/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="DBCP 설정 방법">DBCP 설정 방법</span>
            <span class="post-date" title="2024-10-02 07:47:42">2024/10/02</span>
        </a>
        
        
        <a  class="모든 글 JAVA Object "
           href="/2024/08/24/JAVA/Object/InheritanceComposition2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="상속과 합성 이야기-2">상속과 합성 이야기-2</span>
            <span class="post-date" title="2024-08-24 15:50:00">2024/08/24</span>
        </a>
        
        
        <a  class="모든 글 JAVA Object "
           href="/2024/08/23/JAVA/Object/InheritanceComposition1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="상속과 합성 이야기-1">상속과 합성 이야기-1</span>
            <span class="post-date" title="2024-08-23 15:50:00">2024/08/23</span>
        </a>
        
        
        <a  class="모든 글 JAVA Payment "
           href="/2024/08/06/JAVA/Payment/PaymentTransactionalOutboxpattern/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 5">결제 시스템 구축 - 5</span>
            <span class="post-date" title="2024-08-06 15:50:00">2024/08/06</span>
        </a>
        
        
        <a  class="모든 글 JAVA Payment "
           href="/2024/08/05/JAVA/Payment/PaymentRetry/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 4">결제 시스템 구축 - 4</span>
            <span class="post-date" title="2024-08-05 15:50:00">2024/08/05</span>
        </a>
        
        
        <a  class="모든 글 JAVA Payment "
           href="/2024/07/28/JAVA/Payment/BuildingPaymentSystem/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 1">결제 시스템 구축 - 1</span>
            <span class="post-date" title="2024-07-28 15:50:00">2024/07/28</span>
        </a>
        
        
        <a  class="모든 글 JAVA Payment "
           href="/2024/07/28/JAVA/Payment/PaymentCheckOut/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 2">결제 시스템 구축 - 2</span>
            <span class="post-date" title="2024-07-28 15:50:00">2024/07/28</span>
        </a>
        
        
        <a  class="모든 글 JAVA Payment "
           href="/2024/07/28/JAVA/Payment/PaymentConfirm/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="결제 시스템 구축 - 3">결제 시스템 구축 - 3</span>
            <span class="post-date" title="2024-07-28 15:50:00">2024/07/28</span>
        </a>
        
        
        <a  class="모든 글 "
           href="/2024/05/31/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2024-05-31 22:32:19">2024/05/31</span>
        </a>
        
        
        <a  class="모든 글 "
           href="/2024/05/31/README/"
           data-tag=""
           data-author="" >
            <span class="post-title" title=""></span>
            <span class="post-date" title="2024-05-31 22:32:19">2024/05/31</span>
        </a>
        
        
        <a  class="모든 글 JAVA Security "
           href="/2024/05/30/JAVA/Security/AnonymousAuthenticationFilter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AnonymousAuthenticationFilter">AnonymousAuthenticationFilter</span>
            <span class="post-date" title="2024-05-30 10:04:43">2024/05/30</span>
        </a>
        
        
        <a  class="모든 글 "
           href="/2024/02/01/HIGH_VOLUME_TRAFFIC/AccessorQueuingSystem2/AccessorQueuingSystem/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="패스트캠퍼스 9개 프로젝트로 경험하는 대용량 트래픽 &amp; 데이터 처리 초격차 패키지 Online. 수강">패스트캠퍼스 9개 프로젝트로 경험하는 대용량 트래픽 &amp; 데이터 처리 초격차 패키지 Online. 수강</span>
            <span class="post-date" title="2024-02-01 00:00:00">2024/02/01</span>
        </a>
        
        
        <a  class="모든 글 Authentication JWT "
           href="/2021/11/27/AUTHTICATION/JWT/jwt/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="JWT (JSON Web Token) 이해하기">JWT (JSON Web Token) 이해하기</span>
            <span class="post-date" title="2021-11-27 07:47:42">2021/11/27</span>
        </a>
        
        
        <a  class="모든 글 Authentication Oauth "
           href="/2021/11/27/AUTHTICATION/OAUTH/oauth/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="OAUTH 2.0 이해하기">OAUTH 2.0 이해하기</span>
            <span class="post-date" title="2021-11-27 07:47:42">2021/11/27</span>
        </a>
        
        
        <a  class="모든 글 JAVA HTTP FeignClient "
           href="/2021/11/08/JAVA/HTTP/FeignClient/FeignClient/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="FeignClient 활용도">FeignClient 활용도</span>
            <span class="post-date" title="2021-11-08 10:04:43">2021/11/08</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringBatch "
           href="/2021/11/04/JAVA/Batch/SpringBatch5/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch - Chunk 5">Spring Batch - Chunk 5</span>
            <span class="post-date" title="2021-11-04 07:47:42">2021/11/04</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringBatch "
           href="/2021/10/30/JAVA/Batch/SpringBatch4/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch - Flow 4">Spring Batch - Flow 4</span>
            <span class="post-date" title="2021-10-30 07:47:42">2021/10/30</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringBatch "
           href="/2021/10/24/JAVA/Batch/SpringBatch3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch - 메타데이터 스키마 3">Spring Batch - 메타데이터 스키마 3</span>
            <span class="post-date" title="2021-10-24 07:47:42">2021/10/24</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringBatch "
           href="/2021/10/19/JAVA/Batch/SpringBatch2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch - Job, Step 2">Spring Batch - Job, Step 2</span>
            <span class="post-date" title="2021-10-19 07:47:42">2021/10/19</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringBatch "
           href="/2021/10/17/JAVA/Batch/SpringBatch1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Batch 1">Spring Batch 1</span>
            <span class="post-date" title="2021-10-17 07:47:42">2021/10/17</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringCloudConfig "
           href="/2021/09/13/JAVA/SpringCloudConfig/spring-cloud-config4/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="비대칭키를 이용한 application.yml 설정값 암호화">비대칭키를 이용한 application.yml 설정값 암호화</span>
            <span class="post-date" title="2021-09-13 07:47:45">2021/09/13</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringCloudConfig "
           href="/2021/09/13/JAVA/SpringCloudConfig/spring-cloud-config3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Cloud Bus">Spring Cloud Bus</span>
            <span class="post-date" title="2021-09-13 07:47:44">2021/09/13</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringCloudConfig "
           href="/2021/09/13/JAVA/SpringCloudConfig/spring-cloud-config2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Boot Actuator">Spring Boot Actuator</span>
            <span class="post-date" title="2021-09-13 07:47:43">2021/09/13</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringCloudConfig "
           href="/2021/09/13/JAVA/SpringCloudConfig/spring-cloud-config/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Cloud Config">Spring Cloud Config</span>
            <span class="post-date" title="2021-09-13 07:47:42">2021/09/13</span>
        </a>
        
        
        <a  class="모든 글 JAVA Transaction "
           href="/2021/03/14/JAVA/Transaction/multi-transaction/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java Multi-Transaction 관리">Java Multi-Transaction 관리</span>
            <span class="post-date" title="2021-03-14 07:47:42">2021/03/14</span>
        </a>
        
        
        <a  class="모든 글 JAVA Validator "
           href="/2020/12/18/JAVA/VALIDATOR/validator/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java Validator 관리">Java Validator 관리</span>
            <span class="post-date" title="2020-12-18 07:47:42">2020/12/18</span>
        </a>
        
        
        <a  class="모든 글 JAVA Security "
           href="/2020/11/19/JAVA/Security/SessionManagementFilterAndConcurrentSessionFilter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="SessionManagementFilterAndConcurrentSessionFilter">SessionManagementFilterAndConcurrentSessionFilter</span>
            <span class="post-date" title="2020-11-19 18:02:23">2020/11/19</span>
        </a>
        
        
        <a  class="모든 글 JAVA Security "
           href="/2020/11/14/JAVA/Security/RememberMeAuthenticationFilter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RememberMeAuthenticationFilter">RememberMeAuthenticationFilter</span>
            <span class="post-date" title="2020-11-14 07:40:06">2020/11/14</span>
        </a>
        
        
        <a  class="모든 글 JAVA Security "
           href="/2020/11/13/JAVA/Security/UsernamePasswordAuthenticationFilter/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="UsernamePasswordAuthenticationFilter">UsernamePasswordAuthenticationFilter</span>
            <span class="post-date" title="2020-11-13 08:51:13">2020/11/13</span>
        </a>
        
        
        <a  class="모든 글 CI-CD Jenkins "
           href="/2020/11/09/CI-CD/Jenkins/JenkinsGitLabConnect/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Jenkins_GitLab_연동">Jenkins_GitLab_연동</span>
            <span class="post-date" title="2020-11-09 07:47:42">2020/11/09</span>
        </a>
        
        
        <a  class="모든 글 CI-CD Jenkins "
           href="/2020/11/08/CI-CD/Jenkins/JenkinsGitLabSshConnect/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="젠킨스와 GitLab ssh 연동하기">젠킨스와 GitLab ssh 연동하기</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="모든 글 JAVA JPA "
           href="/2020/11/08/JAVA/JPA/eagerJpqlNplus1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="eagerJpqlNplus1">eagerJpqlNplus1</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringBootAndSecurityAndJWT "
           href="/2020/11/08/JAVA/SpringBootAndSecurityAndJWT/spring-boot-security-jwt-social/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Boot 를 이용해 JWT + Social 로그인 처리 - Authorization Server (일반 로그인)">Spring Boot 를 이용해 JWT + Social 로그인 처리 - Authorization Server (일반 로그인)</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringBootAndSecurityAndJWT "
           href="/2020/11/08/JAVA/SpringBootAndSecurityAndJWT/spring-boot-security-jwt-social2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Boot 를 이용해 JWT + Social 로그인 처리 - Authorization Server (Social 로그인)">Spring Boot 를 이용해 JWT + Social 로그인 처리 - Authorization Server (Social 로그인)</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="모든 글 JAVA SpringBootAndSecurityAndJWT "
           href="/2020/11/08/JAVA/SpringBootAndSecurityAndJWT/spring-boot-security-jwt-social3/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring Boot 를 이용해 JWT + Social 로그인 처리 - Resource Server">Spring Boot 를 이용해 JWT + Social 로그인 처리 - Resource Server</span>
            <span class="post-date" title="2020-11-08 07:47:42">2020/11/08</span>
        </a>
        
        
        <a  class="모든 글 J Jenkins "
           href="/2020/11/07/JAVA/Security/JKSGenerate/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="JKSGenerate">JKSGenerate</span>
            <span class="post-date" title="2020-11-07 13:46:21">2020/11/07</span>
        </a>
        
        
        <a  class="모든 글 CI-CD Jenkins "
           href="/2020/11/07/CI-CD/Jenkins/JenkinsInstall/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="쿠버네티스 환경 구성">쿠버네티스 환경 구성</span>
            <span class="post-date" title="2020-11-07 07:47:42">2020/11/07</span>
        </a>
        
        
        <a  class="모든 글 DB Mysql "
           href="/2020/11/07/DB/Mysql/mysqlReplicationSetting/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Mysql_Replication_설정">Mysql_Replication_설정</span>
            <span class="post-date" title="2020-11-07 07:47:42">2020/11/07</span>
        </a>
        
        
        <a  class="모든 글 KUBERNETES "
           href="/2020/11/07/KUBERNETES/%EC%89%BD%EA%B2%8C_%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94_%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4/%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4_%ED%99%98%EA%B2%BD_%EA%B5%AC%EC%84%B1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Jenkins_설치">Jenkins_설치</span>
            <span class="post-date" title="2020-11-07 07:47:42">2020/11/07</span>
        </a>
        
        
        <a  class="모든 글 R "
           href="/2020/10/17/R/RServerInstall/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RServer 설치">RServer 설치</span>
            <span class="post-date" title="2020-10-17 07:47:42">2020/10/17</span>
        </a>
        
        
        <a  class="모든 글 JavaScript Webpack "
           href="/2020/10/17/JAVASCRIPT/Webpack/devtool/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="WebPack - DevTool">WebPack - DevTool</span>
            <span class="post-date" title="2020-10-17 07:47:42">2020/10/17</span>
        </a>
        
        
        <a  class="모든 글 "
           href="/2018/12/02/%EB%A9%B4%EC%A0%91%EC%A4%80%EB%B9%84/test/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="그냥... 잡다한 지식 모음집">그냥... 잡다한 지식 모음집</span>
            <span class="post-date" title="2018-12-02 15:50:00">2018/12/02</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-CI-CD/AWS_EKS_CICD/aws_eks_cicd" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">AWS EKS 서버 배포 - CI/CD</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="CI-CD">CI-CD</a> > 
            
            <a  data-rel="CI-CD&lt;---&gt;AWS">AWS</a> > 
            
            <a  data-rel="CI-CD&lt;---&gt;AWS&lt;---&gt;EKS">EKS</a> > 
            
            <a  data-rel="CI-CD&lt;---&gt;AWS&lt;---&gt;EKS&lt;---&gt;Kubernetes">Kubernetes</a> > 
            
            <a  data-rel="CI-CD&lt;---&gt;AWS&lt;---&gt;EKS&lt;---&gt;Kubernetes&lt;---&gt;Docker">Docker</a>
            
        </span>
        
        
    </div>
    <div class="article-meta">
        
            작성일 : <time class="date" title='수정일: 2025-08-16 21:22:27'>2025-08-15 07:47</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            조회수 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AWS-EKS-%EC%84%9C%EB%B2%84-%EB%B0%B0%ED%8F%AC-CI-CD"><span class="toc-text">AWS EKS 서버 배포 - CI&#x2F;CD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-k8s"><span class="toc-text">쿠버네티스 (k8s)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Master-Node"><span class="toc-text">Master Node</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#API-%EC%84%9C%EB%B2%84-kube-apiserver"><span class="toc-text">API 서버 (kube-apiserver)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EC%8A%A4%EC%BC%80%EC%A4%84%EB%9F%AC-kube-scheduler"><span class="toc-text">스케줄러 (kube-scheduler)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC-%EB%A7%A4%EB%8B%88%EC%A0%80-kube-controller-manager"><span class="toc-text">컨트롤러 매니저 (kube-controller-manager)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#etcd"><span class="toc-text">etcd</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Worker-Node"><span class="toc-text">Worker Node</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#kubelet"><span class="toc-text">kubelet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kube-proxy"><span class="toc-text">kube-proxy</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes-%EA%B5%AC%EC%84%B1-%EC%9A%94%EC%86%8C"><span class="toc-text">Kubernetes 구성 요소</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#namespace-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4"><span class="toc-text">namespace (네임스페이스)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pod"><span class="toc-text">Pod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service"><span class="toc-text">Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Replicaset"><span class="toc-text">Replicaset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Deployment"><span class="toc-text">Deployment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ingress"><span class="toc-text">Ingress</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Ingress%EC%99%80-Ingress-Controller-%EC%B0%A8%EC%9D%B4%EC%A0%90%EC%9D%80"><span class="toc-text">Ingress와 Ingress Controller 차이점은?</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%8B%A4%EC%8A%B5-CI-CD-%EA%B5%AC%EC%B6%95-%ED%95%B4%EB%B3%B4%EA%B8%B0"><span class="toc-text">실습 CI&#x2F;CD 구축 해보기</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IAM-%EC%97%AD%ED%95%A0-%EC%83%9D%EC%84%B1-%ED%95%98%EA%B8%B0"><span class="toc-text">IAM 역할 생성 하기</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AWS-EKS-Cluster-%EC%83%9D%EC%84%B1-%ED%95%98%EA%B8%B0"><span class="toc-text">AWS EKS Cluster 생성 하기</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AWS-CLI-%EC%84%A4%EC%B9%98-%EB%B0%8F-kubectl-%EC%85%8B%ED%8C%85-%ED%95%98%EA%B8%B0"><span class="toc-text">AWS CLI 설치 및 kubectl 셋팅 하기</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kube-config-%EC%84%A4%EC%A0%95-%ED%95%98%EA%B8%B0"><span class="toc-text">kube config 설정 하기</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes-NameSpace-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0"><span class="toc-text">Kubernetes NameSpace 생성하기</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AWS-Route53-%EC%84%A4%EC%A0%95-%EB%B0%8F-LB%EB%A1%9C-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EB%8C%80%EC%83%81-%EC%84%A4%EC%A0%95-%ED%95%98%EA%B8%B0"><span class="toc-text">AWS Route53 설정 및 LB로 라우팅 대상 설정 하기</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EB%8F%84%EB%A9%94%EC%9D%B8-%EA%B5%AC%EC%9E%85%ED%95%98%EA%B8%B0"><span class="toc-text">도메인 구입하기</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-Image-%EC%83%9D%EC%84%B1-%EB%B0%8F-%EC%97%85%EB%A1%9C%EB%93%9C-%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95"><span class="toc-text">Docker Image 생성 및 업로드 하는 방법</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AWS-ECR-Repository-%EC%83%9D%EC%84%B1-%ED%95%98%EA%B8%B0"><span class="toc-text">AWS ECR Repository 생성 하기</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kubernetes-Deployment-%EB%B0%8F-Ingress-Apply-%ED%95%98%EA%B8%B0"><span class="toc-text">kubernetes Deployment 및 Ingress Apply 하기</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Deployment-Apply-%ED%95%98%EA%B8%B0"><span class="toc-text">Deployment Apply 하기</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ingress-Apply-%ED%95%98%EA%B8%B0"><span class="toc-text">Ingress Apply 하기</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTPS-%ED%86%B5%EC%8B%A0-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%9E%91%EC%97%85"><span class="toc-text">HTTPS 통신 인증서 작업</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89"><span class="toc-text">인증서 발급</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#https-yml-%EB%82%B4%EC%9A%A9-%EB%B3%B4%EA%B8%B0"><span class="toc-text">https.yml 내용 보기</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Github-Actions-%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-CI-CD-%EC%9E%90%EB%8F%99%ED%99%94-%EB%B0%B0%ED%8F%AC-%ED%95%98%EA%B8%B0"><span class="toc-text">Github Actions 을 이용해서 CI&#x2F;CD 자동화 배포 하기</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#github-secret-%EC%97%90-%EC%A4%91%EC%9A%94-%EC%A0%95%EB%B3%B4-%EC%B6%94%EA%B0%80-%EB%B0%A9%EB%B2%95"><span class="toc-text">github secret 에 중요 정보 추가 방법</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EC%8B%A4%EC%A0%9C%EB%A1%9C-CI-CD-%EB%B0%8F-%EB%A1%A4%EB%A7%81-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-%EC%A7%84%ED%96%89-%EB%90%98%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8-%ED%95%B4%EB%B3%B4%EA%B8%B0"><span class="toc-text">실제로 CI&#x2F;CD 및 롤링 업데이트 진행 되는지 확인 해보기</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Autoscaling-Pod-%EC%9E%90%EB%8F%99-%ED%99%95%EC%9E%A5-%EC%9E%91%EC%97%85"><span class="toc-text">Autoscaling - Pod 자동 확장 작업</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Autoscaling-Pod-%EC%9E%90%EB%8F%99-%ED%99%95%EC%9E%A5-%EC%9E%91%EC%97%85-Deployment-%EC%84%A4%EC%A0%95"><span class="toc-text">Autoscaling - Pod 자동 확장 작업 - Deployment 설정</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Autoscaling-Pod-%EC%9E%90%EB%8F%99-%ED%99%95%EC%9E%A5-%EC%9E%91%EC%97%85-%EB%A9%94%ED%8A%B8%EB%A6%AD-%EC%84%9C%EB%B2%84-%EC%84%A4%EC%B9%98"><span class="toc-text">Autoscaling - Pod 자동 확장 작업 - 메트릭 서버 설치</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Autoscaling-Pod-%EC%9E%90%EB%8F%99-%ED%99%95%EC%9E%A5-%EC%9E%91%EC%97%85-HPA-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%83%9D%EC%84%B1-%ED%9B%84-%EC%A0%81%EC%9A%A9"><span class="toc-text">Autoscaling - Pod 자동 확장 작업 - HPA 스크립트 생성 후 적용</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#hpa-yml-%ED%8C%8C%EC%9D%BC"><span class="toc-text">hpa.yml 파일</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EB%B6%80%ED%95%98-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%86%B5%ED%95%B4-Pod-Autoscaling-%EB%90%98%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8-%ED%95%B4%EB%B3%B4%EA%B8%B0"><span class="toc-text">부하 테스트 통해 Pod Autoscaling 되는지 확인 해보기</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Autoscaling-EC2-%EC%9E%90%EB%8F%99-%ED%99%95%EC%9E%A5-%EC%9E%91%EC%97%85"><span class="toc-text">Autoscaling - EC2 자동 확장 작업</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Autoscaling-EC2-%EC%9E%90%EB%8F%99-%ED%99%95%EC%9E%A5-NodeGroup-ASG-%EC%97%90-%ED%83%9C%EA%B7%B8-%EC%B6%94%EA%B0%80-%EC%9E%91%EC%97%85-%EC%A7%84%ED%96%89"><span class="toc-text">Autoscaling EC2 자동 확장 - NodeGroup(ASG)에 태그 추가 작업 진행</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Autoscaling-EC2-%EC%9E%90%EB%8F%99-%ED%99%95%EC%9E%A5-ID-%EC%A0%9C%EA%B3%B5%EC%97%85%EC%B2%B4-%EC%B6%94%EA%B0%80"><span class="toc-text">Autoscaling EC2 자동 확장 - ID 제공업체 추가</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Autoscaling-EC2-%EC%9E%90%EB%8F%99-%ED%99%95%EC%9E%A5-IAM-%EC%97%AD%ED%95%A0-%EC%83%9D%EC%84%B1"><span class="toc-text">Autoscaling EC2 자동 확장 - IAM 역할 생성</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EB%B6%80%ED%95%98%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%86%B5%ED%95%B4-%EC%8B%A4%EC%A0%9C%EB%A1%9C-Node-%EA%B0%80-%EC%9E%90%EB%8F%99-%EC%83%9D%EC%84%B1-%EB%90%98%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8-%ED%95%B4%EB%B3%B4%EA%B8%B0"><span class="toc-text">부하테스트 통해 실제로 Node 가 자동 생성 되는지 확인 해보기</span></a></li></ol></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="AWS-EKS-서버-배포-CI-CD"><a href="#AWS-EKS-서버-배포-CI-CD" class="headerlink" title="AWS EKS 서버 배포 - CI&#x2F;CD"></a>AWS EKS 서버 배포 - CI&#x2F;CD</h1><h2 id="쿠버네티스-k8s"><a href="#쿠버네티스-k8s" class="headerlink" title="쿠버네티스 (k8s)"></a>쿠버네티스 (k8s)</h2><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/kubernetes_architecture.webp" alt="쿠버네티스 아키텍처"></p>
<p><code>Kubernetes (k8s)</code> 는 컨테이너화된 애플리케이션을 대규모로 운영하기 위한 <code>오케스트레이션</code> 입니다. 즉 <code>배포</code>, <code>확장</code>, <code>관리</code>를 자동화하는 오픈소스 플랫폼 인데요. 주로 <code>Docker</code>와 같은 컨테이너 기술과 결합하여 컨테이너 관리 플랫폼으로 사용 하게 됩니다.</p>
<p><code>Kubernetes</code> 는 <code>Cluster</code> 로 구성 되어있는데 여러 대의 <code>머신(노드)</code> 을 묶어 컨테이너화된 애플리케이션을 배포하고 관리하는 시스템으로 되어 있습니다. 크게 <code>Mster Node</code>, <code>Worker Node</code> 로 구성 되어 있으며 하나씩 알아보도록 하겠습니다.</p>
<h3 id="Master-Node"><a href="#Master-Node" class="headerlink" title="Master Node"></a>Master Node</h3><p><code>Master Node</code> 는 <code>Cluster</code> 관리, <code>API 서버</code>, <code>스케줄링</code> 역할 등을 담당 하게 됩니다. 예를들어 <code>Master Node</code> 하고 <code>Worker Node</code> 는 물리적으로 분리 된 상태에서 특정 <code>Worker Node</code> 가 부하가 발생시 <code>Master Node</code> 는 이를 감지해서 <code>Worker Node</code> 에 <code>Pod</code> 를 증설 할지 아니면 물리적인 노드 <code>Worker Node</code> 를 증설할지 선택하게 됩니다.</p>
<p>그래서 <code>Master Node</code> 는 중앙 컨트롤 타워 역활 담당 그리고 <code>Worker Node</code> 는 실질적으로 작업을 수행하는 역활을 하게 됩니다. 이렇게 <code>Master Node</code> 하고 <code>Worker Node</code> 를 묶어서 <code>Cluster</code> 라고 부르게 됩니다.</p>
<p><code>Master Node</code> 에 특징적인 부분은 앞써 이야기 한대로 <code>Master Node</code> 가 <code>Worker Node</code> 를 계속 참조하고 있다가 부하가 발생하면 <code>Pod</code> 를 더 증설 할 수 있겠지만 직접 개발자가 판단해서 <code>Worker Node</code> 안에 있는 <code>Pod</code> 를 증설 할 수 있습니다. 이것을 <code>Kubectl</code> 명령을 통해 직접 개발자가 <code>Master Node</code> 에게 명령을 내리고 <code>Master Node</code> 는 <code>Worker Node</code> 에 명령을 내리게 됩니다. 즉 <code>kubectl</code> 역활을 개발자가 하고 <code>Kubernetes</code> 와 서로 소통을 하기 위한 프로그램 이라고 생각하면 쉽습니다. </p>
<h4 id="API-서버-kube-apiserver"><a href="#API-서버-kube-apiserver" class="headerlink" title="API 서버 (kube-apiserver)"></a>API 서버 (kube-apiserver)</h4><p><code>Master Node</code> 의 <code>API 서버 (kube-apiserver)</code> 는 클러스터의 중앙 집중식 관리 시스템 입니다. 개발자가 직접 외부 환경에서 <code>Kubernetes</code> 로 직접 통신 할 수 있는 진입점을 제공 합니다. 앞써 이야기 한대로 <code>Worker Node</code> 에 대한 <code>Pod</code> 정보 및 <code>Pod</code> 증설 등 개발자가 명령을 내리면 쿠버네티스 <code>API 서버(kube-apiserver)</code>로 전송 전송 하게 됩니다.</p>
<h4 id="스케줄러-kube-scheduler"><a href="#스케줄러-kube-scheduler" class="headerlink" title="스케줄러 (kube-scheduler)"></a>스케줄러 (kube-scheduler)</h4><p><code>Cluster</code> 내에서 실행될 파드를 적절한 노드에 할당하는 역할을 담당하게 됩니다. 예를들어 부하로 인해 <code>Pod</code>를 증설 해야 하는데 어떤 <code>Worker Node</code> 에 증설 해야할지를 판단 하게 됩니다. 그리고 새로 생성되거나 스케줄링되지 않은 파드를 감시하고 파드의 요구사항과 노드의 상태를 고려하여 최적의 노드를 선택 하게 됩니다.</p>
<h4 id="컨트롤러-매니저-kube-controller-manager"><a href="#컨트롤러-매니저-kube-controller-manager" class="headerlink" title="컨트롤러 매니저 (kube-controller-manager)"></a>컨트롤러 매니저 (kube-controller-manager)</h4><p><code>컨트롤러 매니저</code> 는 <code>Worker Node</code> 에 있는 <code>Pod</code> 를 계속 모니터링 역활을 하고 만약 특정 <code>Pod</code> 가 문제로 인해 죽으면 다시 <code>Pod</code> 를 살려내는 등 이러한 컨테이너 자원의 최적화 하는 역활을 하게 됩니다.</p>
<h4 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a>etcd</h4><p><code>etcd</code> 는 클러스터 상태 저장소 입니다. 즉 <code>Kubernetes</code> 실행 되기 위한 Config 관련 환경 정보 그리고 비밀값 등을 저장 하는 역활을 하게 되며  클러스터 상태값(<code>ConfigMap</code> 등)를 <code>key-value</code> 형태로 저장하는 저장소 입니다.</p>
<h3 id="Worker-Node"><a href="#Worker-Node" class="headerlink" title="Worker Node"></a>Worker Node</h3><p>실질적인 애플리케이션 실행을 담당하는 노드 입니다. 이번에 실습하게 될 AWS 기준으로 <code>EC2</code> 인스턴스로 실행하게 되고 이 <code>Worker Node</code> 에서 <code>Pod</code> 가 실행 하게 됩니다.</p>
<h4 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a>kubelet</h4><p><code>Master Node</code> 의 <code>API 서버 (kube-apiserver)</code> 와 통신하게 되며 각각의 <code>Pod</code> 들을 시작, 중지, 관리하는 작업을 수행하게 됩니다. <code>kubelet</code> 는 각 <code>Pod</code> 가 성공적으로 시작되었는지 체크하고 <code>Pod</code> 의 상태를 주기적으로 <code>API 서버 (kube-apiserver)</code> 로 보고 하게 됩니다.</p>
<h4 id="kube-proxy"><a href="#kube-proxy" class="headerlink" title="kube-proxy"></a>kube-proxy</h4><p><code>kube-proxy</code> 는 네트워크 프록시 및 로드 밸런서 역활을 하는 노드 수준의 구성 요소 입니다. 네트워크 트래픽을 적절히 포워딩 하도록 네트워크 규칙을 설정하여 각 파드 간의 통신이나 외부에서 파드로 접근 가능 하도록 합니다.</p>
<h2 id="Kubernetes-구성-요소"><a href="#Kubernetes-구성-요소" class="headerlink" title="Kubernetes 구성 요소"></a>Kubernetes 구성 요소</h2><h3 id="namespace-네임스페이스"><a href="#namespace-네임스페이스" class="headerlink" title="namespace (네임스페이스)"></a>namespace (네임스페이스)</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/namespace.webp" alt="namespace"></p>
<p><code>Kubernetes Cluster</code> 환경에서 논리적인 분리 하는 단위 입니다. 하나의 클러스터 내 여러 개의 작은 클러스터처럼 사용할 수 있게 해주는 기능인데, 각 네임스페이스는 독립적인 환경을 제공 해주며 예를들어 개발, 테스트, 상용 등 각각의 환경을 분리 할때 유용하게 사용됩니다. 즉 특정 서버를 물리적인 분리가 아닌 논리적으로 리소스를 그룹화 해서 마치 여러 개의 클러스터가 있는 것처럼 사용할 수 있게 합니다.</p>
<h3 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/Pod.png" alt="Pod"></p>
<p><code>Kubernetes</code> 에서 <code>Pod</code> 는 배포 가능한 가장 작은 컴퓨팅 단위 이며 하나 이상의 컨테이너의 그룹입니다. 또한 컨테이너들이 함께 실행될 수 있도록 리소스와 네트워크 네임스페이스를 공유합니다. 일반적으로는 1개의 컨테이너로 구성 되며 만약 한개의 <code>Pod</code> 가 두개의 독립적인 컨테이너가 존재하면 이것들을 하나의 네트워크로 묶는 역활을 하게 됩니다. 즉 만약 두개의 컨테이너가 같은 IP 를 사용하고 묶는 걸 <code>Pod</code> 이라고 합니다.</p>
<p>이렇게 그룹화 해서 묶어서 <code>Pod</code> 로 구성하는 이유는 2개의 컨테이너가 같은 IP 를 사용하면서 서로 다른 각각의 컨테이너 간의 긴밀한 통신 해야 하는 경우 그리고 통신을 원활하게 (속도 등) 해야 하는 경우 입니다.</p>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/Service-1.png" alt="Service-1"></p>
<p><code>Service</code> 는 <code>Kubernetes</code>의 자원의 종류의 이름입니다. 주요 역활은 <code>Pod</code> 들 앞단에 위치 하여 추상적인 네트워크 엔티티 역활을 하게 되는데요. 즉 <code>Cluster</code> 내에서 실행 중인 <code>Pod</code> 들에게 네트워크 접근 방법 (로드 밸런싱)을 제공 하고 있습니다. 그림을 보시면 만약 외부로 부터 <code>Pod</code> 을 접근 하고자 할때 그러니깐 두개의 각각 <code>Pod</code> 안에 설치되어 있는 컨테이너에 접근 하고자 할때 앞에 <code>Service</code> 가 각 <code>Pod</code> 에게 부하를 분산해주는 부하 분산기 역할을 해줍니다. </p>
<p>기본적으로 <code>Pod</code>는 외부 포트를 지정할 수 없는데 사용자는 특정 <code>Pod</code> 로 접근 해야 할때 어떨때는 1번 <code>Pod</code> 로 접근 해야 하고 어떤 경우에는 2번 <code>Pod</code> 로 접근 해야 하는 상황에서 사용자 Front 입장에서는 2개의 <code>Pod</code> EndPoint 를 동적으로 컨트롤러 하기 어렵습니다. 이때 <code>Service</code> 가 앞에 배치해서 부하 분산기 역활 통해 각각의 <code>Pod</code> 로 접근 하도록 도와주게 됩니다.<br>그리고 <code>Pod</code> 는 부하에 따라서 동적으로 <code>Pod</code> 가 증설 될 수도 있고 새로 생성된 <code>Pod</code> 는 IP 를 예측하기 어렵습니다. 그래서 언제든지 확장 될 수 있는 <code>Pod</code> 들을 확장성 있는 서버로 설계 하기 위해 <code>Service</code> 가 로드밸런싱 역활로 가지게 됩니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/Service-2.png" alt="Service-2"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: my-service</span><br><span class="line">  namespace: my-namespace</span><br><span class="line">spec:</span><br><span class="line">  type: ClusterIP</span><br><span class="line">  ports:</span><br><span class="line"><span class="bullet">    -</span> port: 80</span><br><span class="line"><span class="code">      targetPort: 80</span></span><br><span class="line"><span class="code">  selector:</span></span><br><span class="line"><span class="code">    app: nginx</span></span><br></pre></td></tr></table></figure>

<p>다음은 <code>Service</code> 자원 예시를 보도록 하겠습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kind: Service</span><br></pre></td></tr></table></figure>
<p>자원 종류를 <code>Service</code> 로 지정 하겠다는 의미입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">metadata:</span><br><span class="line">  name: my-service</span><br><span class="line">  namespace: my-namespace</span><br></pre></td></tr></table></figure>
<ul>
<li>name: 특정 자원의 이름</li>
<li>namespace: 네임스페이스명</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spec</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line"><span class="bullet">  -</span> port: 80</span><br><span class="line"><span class="code">    targetPort: 80</span></span><br><span class="line"><span class="code">  selector:</span></span><br><span class="line"><span class="code">    app: nginx</span></span><br></pre></td></tr></table></figure>
<ul>
<li>spec.selector.app: <code>label</code> 를 지정 하는 것, 즉 특정 <code>Pod</code> 에 지정한 <code>label</code> 로 네트워크 정보 전파 함, 만약에 1개 이상 <code>pod</code> 가 <code>service</code> 의 <code>selector.app</code> 과 매핑되면 자동으로 로드밸런싱</li>
<li>spec.ports.port: 특정 서비스의 내부 포트 번호</li>
<li>spec.ports.targetPort: <code>Service</code> 가 <code>포워딩(forward)</code> 하는 대상 <code>Pod</code>의 포트</li>
</ul>
<h3 id="Replicaset"><a href="#Replicaset" class="headerlink" title="Replicaset"></a>Replicaset</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/Replicaset.png" alt="Replicaset"></p>
<p><code>ReplicaSet</code>는 지정된 수의 <code>Pod</code> 복제본을 만들어주고 항상 지정된 수로 실행 되도록 보장해주는 <code>Kubernetes</code> 의 리소스 입니다. 앞써 설명한 <code>Pod</code> 를 2개의 복제 본으로 유지 하고자 하면 직접 개발자가 정의된 yml 파일을 이용해서 <code>apply</code> 해서 각각 <code>Pod</code> 를 만들어 주면 됩니다. 이렇게 하면 2개의 yml 파일을 구성해서 관리 해야 하는데 동일한 코드 중복 문제가 있을 수 있습니다. 이것을 해소하기 위해 <code>Replicaset</code> 이라는 리소스를 이용해서 개발자가 원하는 몇 개의 복제본 <code>Pod</code> 로 구성할지 설정만 하고 하나의 yml 파일로 관리 하면 됩니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: ReplicaSet</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-replicaset</span><br><span class="line">  namespace: my-namespace</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line"><span class="code">    matchLabels:</span></span><br><span class="line"><span class="code">      app: my-nginx</span></span><br><span class="line"><span class="code">  template:</span></span><br><span class="line"><span class="code">    metadata:</span></span><br><span class="line"><span class="code">      labels:</span></span><br><span class="line"><span class="code">        app: my-nginx</span></span><br><span class="line"><span class="code">    spec:</span></span><br><span class="line"><span class="code">      containers:</span></span><br><span class="line"><span class="code">      - name: nginx</span></span><br><span class="line"><span class="code">        image: nginx</span></span><br><span class="line"><span class="code">        ports:</span></span><br><span class="line"><span class="code">        - containerPort: 80</span></span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">metadata:</span><br><span class="line">  name: nginx-replicaset</span><br><span class="line">  namespace: my-namespace</span><br></pre></td></tr></table></figure>
<ul>
<li>name: 특정 자원의 이름</li>
<li>namespace: 네임스페이스명</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  template:</span><br><span class="line"><span class="code">    metadata:</span></span><br><span class="line"><span class="code">      labels:</span></span><br><span class="line"><span class="code">        app: my-nginx</span></span><br><span class="line"><span class="code">    spec:</span></span><br><span class="line"><span class="code">      containers:</span></span><br><span class="line"><span class="code">      - name: nginx</span></span><br><span class="line"><span class="code">        image: nginx</span></span><br><span class="line"><span class="code">        ports:</span></span><br><span class="line"><span class="code">        - containerPort: 80</span></span><br></pre></td></tr></table></figure>

<ul>
<li>spec.template.spec.containers: <code>Pod</code> 생성시 어떤 image 컨테이너로 생성 할 것인지 정의 합니다. <code>nginx</code> 이라는 이미지로 생성해서 컨터네이너로 관리 하겠다는 의미 입니다.</li>
<li>spec.template.metadata.labels.app: 생성한 <code>Pod</code>의 라벨을 지정 하는 것 입니다.</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line"><span class="code">    matchLabels:</span></span><br><span class="line"><span class="code">      app: my-nginx</span></span><br></pre></td></tr></table></figure>
<ul>
<li>spec.replicas: 생성한 <code>Pod</code> 를 몇 개 <code>replicas</code> 로 구성 할지 지정 합니다. </li>
<li>spec.selector.matchLabels.app: 이 값은 라벨을 지정 하는 것인데 <code>spec.template.metadata.labels.app</code> 통해 지정한 라벨하고 동일하게 매칭 되어 있으면 속한 <code>Pod</code> 들을 모니터링을 하게 되며 만약 지정한 <code>replicas</code> 값이 2 로 지정하면 항상 지정된 수로 <code>Pod</code> 들을 실행 되도록 보장 해줍니다.</li>
</ul>
<h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h3><p><code>Kubernetes</code> 에서 <code>Deployment</code> 는 애플리케이션의 <code>무중단 배포</code> 와 자동 복구, 스케일링, 버전 관리 등을 가능하게 해주는 핵심 리소스 입니다. </p>
<p>앞써 설명한 <code>ReplicaSet</code> 과 기본기능은 동일 하고, <code>Deployment</code> 이라는 리소스를 만들면 <code>ReplicaSet</code> 과 <code>ReplicaSet</code>을 통해 <code>Pod</code>를 생성 하게 됩니다. 간단하게 주요 역활에 대해 나열 하도록 하겠습니다.</p>
<ol>
<li>애플리케이션의 <code>지속적인 배포(Continuous Deployment)</code></li>
<li>새로운 버전의 <code>롤링 업데이트(Rolling Update)</code></li>
<li>장애 발생 시 <code>자동 복구(Self-healing)</code></li>
<li>버전 <code>롤백(Rollback)</code> 기능 제공</li>
</ol>
<p>한마리로 <code>ReplicaSet</code> 의 발전된 형태가 <code>Deployment</code> 이라고 생각 하시면 되는데 </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: my-app</span><br><span class="line">  namespace: my-namespace</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line"><span class="code">    matchLabels:</span></span><br><span class="line"><span class="code">      app: my-nginx</span></span><br><span class="line"><span class="code">  template:</span></span><br><span class="line"><span class="code">    metadata:</span></span><br><span class="line"><span class="code">      labels:</span></span><br><span class="line"><span class="code">        app: my-nginx</span></span><br><span class="line"><span class="code">    spec:</span></span><br><span class="line"><span class="code">      containers:</span></span><br><span class="line"><span class="code">      - name: nginx</span></span><br><span class="line"><span class="code">        image: nginx</span></span><br><span class="line"><span class="code">        ports:</span></span><br><span class="line"><span class="code">        - containerPort: 80</span></span><br></pre></td></tr></table></figure>

<p>예시 <code>Deployment</code> 입니다. 차례대로 설명 하도록 하겠습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">metadata:</span><br><span class="line">  name: my-app</span><br><span class="line">  namespace: my-namespace</span><br></pre></td></tr></table></figure>
<ul>
<li>name: 특정 자원의 이름</li>
<li>namespace: 네임스페이스명</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line"><span class="code">    matchLabels:</span></span><br><span class="line"><span class="code">      app: my-nginx</span></span><br></pre></td></tr></table></figure>
<ul>
<li>spec.replicas: 생성한 <code>Pod</code> 를 몇 개 <code>replicas</code> 로 구성 할지 지정 합니다.</li>
<li>spec.selector.matchLabels.app: 이 값은 라벨을 지정 하는 것인데 <code>spec.template.metadata.labels.app</code> 통해 지정한 라벨하고 동일하게 매칭 되어 있으면 속한 <code>Pod</code> 들을 모니터링을 하게 되며 만약 지정한 <code>replicas</code> 값이 2 로 지정하면 항상 지정된 수로 <code>Pod</code> 들을 실행 되도록 보장 해줍니다.</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line"></span><br><span class="line">  template:</span><br><span class="line"><span class="code">    metadata:</span></span><br><span class="line"><span class="code">      labels:</span></span><br><span class="line"><span class="code">        app: my-nginx</span></span><br><span class="line"><span class="code">    spec:</span></span><br><span class="line"><span class="code">      containers:</span></span><br><span class="line"><span class="code">      - name: nginx</span></span><br><span class="line"><span class="code">        image: nginx:1.25</span></span><br><span class="line"><span class="code">        ports:</span></span><br><span class="line"><span class="code">        - containerPort: 80</span></span><br></pre></td></tr></table></figure>

<ul>
<li>spec.template.metadata.labels.app: 생성한 <code>Pod</code>의 라벨을 지정 하는 것 입니다.</li>
<li>spec.template.spec.containers.name: <code>Pod</code> 생성을 하는데 containers 이름을 <code>nginx</code> 이라고 지정 하겠다는 의미 입니다.</li>
<li>spec.template.spec.containers.image: <code>Pod</code> 생성시 어떤 image 컨테이너로 생성 할 것인지 정의 합니다. <code>nginx:1.25</code> 이라는 이미지로 생성해서 컨터네이너로 관리 하겠다는 의미 입니다.</li>
<li>spec.template.spec.containers.ports.containerPort: 생성하고자 하는 <code>Pod</code> 내 <code>nginx</code> 내부 포트를 <code>80</code> 으로 지정 하겠다는 의미 입니다.</li>
</ul>
<p>차례대로 설명 했고 해당 Deployment 를 apply 하도록 하겠습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/Deployment-1.png" alt="Deployment-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ./deployment.yml</span><br></pre></td></tr></table></figure>

<p>그런 다음 ReplicaSet 을 확인 해보도록 하겠습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get replicaset -n $&#123;네임스페이스명&#125;</span><br></pre></td></tr></table></figure>

<p>Deployment 도 생성 되었는지 확인 해봅니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment -n $&#123;네임스페이스명&#125;</span><br></pre></td></tr></table></figure>

<p>Pod 도 정상적으로 생성 되었는지 확인해봅니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n $&#123;네임스페이스명&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/Deployment-2.png" alt="Deployment-2"><br><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/Deployment-3.png" alt="Deployment-3"></p>
<p>그런 다음에 </p>
<p><code>spec.template.spec.containers.image</code> 여기서 <code>nginx:1.26</code> 으로 버전 업그레이드 해서 다시 apply 하도록 하겠습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ./deployment.yml</span><br></pre></td></tr></table></figure>

<p>그런 다음에 <code>replicaset</code>, <code>deployment</code>, <code>pod</code> 차례대로 다시 조회 하도록 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get replicaset -n $&#123;네임스페이스명&#125;</span><br><span class="line">kubectl get deployment -n $&#123;네임스페이스명&#125;</span><br><span class="line">kubectl get pod -n $&#123;네임스페이스명&#125;</span><br></pre></td></tr></table></figure>



<p>차례대로 확인 해보면 새로운 <code>Pod</code> 가 생성 되었다는 것을 확인 할 수 있는데요. 여기서 중요한 부분은 <code>Deployment</code> 경우 새로운 버전으로 다시 <code>apply</code> 하게 된다면 새롭게 <code>Replicaset</code> 하고 <code>Pod</code> 가 생성하게 되고 정상적으로 생성하게 된다면 기존에 생성 했던 <code>Replicaset</code> 하고 <code>Pod</code> 는 삭제 하게 됩니다. 즉 <code>롤링 업데이트(Rolling Update)</code> 가 진행 됩니다.</p>
<p>그 다음은 <code>롤백(Rollback)</code> 기능을 알아보도록 하겠습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout undo deployment $&#123;deployment 명&#125; -n $&#123;네임스페이스명&#125;</span><br></pre></td></tr></table></figure>

<p>롤백 명령어 입니다. 그런 다음 <code>Pod</code> 를 조회 하도록 하겠습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -n $&#123;deployment 명&#125;</span><br></pre></td></tr></table></figure>

<p>그런데 <code>latest(최신 버전)</code> 의 경우 즉 <code>Deployment</code>의 <code>template</code>에 변화가 없으면<br><code>spec.template.spec.containers.nginx:latest</code> 로 지정 하고 <code>apply</code> 를 하게 된다면 내부적으로는 버전 변화가 없기 때문에 새로운 <code>ReplicaSet</code> 하고 <code>Pod</code> 를 생성하지 않습니다. 즉 <code>롤링 업데이트(Rolling Update)</code> 가 진행 되지 않습니다.</p>
<p>강제로 새로운 <code>ReplicaSet</code> 및 <code>Pod</code> 를 생성 하고자 하면 <code>rollout restart</code> 명령어를 사용 해야 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout restart deployment $&#123;deployment명&#125; -n $&#123;namespace명&#125;</span><br></pre></td></tr></table></figure>

<p>이렇게 명령어를 실행하면 <code>latest</code> 태그를 그대로 사용하더라도 강제로 <code>ReplicaSet</code> 을 생성해서 새로운 <code>revision</code> 생성 하게 됩니다.</p>
<h3 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h3><p><code>Ingress</code> 는 <code>Kubernetes Cluster</code> 외부에서 내부 서비스로 들어오는 HTTP 요청의 라우팅 규칙을 정의하는 리소스 입니다. 다만, <code>Ingress</code> 만 만든다고 바로 작동하는 건 아니고 이를 실제로 처리할 <code>Ingress Controller</code> (예: NGINX) 가 필요합니다.</p>
<p><code>ingress</code> 가 왜 필요한지 그리고 어떤 역활을 하는지 그림으로 설명 하도록 하겠습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/Ingress-1.png" alt="Ingress-1"></p>
<p>그림에 보면 사용자가 <code>api.server.com</code> 으로 요청하게 된다면 <code>api.server.com</code> 역활을 하고 있는 <code>LB</code> 에 도달 하게 되고 <code>LB</code> 는 특정 <code>Service</code> 로 연결해서 각각의 <code>Pod</code> 로 연결하게 됩니다. 반대로 사용자가 <code>shop.server.com</code> 으로 요청시 해당 <code>LB</code> 는 특정 <code>Service</code> 로 연결해서 각각의 <code>Pod</code> 로 연결 할 수 있게 도와줍니다.</p>
<p>하지만 이 아키텍처의 단점은 각각의 <code>LB (로드밸런서)</code>가 특정 서비스하고 연결 하고 있다는 점 입니다. 즉 <code>api.server.com</code>, <code>shop.server.com</code> (<code>prefix</code> 다름) 각각의 자원에서  전용 <code>LB</code> 가 각각 생성 해야 한다는 점 입니다. 만약에 앞으로 <code>admin.server.com</code> 이라는 서비스가 생성 되었다는 그에 맞게 <code>LB</code> 도 생성 해야 한다는 점 입니다. </p>
<p><code>LB</code>는 <code>AWS</code> 에서 과금이 발생하는 요소다 보니까 자원의 낭비가 발생 할 수 있는 부분이 있습니다. 그리고 각각 <code>LB</code> 마다 엔드포인트가 관리를 해야 해서 프론트엔드 소스코드에서도 전부 달라지는 엔드포인트 설정 및 관리를 해야 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/Ingress-2.png" alt="Ingress-2"></p>
<p>각각의 <code>Service</code>마다 <code>LB</code>를 연결시키는 게 아니라 중간에 <code>Ingress</code> 라고 하는 자원을 만들어두고 이 <code>Ingress</code> 는 <code>url 패턴</code>에 따라 서비스로 분기 처리를 해주게 됩니다. 즉 <code>Ingress Controller</code> 가 <code>api.server.com</code>, <code>shop.server.com</code> 각각의 <code>Ingress</code> 로 라우팅 하는 역활을 하게 됩니다.<br><code>Ingress</code> 에서는 예를들어서 <code>shop.server.com/$&#123;Server1 URL 패턴&#125;</code> <code>shop.server.com/$&#123;Server2 URL 패턴&#125;</code> 으로 각각 url 패턴으로 <code>Service</code> 로 가도록 합니다.</p>
<h4 id="Ingress와-Ingress-Controller-차이점은"><a href="#Ingress와-Ingress-Controller-차이점은" class="headerlink" title="Ingress와 Ingress Controller 차이점은?"></a><code>Ingress</code>와 <code>Ingress Controller</code> 차이점은?</h4><p><code>Kubernetes</code> 에서 <code>Ingress</code>와 <code>Ingress Controller</code>는 이름이 비슷해서 헷갈리지만 역할과 성격이 완전히 다릅니다.  <code>Ingress Controller</code> 는 실질적인 라우팅을 수행 하고 <code>Ingress</code> 는 규칙정보 정의를 합니다. </p>
<p>즉 <code>abc.server.com</code> 이라는 도메인 통해 사용자가 접근 하게 된다면 맨 처럼  <code>LB</code> 는 특정 <code>Ingress Controller</code> 로 접근 하게 되고 여기서 주된 역활은 <code>kubernetes Cluster</code> 외부에서 내부 서비스로 들어오는 트래픽을 관리하고 라우팅하는 역할 하게 됩니다.<br><code>Ingress Controller</code> 로 접근 통해 맨 앞에 <code>Prefix</code> 단위로 특정 <code>Ingress</code> 로 접근 하게 되고 <code>Ingress</code> 는 <code>url 패턴</code>에 따라 서비스로 분기 처리를 해주게 됩니다.</p>
<p>쉽게 생각 하자면 <code>Ingress Controller</code> 는 “교통경찰” 또는 “자동차 네비게이션 시스템”, <code>Ingress</code> 는 “도로 표지판” 으로 이해 하면 됩니다. </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.1/deploy/static/provider/aws/deploy.yaml</span><br></pre></td></tr></table></figure>

<p><code>Ingress Controller</code> 설치 명령어 입니다. 이때 동시에 <code>AWS LB</code> 도 등록 하게 됩니다. AWS 에 가서 <code>Route53</code> 하고 등록된 <code>LB</code> 하고 매핑 작업이 필요 합니다. </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ingress</span><br><span class="line">  namespace: my-namespace</span><br><span class="line">  annotations:</span><br><span class="line">  # 여기서 &quot;nginx&quot;로 지정한 것은 이 Ingress가 NGINX 기반 Ingress Controller에 의해 처리된다는 의미</span><br><span class="line"><span class="code">    kubernetes.io/ingress.class: nginx</span></span><br><span class="line"><span class="code">    </span></span><br><span class="line"><span class="code">spec:</span></span><br><span class="line"><span class="code">  rules:</span></span><br><span class="line"><span class="code">  - host: server.syh8088.store  # 설정하려는 도메인 이름.</span></span><br><span class="line"><span class="code">    http:</span></span><br><span class="line"><span class="code">      paths:</span></span><br><span class="line"><span class="code">      # - path: /</span></span><br><span class="line"><span class="code">      - path: /syh/ #syh 시작하는 모든 url요청을 nginx-service1로 라우팅한다는 정규표현식</span></span><br><span class="line"><span class="code">        pathType: Prefix</span></span><br><span class="line"><span class="code">        backend:</span></span><br><span class="line"><span class="code">          service:</span></span><br><span class="line"><span class="code">            name: nginx-service</span></span><br><span class="line"><span class="code">            port:</span></span><br><span class="line"><span class="code">              number: 80</span></span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ingress</span><br><span class="line">  namespace: my-namespace</span><br><span class="line">  annotations:</span><br><span class="line">  # 여기서 &quot;nginx&quot;로 지정한 것은 이 Ingress가 NGINX 기반 Ingress Controller에 의해 처리된다는 의미</span><br><span class="line"><span class="code">    kubernetes.io/ingress.class: nginx</span></span><br><span class="line"><span class="code">    nginx.ingress.kubernetes.io/rewrite-target: /$1 #첫번쨰 prefix제거</span></span><br></pre></td></tr></table></figure>

<ul>
<li>metadata.name: 특정 자원의 이름</li>
<li>metadata.namespace: 네임스페이스명 지정</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line"><span class="bullet">  -</span> host: server.syh8088.store  # 설정하려는 도메인 이름.</span><br><span class="line"><span class="code">    http:</span></span><br><span class="line"><span class="code">      paths:</span></span><br><span class="line"><span class="code">      # - path: /</span></span><br><span class="line"><span class="code">      - path: /msmbers/ #syh 시작하는 모든 url요청을 nginx-service1로 라우팅한다는 정규표현식</span></span><br><span class="line"><span class="code">        pathType: Prefix</span></span><br><span class="line"><span class="code">        backend:</span></span><br><span class="line"><span class="code">          service:</span></span><br><span class="line"><span class="code">            name: nginx-service</span></span><br><span class="line"><span class="code">            port:</span></span><br><span class="line"><span class="code">              number: 80</span></span><br><span class="line"><span class="code">      - path: /products/ #syh 시작하는 모든 url요청을 nginx-service1로 라우팅한다는 정규표현식</span></span><br><span class="line"><span class="code">        pathType: Prefix</span></span><br><span class="line"><span class="code">        backend:</span></span><br><span class="line"><span class="code">          service:</span></span><br><span class="line"><span class="code">            name: nginx-service-2</span></span><br><span class="line"><span class="code">            port:</span></span><br><span class="line"><span class="code">              number: 80     </span></span><br></pre></td></tr></table></figure>
<ul>
<li>spec.rules.host: 설정하려는 도메인 이름</li>
<li>spec.rules.http.paths.- path: <code>server.syh8088.store/members</code> 로 호출시 &#x2F;members 라는 path 로 호출 했으면 ‘nginx-service’ 로 라우팅한다는 정규표현식</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f ./ingress.yml</span><br></pre></td></tr></table></figure>

<p><code>ingress</code> apply 명령어 입니다. </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get ingress -n $&#123;네임스페이스명&#125;</span><br></pre></td></tr></table></figure>

<p>해당 설치된 <code>Ingress</code> 조회 하는 명령어 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME              CLASS        HOSTS                ADDRESS                                     PORTS      AGE</span><br><span class="line">nginx-ingress     <span class="language-xml"><span class="tag">&lt;<span class="name">none</span>&gt;</span></span>   server.syh8088.store    $&#123;LB 주소&#125;.ap-northeast-2.amazonaws.com       80         88s</span><br></pre></td></tr></table></figure>

<p>이렇게 설치된 ingress 목록을 확인 할 수 있습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://server.syh8088.store/msmbers </span><br></pre></td></tr></table></figure>
<p>해당 명령어를 호출하면 <code>Ingress-Controller</code> -&gt; <code>Ingress</code> -&gt; <code>Service</code> -&gt; <code>Pod</code> 까지 접근 하게 됩니다.</p>
<h2 id="실습-CI-CD-구축-해보기"><a href="#실습-CI-CD-구축-해보기" class="headerlink" title="실습 CI&#x2F;CD 구축 해보기"></a>실습 CI&#x2F;CD 구축 해보기</h2><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS-CI_CD-architecture.png" alt="AWS EKS CI/CD architecture"></p>
<p>지금부터 실습 통해 <code>AWS EKS</code> 이용해서 <code>CI/CD</code> 작업 하고자 합니다. 간단하게 전체적인 flow 를 설명하자면 사용자가 특정 도메인에 접근 하면 <code>AWS Route53</code> 통해 정해진 <code>LB</code> 로 접근 하게 되고 <code>Kubernetes Ingress Controller</code> 로 이동 하게 됩니다. 여기서 적절하게 도메인 <code>prefix</code> 계산해서 <code>Ingress</code> 로 가게되고 매핑된 <code>Service</code> 로 접근하게 되고 최종 목적지인 <code>Pod</code> 로 가게 됩니다.</p>
<p>개발자는 <code>Github Action</code> 통해 특정 브랜치에 <code>Git Push</code> 를 하게 된다면 <code>Dockerfile</code> 이용해서 <code>Docker Image</code> 를 만들고 만든 image 를 <code>AWS ECR Repository</code> 에 등록하게 됩니다. 그다음 <code>Kubernetes</code> 에서 지원하는 <code>kubectl</code> 명령어를 통해서 새롭게  <code>Pod</code> 를 만들면서 <code>롤링 업데이트</code> 진행 하게 됩니다. </p>
<h3 id="IAM-역할-생성-하기"><a href="#IAM-역할-생성-하기" class="headerlink" title="IAM 역할 생성 하기"></a>IAM 역할 생성 하기</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-1.png" alt="IAM_USER_CREATE_1-1"></p>
<p><code>AWS IAM</code> 서비스로 접근 해서 <code>사용자 생성</code> 버튼을 클릭 하도록 합니다. </p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-2.png" alt="IAM_USER_CREATE_1-2"></p>
<p>원하시는 사용자 이름을 지정 한 다음에 <code>다음</code> 버튼을 클릭 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-3.png" alt="IAM_USER_CREATE_1-3"></p>
<p><code>권한 옵션</code> 에서 <code>직접 정책 연결</code> 선택 합니다. 그런 다음에 <code>AdministratorAccess</code> 정책을 클릭 하고 <code>다음</code> 버튼을 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-4.png" alt="IAM_USER_CREATE_1-4"></p>
<p><code>사용자 생성</code> 버튼을 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_CREATE_1-5.png" alt="IAM_USER_CREATE_1-5"></p>
<p>생선된 사용자 <code>콘솔 로그인 URL</code> 및 <code>콘솔 암호</code> 를 따로 잘 관리 하도록 합니다. 그런 다음 생성한 사용자로 다시 AWS 로그인을 하도록 합니다. </p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_ACCESS_KEY_CREATE_1-1.png" alt="IAM_USER_ACCESS_KEY_CREATE_1-1"></p>
<p>생성한 사용자에서 페이지 에서 <code>엑세스 키 만들기</code> 버튼을 클릭 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_ACCESS_KEY_CREATE_1-2.png" alt="IAM_USER_ACCESS_KEY_CREATE_1-2"></p>
<p>사용사례 에서 <code>Command Line Interface(CLI)</code> 선택 하도록 합니다. </p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_ACCESS_KEY_CREATE_1-3.png" alt="IAM_USER_ACCESS_KEY_CREATE_1-3"></p>
<p><code>엑세스 키 만들기</code> 버튼을 클릭 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/IAM_USER_ACCESS_KEY_CREATE_1-4.png" alt="IAM_USER_ACCESS_KEY_CREATE_1-4"></p>
<p>생성된 엑세스 키를 따로 잘 보관 하도록 합니다.</p>
<h3 id="AWS-EKS-Cluster-생성-하기"><a href="#AWS-EKS-Cluster-생성-하기" class="headerlink" title="AWS EKS Cluster 생성 하기"></a>AWS EKS Cluster 생성 하기</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-1.png" alt="EKS_CREATE_1-1"></p>
<p><code>AWS Elastic Kuberneties Service</code> 서비스에 접속 하도록 합니다. <code>클러스터 생성</code> 버튼을 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-2.png" alt="EKS_CREATE_1-2"></p>
<p>일반적인 실습 과정이기에 요금 절약을 위해 <code>구성 옵션</code> 을 <code>사용자 지정 구성</code> 을 클릭 합니다. 그리고 <code>EKS 자율 모드</code> 사용을 해제 하도록 합니다. </p>
<p>그런 다음 원하시는 클러스터 이름을 입력 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-3_IAM_ROLE_CREATE_1-1.png" alt="EKS_CREATE_1-3_IAM_ROLE_CREATE_1-1"></p>
<p><code>클러스터 IAM 역활</code> 설정 해야 합니다. 지금 생성하는 EKS 전용 역할 생성을 위해 <code>권장 역할 생성</code> 버튼을 클릭 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-3_IAM_ROLE_CREATE_1-2.png" alt="EKS_CREATE_1-3_IAM_ROLE_CREATE_1-2"></p>
<p><code>신뢰 할 수 있는 엔티티 유형</code> 을 <code>AWS 서비스</code> 로 클릭 합니다. 참고로 AWS <code>역할</code> 이라는 하는 것은 AWS 자원 끼리 접근 할 수 있는 권한이라고 생각 하면 됩니다. 우리는 AWS EKS 서비스를 AWS EC2 서비스로 접근 할 수 있는 권한을 생성 해야 하기 떄문에 지금과 같은 역할 생성을 하는 겁니다.</p>
<p><code>서비스 또는 사용 사례</code> 에서 <code>EKS</code> 로 선택하고 <code>사용 사례</code> 를 <code>EKS - Cluster</code> 를 선택 합니다. 이렇게 하면 AWS 에서 권장 하는 역할은 자동 선택 해서 셋팅 해줍니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-3_IAM_ROLE_CREATE_1-3.png" alt="EKS_CREATE_1-3_IAM_ROLE_CREATE_1-3"></p>
<p>그러면 <code>AmazonEKSClusterPolicy</code> 선택 하게 해줍니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-3_IAM_ROLE_CREATE_1-4.png" alt="EKS_CREATE_1-3_IAM_ROLE_CREATE_1-4"></p>
<p>원하시는 역할 이름을 입력 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-4.png" alt="EKS_CREATE_1-4"></p>
<p>다시 EKS Cluster 생성 페이지에서 방금 생성 한 <code>역할</code> 을 선택 하도록 합니다. (바로 옆에 새로고침 버튼 클릭)</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-5.png" alt="EKS_CREATE_1-5"></p>
<p>다음은 2단계 <code>네트워킹 지정</code> 입니다. <code>VPC</code> 설정인데 미리 설정 해준 default 로 해서 다음 버튼을 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-6.png" alt="EKS_CREATE_1-6"></p>
<p>다음은 3단계 <code>관찰성 구성</code> 페이지 입니다. 기본적으로 셋팅 한것으로 해서 다음 버튼 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-7.png" alt="EKS_CREATE_1-7"></p>
<p>다음은 4단계 <code>추가 기능 선택</code> 페이지 입니다. 기본적으로 셋팅 한것으로 해서 다음 버튼 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-8.png" alt="EKS_CREATE_1-8"></p>
<p>다음은 5단계 <code>선택한 추가 기능 설정 구성</code> 페이지 입니다. 이것도 기본적으로 셋팅 한것으로 해서 다음 버튼 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-9.png" alt="EKS_CREATE_1-9"></p>
<p><code>검토 및 생성</code> 페이지 입니다. 지금까지 생성한 설정 확인 및 최종 클러스터 생성 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-10.png" alt="EKS_CREATE_1-10"></p>
<p>20분 정도 지나면 생선한 <code>EKS Cluster</code> 생성 한 것을 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-1.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-1"></p>
<p><code>컴퓨팅</code> 메뉴를 클릭 해서 이제 <code>노드 그룹 추가</code> 버튼을 클릭 하도록 합니다. 앞써 설명한대로 <code>Kuberneties</code> 는 <code>Master Node</code> 및 <code>Worker Node</code> 로 구성 되어 있다고 했습니다.</p>
<p>방금 EKS 생성은 <code>Master Node</code> 를 생성한 것이고, 지금은 노드 그룹 추가 통해 <code>Worker Node</code> 를 생성 하고자 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-2.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-2"></p>
<p>1단계 <code>노드 그룹 구성</code> 페이지에서 원하시는 노드 그룹명을 지정 하도록 합니다. 그런 후 <code>노드 IAM 역할</code> 을 적용 해야 합니다. <code>권장 역할 생성</code> 버튼을 클릭 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-3_IAM_ROLE_CREATE_1-1.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-3_IAM_ROLE_CREATE_1-1"></p>
<p><code>신뢰 할 수 있는 엔티티 유형</code> 을 <code>AWS 서비스</code> 로 클릭 합니다. 그리고 <code>Worker Node</code> 는 EC2 로 구성하기 때문에 <code>사용 사례</code> 를 <code>EC2</code> 로 설정 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-3_IAM_ROLE_CREATE_1-2.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-3_IAM_ROLE_CREATE_1-2"></p>
<p>그럼 이미지 권한 정책에서 이미 3개가 선택 되어 있습니다. </p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-3_IAM_ROLE_CREATE_1-3.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-3_IAM_ROLE_CREATE_1-3"></p>
<p>역할 이름을 지정 한 다음에 다음 버튼을 클릭 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-4.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-4"></p>
<p>방금 생성한 역할을 선택 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-5.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-5"></p>
<p>2단계 <code>컴퓨팅 및 조정 구성 설정</code> 페이지 입니다. 생성하고자 하는 <code>Worker Node</code> 인스턴스 유형을 선택 하는 항목 입니다. 일단 실습이기 때문에 원하시는 OS 를 선택해주시고 사양은 <code>t3.small</code> 로 선택 해도 크게 무리는 없습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-6.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-6"></p>
<p><code>노드 그룹 조정 구성</code> 에서 </p>
<ol>
<li>원하는 크기: 2</li>
<li>최소 크기: 2</li>
<li>최대 크기: 2</li>
</ol>
<p>로 최소 비용을 위해 설정 하도록 합니다. 실전에서는 서비스에 따라 계산 해서 설정 해야 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-7.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-7"></p>
<p>3단계 <code>네트워킹 지정</code> 페이지에서 기본값으로 해서 다음 버튼을 클릭 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-8.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-8"></p>
<p><code>검토 및 생성</code> 페이지에서 지금까지 설정한 데이터를 확인 후 최종적으로 노드 생성 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-9.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-9"></p>
<p>몇분 후 다시 <code>컴퓨팅</code> 메뉴 페이지로 접근 하면 생성한 노드를 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-10.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-10"></p>
<p>만약 나중에 노드 갯수 설정을 변경 하고자 할때 <code>세부 정보</code> 페이지에서 우측 상단에 <code>편집</code> 버튼을 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-11.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-11"></p>
<p>초기 설정한 노드 갯수 관련 데이터 값을 확인 할 수 있습니다. 여기서 원하시는 갯수로 설정 한 다음에 수정 하도록 합니다.</p>
<h3 id="AWS-CLI-설치-및-kubectl-셋팅-하기"><a href="#AWS-CLI-설치-및-kubectl-셋팅-하기" class="headerlink" title="AWS CLI 설치 및 kubectl 셋팅 하기"></a>AWS CLI 설치 및 kubectl 셋팅 하기</h3><p>지금까지 AWS EKS 통해 <code>Master Node</code> 및 <code>Worker Node</code> 를 생성 했습니다. 그럼 개발자가 직접 Local PC 에서 <code>Master Node</code> 로 접근 및 통제를 위해 <code>AWS CLI</code> 그리고 <code>kubectl</code> 설치 를 해야 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.aws.amazon.com/ko<span class="emphasis">_kr/cli/latest/userguide/getting-started-install.html#getting-started-install-instructions</span></span><br></pre></td></tr></table></figure>
<p>해당 페이지로 접근 해서 지금 사용하고 있는 OS 따라 <code>AWS CLI</code> 프로그램 다운로드 및 설치 하도록 합니다. </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws --version</span><br></pre></td></tr></table></figure>

<p>설치 확인 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/AWS_CLI_LOCAL_SETTING_1-1.png" alt="AWS_CLI_LOCAL_SETTING_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws configure</span><br></pre></td></tr></table></figure>

<p>설치가 끝나면 <code>aws configure</code> 명령어를 입력 합니다. AWS 에 접근 하기 위해 <code>AWS CLI</code> 이용 합니다. 그러기 위해서는 권한 인증을 해야 하는데 사전에 발급받은 <code>AWS access key</code>, <code>AWS secret key</code> 입력 합니다.</p>
<p>다음은 <code>Kuberneties</code> 에 통제 하기 위해 <code>kubectl</code> 셋팅을 해야 합니다. <code>kubectl</code>은 Kubernetes 클러스터를 제어하기 위한 커맨드 라인 <code>인터페이스(CLI)</code> 도구 입니다. <code>kubectl</code> 를 이용해서 개발자는 클러스터에 있는 리소스를 생성, 조회, 업데이트 및 삭제 등 할 수 있게 됩니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## 맥 OS 사용자</span></span><br><span class="line">brew install kubectl</span><br><span class="line"></span><br><span class="line"><span class="section">## 윈도우 사용자</span></span><br><span class="line">install -e --id Kubernetes.kubectl</span><br><span class="line"></span><br><span class="line"><span class="section">## 설치확인</span></span><br><span class="line">kubectl version --client</span><br></pre></td></tr></table></figure>

<h3 id="kube-config-설정-하기"><a href="#kube-config-설정-하기" class="headerlink" title="kube config 설정 하기"></a>kube config 설정 하기</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/EKS_CREATE_1-11_NODE_CREATE_1-12.png" alt="EKS_CREATE_1-11_NODE_CREATE_1-12"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws eks update-kubeconfig --region ap-northeast-2 --name $&#123;AWS EKS Cluster 명&#125;</span><br></pre></td></tr></table></figure>
<p>해당 명령어를 이용해서 kube config 를 설정 하도록 합니다. <code>AWS CLI</code> 일부로 <code>AWS EKS Cluster</code>와 상호 작용 하기 위해서 <code>kubectl</code> 구성 파일(<code>kubeconfig</code>)을 자동으로 생성하거나 업데이트 합니다. 해당 명령어를 사용하면 수동으로 구성 파일을 생성하고 관리할 필요 없이, 쉽게 <code>AWS EKS Cluster</code> 와 연결을 설정 할 수 있게 됩니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>

<p>지금 현재 <code>kubernetes</code> 에서 설치된 <code>Worker Node</code> 2대를 확인 할 수 있습니다.</p>
<h3 id="Kubernetes-NameSpace-생성하기"><a href="#Kubernetes-NameSpace-생성하기" class="headerlink" title="Kubernetes NameSpace 생성하기"></a>Kubernetes NameSpace 생성하기</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/NAMESPACE_CREATE_DEV_1-1.png" alt="NAMESPACE_CREATE_DEV_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create namespace dev</span><br></pre></td></tr></table></figure>

<p><code>dev</code> 이라는 namespace 를 생성 하도록 합니다.</p>
<h3 id="AWS-Route53-설정-및-LB로-라우팅-대상-설정-하기"><a href="#AWS-Route53-설정-및-LB로-라우팅-대상-설정-하기" class="headerlink" title="AWS Route53 설정 및 LB로 라우팅 대상 설정 하기"></a>AWS Route53 설정 및 LB로 라우팅 대상 설정 하기</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_CREATE_1-1.png" alt="ROUTE53_CREATE_1-1"></p>
<p>AWS <code>Route53</code> 서비스에 접속해서 <code>호스팅 영역</code> -&gt; <code>호스팅 영역 생성</code> 버튼을 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_CREATE_1-2.png" alt="ROUTE53_CREATE_1-2"></p>
<p>미리 구입한 도메인을 <code>도메임 이름</code> 영역에 입력 합니다. 그런 다음 <code>호스팅 영역 생성</code> 버튼을 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_CREATE_1-3.png" alt="ROUTE53_CREATE_1-3"></p>
<p><code>호스팅 영역</code> 메뉴에 클릭 하면 방금 생성한 호스팅 영역 <code>레코드</code> 영역을 확인 해봅니다. (이 부분은 CI&#x2F;CD 실습 Part 에서 다시 설명 하도록 하겠습니다.)</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_RECODE_CREATE_1-1.png" alt="ROUTE53_RECODE_CREATE_1-1"></p>
<h3 id="도메인-구입하기"><a href="#도메인-구입하기" class="headerlink" title="도메인 구입하기"></a>도메인 구입하기</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GABIA_DOMAIN_CREATE_1-1.png" alt="GABIA_DOMAIN_CREATE_1-1"></p>
<p><code>가비아</code> 홈페이지에 접속해서 원하시는 도메인을 구입 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GABIA_DOMAIN_CREATE_1-2.png" alt="GABIA_DOMAIN_CREATE_1-2"></p>
<p>구입한 도메인 <code>관리</code> 페이지로 접속 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GABIA_DOMAIN_CREATE_1-3.png" alt="GABIA_DOMAIN_CREATE_1-3"></p>
<p>이전에 <code>AWS Route53</code> 에서 <code>호스팅 영역</code> 생성한 생성한 <code>레코드</code> 영역을 입력 합니다. (맨 마지막에 . 은 제거 하고 입력 하도록 합니다.)</p>
<h3 id="Docker-Image-생성-및-업로드-하는-방법"><a href="#Docker-Image-생성-및-업로드-하는-방법" class="headerlink" title="Docker Image 생성 및 업로드 하는 방법"></a>Docker Image 생성 및 업로드 하는 방법</h3><h4 id="AWS-ECR-Repository-생성-하기"><a href="#AWS-ECR-Repository-생성-하기" class="headerlink" title="AWS ECR Repository 생성 하기"></a>AWS ECR Repository 생성 하기</h4><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/ECR_CREATE_1-1.png" alt="ECR_CREATE_1-1"></p>
<p><code>AWS ECR</code> 서비스로 접근 해서 <code>프라이빗 레포지토리</code> 생성 하도록 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;생성한 프로젝트 디렉토리&#125;</span><br></pre></td></tr></table></figure>

<p>그 다음은 CMD 창을 열어서 해당 프로젝트 디렉토리에 이동 하도록 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 로컬에서 ecr 로그인</span></span><br><span class="line">aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin $&#123;AWS ECR 생성한 레포지토리명&#125;</span><br></pre></td></tr></table></figure>
<p>Local PC 에서 <code>AWS ECR</code> 로그인을 하도록 합니다.</p>
<p>로컬에서 도커 이미지 빌드 및 push</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/AWS_ECR_DOCKER_BUILD_1-1.png" alt="AWS_ECR_DOCKER_BUILD_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t $&#123;AWS ECR 생성한 레포지토리명&#125;:latest .</span><br></pre></td></tr></table></figure>
<p>해당 프로젝트를 docker image 파일을 만드는 명령어 입니다. </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 필요프로그램 설치</span></span><br><span class="line">FROM openjdk:17-jdk-alpine as stage1</span><br><span class="line">ARG SPRING<span class="emphasis">_PROFILE</span></span><br><span class="line"><span class="emphasis"># 파일 복사</span></span><br><span class="line"><span class="emphasis">WORKDIR /app</span></span><br><span class="line"><span class="emphasis">COPY gradle gradle</span></span><br><span class="line"><span class="emphasis">COPY src src</span></span><br><span class="line"><span class="emphasis">COPY build.gradle .</span></span><br><span class="line"><span class="emphasis">COPY settings.gradle .</span></span><br><span class="line"><span class="emphasis">COPY gradlew .</span></span><br><span class="line"><span class="emphasis"># 빌드</span></span><br><span class="line"><span class="emphasis">RUN chmod +x gradlew</span></span><br><span class="line"><span class="emphasis">RUN ./gradlew bootJar</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 두번째 스테이지</span></span><br><span class="line"><span class="emphasis">FROM openjdk:17-jdk-alpine </span></span><br><span class="line"><span class="emphasis">WORKDIR /app</span></span><br><span class="line"><span class="emphasis">COPY --from=stage1 /app/build/libs/*.jar app.jar</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis"># 실행 : CMD 또는 ENTRYPOINT를 통해 컨테이너를 배열 형태의 명령어로 실행</span></span><br><span class="line"><span class="emphasis">ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]</span></span><br></pre></td></tr></table></figure>
<p>해당 프로젝트에는 <code>Dockerfile</code> 이 존재합니다. 미리 준비된 <code>Dockerfile</code> 이용해서 docker image 를 생성 하게 됩니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/AWS_ECR_DOCKER_PUSH_1-1.png" alt="AWS_ECR_DOCKER_PUSH_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push $&#123;AWS ECR 생성한 레포지토리명&#125;:latest</span><br></pre></td></tr></table></figure>

<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/AWS_ECR_DOCKER_PUSH_1-2.png" alt="AWS_ECR_DOCKER_PUSH_1-2"></p>
<p>생성한 docker image 를 <code>AWS ECR</code> 해당 레포지토리에 push 하도록 합니다. 그런 다음 정상적으로 docker image 를 생성 했는지 AWS ECR 서비스에 접속해서 확인 하도록 합니다.</p>
<p>지금은 이렇게 하나하나 docker 명령어를 이용해서 <code>AWS ECR Repository</code> 에 docker image 를 등록 했지만 <code>github Action</code> 을 이용해서 자동화 할 예정 입니다.</p>
<h3 id="kubernetes-Deployment-및-Ingress-Apply-하기"><a href="#kubernetes-Deployment-및-Ingress-Apply-하기" class="headerlink" title="kubernetes Deployment 및 Ingress Apply 하기"></a>kubernetes Deployment 및 Ingress Apply 하기</h3><h4 id="Deployment-Apply-하기"><a href="#Deployment-Apply-하기" class="headerlink" title="Deployment Apply 하기"></a>Deployment Apply 하기</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: project-backend</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line"><span class="section"># Deployment나 StatefulSet이 유지할 &quot;옛날 ReplicaSet&quot;의 수를 제한하는 옵션. 자원공간의 낭비 방지 및 관리의 편의성.</span></span><br><span class="line">  revisionHistoryLimit: 2</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line"><span class="code">    matchLabels:</span></span><br><span class="line"><span class="code">      app: project-backend</span></span><br><span class="line"><span class="code">  template:</span></span><br><span class="line"><span class="code">    metadata:</span></span><br><span class="line"><span class="code">      labels:</span></span><br><span class="line"><span class="code">        app: project-backend</span></span><br><span class="line"><span class="code">    spec:</span></span><br><span class="line"><span class="code">      containers:</span></span><br><span class="line"><span class="code">      - name: project-backend</span></span><br><span class="line"><span class="code">        image: $&#123;AWS ECR REPOSITORY 주소&#125;:latest</span></span><br><span class="line"><span class="code">        ports:</span></span><br><span class="line"><span class="code">        - containerPort: 8080</span></span><br><span class="line"><span class="code">        resources:</span></span><br><span class="line"><span class="code">        # 컨테이너가 사용할수 있는 리소스의 최대치</span></span><br><span class="line"><span class="code">          limits:</span></span><br><span class="line"><span class="code">            cpu: &quot;1&quot;</span></span><br><span class="line"><span class="code">            memory: &quot;500Mi&quot;</span></span><br><span class="line"><span class="code">        # 컨테이너가 시작될떄 보장받아야 하는 최소 자원</span></span><br><span class="line"><span class="code">          requests:</span></span><br><span class="line"><span class="code">            cpu: &quot;0.5&quot;</span></span><br><span class="line"><span class="code">            memory: &quot;250Mi&quot;</span></span><br><span class="line"><span class="code">        env:</span></span><br><span class="line"><span class="code">        # name값과 yml의 $&#123;변수&#125; 의 변수명과 일치해야함</span></span><br><span class="line"><span class="code">        - name: DB_HOST</span></span><br><span class="line"><span class="code">          valueFrom:</span></span><br><span class="line"><span class="code">            secretKeyRef:</span></span><br><span class="line"><span class="code">              name: my-app-secrets</span></span><br><span class="line"><span class="code">              key: DB_HOST</span></span><br><span class="line"><span class="code">        - name: DB_PW</span></span><br><span class="line"><span class="code">          valueFrom:</span></span><br><span class="line"><span class="code">            secretKeyRef:</span></span><br><span class="line"><span class="code">              name: my-app-secrets</span></span><br><span class="line"><span class="code">              key: DB_PW</span></span><br><span class="line"><span class="code">        # 컨테이너 상태 확인을 통해 롤링업데이트 최적화 </span></span><br><span class="line"><span class="code">        readinessProbe:</span></span><br><span class="line"><span class="code">          httpGet:</span></span><br><span class="line"><span class="code">            # healthcheck 경로</span></span><br><span class="line"><span class="code">            path: /health</span></span><br><span class="line"><span class="code">            port: 8080</span></span><br><span class="line"><span class="code">          # 컨테이너 시작 후 지연</span></span><br><span class="line"><span class="code">          initialDelaySeconds: 10</span></span><br><span class="line"><span class="code">          # 확인 반복 주기</span></span><br><span class="line"><span class="code">          periodSeconds: 10</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: project-backend-service</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  type: ClusterIP</span><br><span class="line">  ports:</span><br><span class="line"><span class="bullet">  -</span> port: 80</span><br><span class="line"><span class="code">    targetPort: 8080</span></span><br><span class="line"><span class="code">  selector:</span></span><br><span class="line"><span class="code">    app: project-backend</span></span><br></pre></td></tr></table></figure>
<p>앞써 <code>Deployment</code> 학습 관련해서 아직 설명하지 않는 부분이 있습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  revisionHistoryLimit: 2</span><br></pre></td></tr></table></figure>
<p>앞써 설명 했었지만 <code>Deployment (depl_svc.yml 파일)</code> 에서 내용은 수정 한 것은 없지만 실전에서는 배포하고자 하는 소스코드 수정이 빈번하게 발생 할 것 입니다. 나중에 설명 하겠지만 배포시 <code>GitHub Action</code> 을 이용해서 Docker Image 를 생성하고 생성한 Image 를 AWS ECR Repository 에 등록 하고자 합니다.</p>
<p>다시 말하자면 강제로 (Deployment depl_svc.yml 파일 내용 수정 안해도) 새로운 <code>ReplicaSet</code> 및 <code>Pod</code> 를 생성 하고자 하면 <code>rollout restart</code> 명령어를 사용 해야 합니다. </p>
<p><code>revisionHistoryLimit</code> 는 새로운 <code>ReplicaSet</code> 및 <code>Pod</code> 을 몇 개까지 만들 것인가를 설정 한 것 입니다. 해당 설정을 하지 않으면 지속적으로 배포 할때 마다 계속 무한대로 생성하기 때문에 제한을 두어서 관리하기 쉽게 하는 것 입니다.</p>
<p><code>spec.template.spec.containers.ports.-containerPort</code>: 해당 포트 번호는 배포 하고자 하는 프로젝트의 배포 할때 설정한 포트 번호하고 동일 해야 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">resources:</span><br><span class="line"><span class="section"># 컨테이너가 사용할수 있는 리소스의 최대치</span></span><br><span class="line">  limits:</span><br><span class="line"><span class="code">    cpu: &quot;1&quot;</span></span><br><span class="line"><span class="code">    memory: &quot;500Mi&quot;</span></span><br><span class="line"><span class="code"># 컨테이너가 시작될떄 보장받아야 하는 최소 자원</span></span><br><span class="line"><span class="code">  requests:</span></span><br><span class="line"><span class="code">    cpu: &quot;0.5&quot;</span></span><br><span class="line"><span class="code">    memory: &quot;250Mi&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>Pod</code> 는 논리적인 자원 이기 때문에 <code>AWS EC2</code> 자원 안에서 생성 하게 됩니다. <code>AWS EC2</code> 물리적인 자원 내에서 안에 실행 하고자 하는 <code>Pod</code> 가 어느정도 자원을 점유 할 것인지 설정 하는 것 입니다. 즉 해당 컨테이너가 사용 할 수 있는 최소치 와 최대치를 설정 하는 것 입니다. 참고로 이 설정을 안하면 <code>AWS EC2</code> 물리적인 자원을 모두 소유 하기 때문에 다른 <code>Pod</code> 를 생성시 균등하게 배분 할 수 없어서 해당 설정은 필요 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">env:</span><br><span class="line"><span class="section"># name값과 yml의 $&#123;변수&#125; 의 변수명과 일치해야함</span></span><br><span class="line"><span class="bullet">-</span> name: DB<span class="emphasis">_HOST</span></span><br><span class="line"><span class="emphasis">  valueFrom:</span></span><br><span class="line"><span class="emphasis">    secretKeyRef:</span></span><br><span class="line"><span class="emphasis">      name: my-app-secrets</span></span><br><span class="line"><span class="emphasis">      key: DB_</span>HOST</span><br><span class="line"><span class="bullet">-</span> name: DB<span class="emphasis">_PW</span></span><br><span class="line"><span class="emphasis">  valueFrom:</span></span><br><span class="line"><span class="emphasis">    secretKeyRef:</span></span><br><span class="line"><span class="emphasis">      name: my-app-secrets</span></span><br><span class="line"><span class="emphasis">      key: DB_</span>PW</span><br></pre></td></tr></table></figure>
<p>이전에 <code>kubectl create secret generic my-app-secrets</code> 명령어를 통해서 <code>my-app-secrets</code> 이라는 secret 설정 한 데이터 <code>DB_HOST</code> 하고 <code>DB_PW</code> Key 값을 가져오겠다는 의미 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 컨테이너 상태 확인을 통해 롤링업데이트 최적화 </span></span><br><span class="line">readinessProbe:</span><br><span class="line">  httpGet:</span><br><span class="line"><span class="code">    # healthcheck 경로</span></span><br><span class="line"><span class="code">    path: /health</span></span><br><span class="line"><span class="code">    port: 8080</span></span><br><span class="line"><span class="code">  # 컨테이너 시작 후 지연</span></span><br><span class="line"><span class="code">  initialDelaySeconds: 10</span></span><br><span class="line"><span class="code">  # 확인 반복 주기</span></span><br><span class="line"><span class="code">  periodSeconds: 10</span></span><br></pre></td></tr></table></figure>
<p><code>readinessProbe</code> 경우는 앞써 설명 한 <code>롤링 업데이트</code> 통해 배포 한다고 말씀드렸습니다. 배포 진행시 새로운 <code>Pod</code> 가 생성 되면 기존 <code>Pod</code> 를 삭제 하는데요. 하지만 새로운 <code>Pod</code> 를 진행 하자 마자 기존 <code>Pod</code> 를 삭제하는 것은 위험한 행동 입니다.</p>
<p>예를들어 <code>Spring Boot</code> 를 서버를 띄우지만 초기화 하는 과정에서 아직 준비 중인데 기존 <code>Pod</code> 를 삭제하면 정상적인 <code>Graceful Shutdown</code> 진행 되지 않습니다. 이를 해결하기 위해서는 <code>Spring Boot</code> 프로젝트 내에 새로운 <code>Pod</code> 생성한 프로세스에서 <code>/health</code> API 통해서 정상적으로 응답이 오면 기존 <code>Pod</code> 를 삭제 하겠다는 설정 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;프로젝트 디렉토리 이동&#125;</span><br><span class="line">kubectl apply -f ./depl<span class="emphasis">_svc.yml</span></span><br><span class="line"><span class="emphasis">kubectl get pod -n dev</span></span><br></pre></td></tr></table></figure>

<p>이제 <code>Deployment</code> 를 Apply 해봅시다. 미리 만들어진 <code>depl_svc.yml</code> 파일 이용해서 <code>Deployment</code> 를 Apply 합니다. </p>
<h4 id="Ingress-Apply-하기"><a href="#Ingress-Apply-하기" class="headerlink" title="Ingress Apply 하기"></a>Ingress Apply 하기</h4><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/INGRESS_CONTROLLER_DEPLOY_1-1.png" alt="INGRESS_CONTROLLER_DEPLOY_1-1"></p>
<p>앞써 <code>Ingress</code> 설명 관련해서 </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.1/deploy/static/provider/aws/deploy.yaml</span><br></pre></td></tr></table></figure>

<p><code>Ingress Controller</code> 설치를 미래 해야 합니다. 이때 동시에 <code>AWS LB</code> 도 등록 하게 됩니다. AWS 에 가서 <code>Route53</code> 하고 등록된 <code>LB</code> 하고 매핑 작업이 필요 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/ROUTE53_RECODE_CREATE_1-1.png" alt="ROUTE53_RECODE_CREATE_1-1"></p>
<p><code>AWS Route53</code> 접속해서 특정 Prefix 도메인을 생성된 LB 로 매핑 작업을 하도록 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: order-backend-ingress</span><br><span class="line">  namespace: dev</span><br><span class="line">  annotations:</span><br><span class="line"><span class="code">    kubernetes.io/ingress.class: nginx</span></span><br><span class="line"><span class="code">    cert-manager.io/cluster-issuer: my-issuer</span></span><br><span class="line"><span class="code">spec:</span></span><br><span class="line"><span class="code">  tls:</span></span><br><span class="line"><span class="code">  - hosts:</span></span><br><span class="line"><span class="code">    - &quot;server.syh8088.store&quot;</span></span><br><span class="line"><span class="code">    # https설정시에 TLS 인증서가 저장된 certificate의 Secret의 이름(spec.secretName)을 지정</span></span><br><span class="line"><span class="code">    secretName: server-syh8088-com-tls</span></span><br><span class="line"><span class="code">  rules:</span></span><br><span class="line"><span class="code">  - host: server.syh8088.store</span></span><br><span class="line"><span class="code">    http:</span></span><br><span class="line"><span class="code">      paths:</span></span><br><span class="line"><span class="code">      - path: / #모든 url요청을 service로 라우팅</span></span><br><span class="line"><span class="code">        pathType: Prefix</span></span><br><span class="line"><span class="code">        backend:</span></span><br><span class="line"><span class="code">          service:</span></span><br><span class="line"><span class="code">            name: project-backend-service</span></span><br><span class="line"><span class="code">            port:</span></span><br><span class="line"><span class="code">              number: 80</span></span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  tls:</span><br><span class="line"><span class="bullet">  -</span> hosts:</span><br><span class="line"><span class="bullet">    -</span> &quot;$&#123;생성한 도메인&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>생성한 도메인을 등록 하도록 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http:</span><br><span class="line">  paths:</span><br><span class="line"><span class="bullet">  -</span> path: / #모든 url요청을 service로 라우팅</span><br><span class="line"><span class="code">    pathType: Prefix</span></span><br><span class="line"><span class="code">    backend:</span></span><br><span class="line"><span class="code">      service:</span></span><br><span class="line"><span class="code">        name: project-backend-service</span></span><br><span class="line"><span class="code">        port:</span></span><br><span class="line"><span class="code">          number: 80</span></span><br></pre></td></tr></table></figure>
<p>모든 요청을 <code>Deployment</code> 에서 설정한 <code>project-backend-service</code> 로 보내겠다는 의미 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  tls:</span><br><span class="line"><span class="bullet">  -</span> hosts:</span><br><span class="line"><span class="bullet">    -</span> &quot;server.syh8088.store&quot;</span><br><span class="line"><span class="code">    # https설정시에 TLS 인증서가 저장된 certificate의 Secret의 이름(spec.secretName)을 지정</span></span><br><span class="line"><span class="code">    secretName: server-syh8088-com-tls</span></span><br></pre></td></tr></table></figure>
<p>이 부분은 SSL 인증 관련해서 설명 할때 다시 설명 하도록 하겠습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;프로젝트 디렉토리 이동&#125;</span><br><span class="line">kubectl apply -f ./ingress.yml</span><br><span class="line">kubectl get pod -A</span><br></pre></td></tr></table></figure>

<p><code>Ingress</code> 를 Apply 하는 명령어 입니다. 진행 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/KUBE_APPLY_ingress_1-1.png" alt="KUBE_APPLY_ingress_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout restart deployment project-backend -n dev</span><br><span class="line">kubectl get pods -n syh</span><br></pre></td></tr></table></figure>
<p>이제 <code>rollout restart</code> 명령어를 통해서 정상적으로 롤링 업데이트가 진행 되는지 체크 해봅니다.</p>
<h3 id="HTTPS-통신-인증서-작업"><a href="#HTTPS-통신-인증서-작업" class="headerlink" title="HTTPS 통신 인증서 작업"></a>HTTPS 통신 인증서 작업</h3><p>사용자가 로그인 하는 과정에서 아이디 및 패스워드를 입력해서 HTTP 요청을 하게 되면 중간에 요청 데이터를 가로채서 패스워드를 노출 되는 이슈가 발생됩니다. <code>HTTPS</code> 는 ISO Layer 7 에서 요청 데이터를 암호화 해서 이를 해당 서버까지 요청 데이터를 도착 한 후 복호화 해서 처리 하도록 해줍니다. 이를 가능 하기 위해서는 사용자가 로그인 하기전 브라우저 통해 서버로 부터 특정 암호화 키값을 전달 받게 됩니다. 그럼 특정 브라우저는 요청 할때 마다 데이터를 암호화 해서 서버로 전달하게 되고 이를 서버가 미리 준비된 복호화 키로 복호화 해서 처리 하게 됩니다. 이러한 흐름을 <code>HTTPS 통신</code> 이라고 합니다. </p>
<p>즉 서버로 부터 암호화 키값을 전달 받는데 이것을 <code>SSL(TSL) 인증서</code> 라고 합니다. HTTPS 통신이 가능하게 하기 위해서 우선 앞서 설명한 것 처럼 특정 서버가 클라이언트에게 인증서 (암호화 할 수 있는 공개키) 를 전달 하는데 이 인증서는 <code>인증된 기관 CA</code> 에서 발급 받게 됩니다.   </p>
<p>우선 <code>인증된 기관 CA</code> 를 발급 받는 과정을 실습 하도록 하겠습니다. </p>
<h4 id="인증서-발급"><a href="#인증서-발급" class="headerlink" title="인증서 발급"></a>인증서 발급</h4><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/NAMESPACE_CREATE_cert-manager_1-1.png" alt="NAMESPACE_CREATE_cert-manager_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## cert-manager를 위한 namespace 생성</span></span><br><span class="line">kubectl create namespace cert-manager</span><br></pre></td></tr></table></figure>
<p>우선 <code>cert-manager</code> 이라는 namespace 를 생성 하도록 합니다.</p>
<ul>
<li>우리 서버에서 공개키와 비밀키를 생성</li>
<li>공개키와 서버 정보로 CSR(인증서서명요청서)를 생성</li>
<li>CA(인증기관)에 CSR을 제출한 후에, CA에서 도메인 소유 여부를 검증한 후에 디지털 서명을 하여 우리 서버로 인증서를 발급</li>
</ul>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/KUBE_APPLY_cert-manager-CRDs_1-1.png" alt="KUBE_APPLY_cert-manager-CRDs_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## cert-manager CRDs 설치</span></span><br><span class="line">kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.5.0/cert-manager.crds.yaml</span><br></pre></td></tr></table></figure>

<p><code>cert-manager</code>가 제대로 작동하기 위한 기반 구조 구성 하게 됩니다. 자세히 말하자면 어떤 인증서를 발급 받기 위한 어떤 <code>CA</code> 선택 할 것인가 그리고 선택하고 해당 CA 에게 미리 공개키 및 비밀키를 생성 한 것 중 공개키 하고 사용하고자 하는 도메인 정보 등 CA 에게 전송 하게 됩니다.</p>
<p>그럼 CA 는 이를 확인 하기 위해 요청 한 도메인이 실제로 존재하는지 검증 하게 되는데 정상적으로 검증 되면 최종적으로 <code>인증서</code> 를 발급 받게 됩니다.</p>
<p>이러한 과정은 하나 하나씩 작업을 할 필요 없고 <code>cert-manager CRDs</code> 설치 통해 모든 일련의 과정을 해결 할 수 있습니다. 해당 명령어를 통해 자원을 설치 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/KUBE_APPLY_cert-manager_deploy_1-1.png" alt="KUBE_APPLY_cert-manager_deploy_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## cert-manager 배포</span></span><br><span class="line"><span class="section">## cert-manager 컨트롤러 자체(Pod, Deployment 등)를 설치</span></span><br><span class="line">kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.5.0/cert-manager.yaml</span><br></pre></td></tr></table></figure>

<p>실질적인 <code>cert-manager</code> 컨트롤러 자체(Pod, Deployment 등) 설치 하도록 합니다.</p>
<h4 id="https-yml-내용-보기"><a href="#https-yml-내용-보기" class="headerlink" title="https.yml 내용 보기"></a>https.yml 내용 보기</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: cert-manager.io/v1</span><br><span class="line">kind: ClusterIssuer</span><br><span class="line">metadata:</span><br><span class="line">  name: my-issuer</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  acme:</span><br><span class="line">  # ca 서버 주소. 해당 서버를 통해 인증서 발행</span><br><span class="line"><span class="code">    server: https://acme-v02.api.letsencrypt.org/directory</span></span><br><span class="line"><span class="code">  # 인증서 만료 또는 갱신 필요시 알람 email</span></span><br><span class="line"><span class="code">    email: $&#123;본인 이메일&#125;</span></span><br><span class="line"><span class="code">    privateKeySecretRef:</span></span><br><span class="line"><span class="code">    # 인증서를 발급받기 위해 ca와 통신시에 사용되는 Secret 이름</span></span><br><span class="line"><span class="code">      name: my-issuer</span></span><br><span class="line"><span class="code">    solvers:</span></span><br><span class="line"><span class="code">    - http01:</span></span><br><span class="line"><span class="code">        ingress:</span></span><br><span class="line"><span class="code">        # 도메인의 소유권을 확인하기 위해 cert-manager는 nginx기반의 ingress controller를 활용해 검증한다는 의미</span></span><br><span class="line"><span class="code">          class: nginx</span></span><br><span class="line"><span class="code">---</span></span><br><span class="line"><span class="code">apiVersion: cert-manager.io/v1</span></span><br><span class="line"><span class="code">kind: Certificate</span></span><br><span class="line"><span class="code">metadata:</span></span><br><span class="line"><span class="code">  name: server-syh8088-com-tls</span></span><br><span class="line"><span class="code">  namespace: dev</span></span><br><span class="line"><span class="code">spec:</span></span><br><span class="line"><span class="code"># cert-manager가 아래 secretName에서 지정한 이름으로 Secret을 생성</span></span><br><span class="line"><span class="code">  secretName: server-syh8088-com-tls</span></span><br><span class="line"><span class="code">  duration: 2160h #90day</span></span><br><span class="line"><span class="code">  renewBefore: 360h #before 15day</span></span><br><span class="line"><span class="code">  issuerRef:</span></span><br><span class="line"><span class="code">  # ClusterIssuer의 이름을 참조</span></span><br><span class="line"><span class="code">    name: my-issuer</span></span><br><span class="line"><span class="code">    kind: ClusterIssuer</span></span><br><span class="line"><span class="code">  commonName: server.syh8088.store</span></span><br><span class="line"><span class="code">  dnsNames:</span></span><br><span class="line"><span class="code">  # 추가적인 서브도메인을 추가하고 싶은경우에 여기에 나열</span></span><br><span class="line"><span class="code">  - server.syh8088.store</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  acme:</span><br><span class="line">  # ca 서버 주소. 해당 서버를 통해 인증서 발행</span><br><span class="line"><span class="code">    server: https://acme-v02.api.letsencrypt.org/directory</span></span><br></pre></td></tr></table></figure>
<p>어떤 CA 기관에서 인증서 발급 받을 것인지 설정 합니다. 여기서는 <code>letsencrypt</code> 이라는 기관에서 인증서를 발급 받습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  acme:</span><br><span class="line">  # 인증서 만료 또는 갱신 필요시 알람 email</span><br><span class="line"><span class="code">    email: syh8088@naver.com</span></span><br><span class="line"><span class="code">    privateKeySecretRef:</span></span><br><span class="line"><span class="code">    # 인증서를 발급받기 위해 ca와 통신시에 사용되는 Secret 이름</span></span><br><span class="line"><span class="code">      name: my-issuer</span></span><br><span class="line"><span class="code">    solvers:</span></span><br><span class="line"><span class="code">    - http01:</span></span><br><span class="line"><span class="code">        ingress:</span></span><br><span class="line"><span class="code">        # 도메인의 소유권을 확인하기 위해 cert-manager는 nginx기반의 ingress controller를 활용해 검증한다는 의미</span></span><br><span class="line"><span class="code">          class: nginx</span></span><br></pre></td></tr></table></figure>
<p><code>spec.acme.email</code>: 인증서 만료 또는 갱신 필요시 알람 email 을 설정 하도록 합니다.<br><code>spec.acme.privateKeySecretRef.name</code>: 인증서를 발급받기 위해 ca와 통신시에 사용되는 Secret 이름 입니다.<br><code>spec.acme.solvers.http01.ingress.class</code>: 도메인의 소유권을 확인하기 위해 cert-manager는 nginx기반의 ingress controller를 활용해 검증한다는 의미</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: cert-manager.io/v1</span><br><span class="line">kind: Certificate</span><br><span class="line">metadata:</span><br><span class="line">  name: server-syh8088-com-tls</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line"><span class="section"># cert-manager가 아래 secretName에서 지정한 이름으로 Secret을 생성</span></span><br><span class="line">  secretName: server-syh8088-com-tls</span><br><span class="line">  duration: 2160h #90day</span><br><span class="line">  renewBefore: 360h #before 15day</span><br><span class="line">  issuerRef:</span><br><span class="line">  # ClusterIssuer의 이름을 참조</span><br><span class="line"><span class="code">    name: my-issuer</span></span><br><span class="line"><span class="code">    kind: ClusterIssuer</span></span><br><span class="line"><span class="code">  commonName: server.syh8088.store</span></span><br><span class="line"><span class="code">  dnsNames:</span></span><br><span class="line"><span class="code">  # 추가적인 서브도메인을 추가하고 싶은경우에 여기에 나열</span></span><br><span class="line"><span class="code">  - server.syh8088.store</span></span><br></pre></td></tr></table></figure>
<p><code>spec.secretName</code>: cert-manager가 아래 secretName에서 지정한 이름으로 Secret을 생성 합니다. 중요한 것은 <code>Ingress.yml</code> 에서 <code>spec.tls.- hosts.secretName</code> 에서 설정한 값하고 동일 해야 합니다.<br><code>spec.commonName</code>: 대표하는 도메인 이름 입니다.<br><code>spec.dnsNames</code>: 추가적인 서브도메인을 추가하고 싶은경우에 여기에 나열 하도록 합니다. 예를들어 <code>admin.syh8088.store</code> 이라는 서브도메인도 추가 하고 싶으면 추가 하면 됩니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/KUBE_APPLY_https_1-1.png" alt="KUBE_APPLY_https_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## 인증서 요청 명령어</span></span><br><span class="line">cd $&#123;프로젝트 디렉토리&#125;</span><br><span class="line">kubectl apply -f ./https.yml</span><br></pre></td></tr></table></figure>
<p><code>https.yml</code> apply 하게 되면 <code>cert-manager</code> 가 이 두 자원의 정보를 보면서 CA 기관의 인증서를 요청하게 됩니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl get certificate -n dev</span><br><span class="line"></span><br><span class="line">결과 -&gt;</span><br><span class="line">NAME                    READY   SECRET                  AGE</span><br><span class="line">server-syh8088-com-tls  True    server-syh8088-com-tls  18m</span><br></pre></td></tr></table></figure>
<p><code>certificate</code> 조회 하도록 합니다. <code>READY</code> 에서 <code>True</code> 가 나오면 정상적으로 SSL 인증이 완료 되었다는 의미 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret -A</span><br></pre></td></tr></table></figure>
<p>정상적으로 <code>server-syh8088-com-tls</code> 이라는 시크릿 자원이 생성 되는지도 확인 해봅니다.</p>
<p>이제부터 <code>HTTPS</code> 통신이 가능하게 됩니다.</p>
<h3 id="Github-Actions-을-이용해서-CI-CD-자동화-배포-하기"><a href="#Github-Actions-을-이용해서-CI-CD-자동화-배포-하기" class="headerlink" title="Github Actions 을 이용해서 CI&#x2F;CD 자동화 배포 하기"></a>Github Actions 을 이용해서 CI&#x2F;CD 자동화 배포 하기</h3><p><code>GitHub Actions</code>는 <code>GitHub</code> 에서 제공하는 직접 <code>CI/CD</code> 파이프라인을 자동화 할 수 있는 기능 입니다. <code>GitHub Actions</code> 경우는 <code>Workflows</code> 이라는 개념이 있습니다. <code>Workflows</code> 는 하나 이상의 <code>Job</code> 포함 하게 되는데 특정 브랜치에 <code>Git Push</code> 를 하게 된다면 <code>Workflows</code> 에서 정의된 <code>Job</code> 이 실행 하게 됩니다.</p>
<p><code>Workflows</code> 정의 하는 방법은 <code>.github/workflows</code> 디렉토리에 <code>YAML</code> 형식의 파일로 저장 해야 합니다. 그럼 <code>deploy_dev_project_with_k8s.yml</code> 파일을 확인 해보도록 하겠습니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">name: deploy DEV backend</span><br><span class="line"></span><br><span class="line">on:</span><br><span class="line">  push:</span><br><span class="line"><span class="code">    branches:</span></span><br><span class="line"><span class="code">      - dev</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">jobs:</span><br><span class="line">  build-and-deploy:</span><br><span class="line"><span class="code">    runs-on: ubuntu-latest</span></span><br><span class="line"><span class="code">    steps:</span></span><br><span class="line"><span class="code">      - name: checkout github</span></span><br><span class="line"><span class="code">        uses: actions/checkout@v2</span></span><br><span class="line"><span class="code">      </span></span><br><span class="line"><span class="code">      - name: install kubectl</span></span><br><span class="line"><span class="code">        uses: azure/setup-kubectl@v3</span></span><br><span class="line"><span class="code">        with:</span></span><br><span class="line"><span class="code">          version: &quot;v1.25.9&quot;</span></span><br><span class="line"><span class="code">        id: install</span></span><br><span class="line"><span class="code">        </span></span><br><span class="line"><span class="code">      - name: configure aws</span></span><br><span class="line"><span class="code">        uses: aws-actions/configure-aws-credentials@v1</span></span><br><span class="line"><span class="code">        with:</span></span><br><span class="line"><span class="code">          aws-access-key-id: $&#123;&#123; secrets.AWS_KEY &#125;&#125;</span></span><br><span class="line"><span class="code">          aws-secret-access-key:  $&#123;&#123; secrets.AWS_SECRET &#125;&#125;</span></span><br><span class="line"><span class="code">          aws-region: ap-northeast-2</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: update cluster infomation</span><br><span class="line"><span class="code">        run: aws eks update-kubeconfig --name eks_syh --region ap-northeast-2</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: Login to ECR</span><br><span class="line"><span class="code">        id: login-ecr</span></span><br><span class="line"><span class="code">        uses: aws-actions/amazon-ecr-login@v1</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: build and push docker image to ecr</span><br><span class="line"><span class="code">        env:</span></span><br><span class="line"><span class="code">          REGISTRY: 057026365119.dkr.ecr.ap-northeast-2.amazonaws.com</span></span><br><span class="line"><span class="code">          REPOSITORY: eks-syh-spring-ci-cd</span></span><br><span class="line"><span class="code">          IMAGE_TAG: latest</span></span><br><span class="line"><span class="code">        run: |</span></span><br><span class="line"><span class="code">          docker build \</span></span><br><span class="line"><span class="code">          -t $REGISTRY/$REPOSITORY:$IMAGE_TAG \</span></span><br><span class="line"><span class="code">          -f ./Dockerfile .</span></span><br><span class="line"><span class="code">          docker push $REGISTRY/$REPOSITORY:$IMAGE_TAG</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: eks kubectl apply</span><br><span class="line"><span class="code">        run: |</span></span><br><span class="line"><span class="code">          kubectl rollout restart deployment project-backend -n dev</span></span><br></pre></td></tr></table></figure>


<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">on:</span><br><span class="line">  push:</span><br><span class="line"><span class="code">    branches:</span></span><br><span class="line"><span class="code">      - dev</span></span><br></pre></td></tr></table></figure>
<p><code>on.push.branches</code>: 특정 어떤 브랜치로 <code>push</code> 해야 <code>Workflows</code> 실행 한 것인지 설정 하는 구간 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build-and-deploy:</span><br><span class="line"><span class="code">    runs-on: ubuntu-latest</span></span><br></pre></td></tr></table></figure>

<p><code>jobs.build-and-deploy.runs-on</code>: <code>CI/CD</code> 작업이 이루어지는 서버 환경 셋팅 부분 입니다. 지금 우리가 특정 프로젝트를 <code>Bulid</code> 를 진행하고 <code>docker image</code> 를 만든 다음에 <code>AWS ECR Repository</code> 에 등록 하는 작업이 필요합니다. 이러한 일련의 작업을 수행하기 위한 가상 서버 환경을 GitHub 에서 제공 해주는데 어떤 OS 로 셋팅 하겠는가 설정 하는 부분 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build-and-deploy:</span><br><span class="line"><span class="code">    runs-on: ubuntu-latest</span></span><br><span class="line"><span class="code">    steps:</span></span><br><span class="line"><span class="code">      - name: checkout github</span></span><br><span class="line"><span class="code">        uses: actions/checkout@v2</span></span><br><span class="line"><span class="code">      </span></span><br><span class="line"><span class="code">      - name: install kubectl</span></span><br><span class="line"><span class="code">        uses: azure/setup-kubectl@v3</span></span><br><span class="line"><span class="code">        with:</span></span><br><span class="line"><span class="code">          version: &quot;v1.25.9&quot;</span></span><br><span class="line"><span class="code">        id: install</span></span><br></pre></td></tr></table></figure>

<p><code>GitHub</code> 에서 제공하는 가상 서버에 <code>actions/checkout@v2</code> 명령어를 통해서 해당 프로젝트를 <code>Git Clone</code> 하겠다는 의미 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build-and-deploy:</span><br><span class="line"><span class="code">    runs-on: ubuntu-latest</span></span><br><span class="line"><span class="code">    steps:</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: install kubectl</span><br><span class="line"><span class="code">        uses: azure/setup-kubectl@v3</span></span><br><span class="line"><span class="code">        with:</span></span><br><span class="line"><span class="code">          version: &quot;v1.25.9&quot;</span></span><br><span class="line"><span class="code">        id: install</span></span><br></pre></td></tr></table></figure>
<p><code>azure/setup-kubectl@v3</code> 명령어를 통해서 <code>GitHub</code> 에서 제공하는 가상 서버에 kubectl 설치 하겠다는 의미 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build-and-deploy:</span><br><span class="line"><span class="code">    runs-on: ubuntu-latest</span></span><br><span class="line"><span class="code">    steps:</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: configure aws</span><br><span class="line"><span class="code">        uses: aws-actions/configure-aws-credentials@v1</span></span><br><span class="line"><span class="code">        with:</span></span><br><span class="line"><span class="code">          aws-access-key-id: $&#123;&#123; secrets.AWS_KEY &#125;&#125;</span></span><br><span class="line"><span class="code">          aws-secret-access-key:  $&#123;&#123; secrets.AWS_SECRET &#125;&#125;</span></span><br><span class="line"><span class="code">          aws-region: ap-northeast-2</span></span><br></pre></td></tr></table></figure>
<p><code>aws-actions/configure-aws-credentials@v1</code> 명령어를 수행 하게 되면 <code>AWS CLI</code> 설치 및  <code>Configure</code> 계정 셋팅 하겠다는 의미 입니다. 계정 셋팅시 <code>GitHub</code> 에서 제공하는 가상 서버에 해당 AWS 자원에 접근 하기 위한 <code>ACCESS-KEY</code> 및 <code>SECRET</code> 값을 가져와서 계정 셋팅을 하게 되는데요. 변수로 지정된 secrets 값은 나중에 설명 하겠지만 GitHub <code>Secrets and variables</code> 페이지에서 미리 셋팅 해야 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build-and-deploy:</span><br><span class="line"><span class="code">    runs-on: ubuntu-latest</span></span><br><span class="line"><span class="code">    steps:</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: update cluster infomation</span><br><span class="line"><span class="code">        run: aws eks update-kubeconfig --name $&#123;AWS EKS kubernetes Cluster 이름&#125; --region ap-northeast-2</span></span><br></pre></td></tr></table></figure>
<p><code>aws eks update-kubeconfig</code> 명령어를 이용해서 해당 <code>AWS EKS kubernetes Cluster 이름</code> 으로 접근 하겠다는 의미 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build-and-deploy:</span><br><span class="line"><span class="code">    runs-on: ubuntu-latest</span></span><br><span class="line"><span class="code">    steps:</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: Login to ECR</span><br><span class="line"><span class="code">        id: login-ecr</span></span><br><span class="line"><span class="code">        uses: aws-actions/amazon-ecr-login@v1</span></span><br></pre></td></tr></table></figure>
<p><code>docker image</code> 만들고 <code>image</code> 를 <code>AWS ECR Repository</code> 에 등록하기 위해서는 <code>AWS ECR</code> 로그인 작업도 필요합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build-and-deploy:</span><br><span class="line"><span class="code">    runs-on: ubuntu-latest</span></span><br><span class="line"><span class="code">    steps:</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: build and push docker image to ecr</span><br><span class="line"><span class="code">        env:</span></span><br><span class="line"><span class="code">          REGISTRY: $&#123;AWC ECR Repository 주소&#125;</span></span><br><span class="line"><span class="code">          REPOSITORY: $&#123;AWC ECR Repository 이름명&#125;</span></span><br><span class="line"><span class="code">          IMAGE_TAG: latest</span></span><br><span class="line"><span class="code">        run: |</span></span><br><span class="line"><span class="code">          docker build \</span></span><br><span class="line"><span class="code">          -t $REGISTRY/$REPOSITORY:$IMAGE_TAG \</span></span><br><span class="line"><span class="code">          -f ./Dockerfile .</span></span><br><span class="line"><span class="code">          docker push $REGISTRY/$REPOSITORY:$IMAGE_TAG</span></span><br></pre></td></tr></table></figure>
<p><code>Dockerfile</code> 파일을 이용해서 <code>docker image</code> 만들고 이것을 <code>AWS ECR</code> 지정된 Repository 에 push 하겠다는 의미 입니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">jobs:</span><br><span class="line">  build-and-deploy:</span><br><span class="line"><span class="code">    runs-on: ubuntu-latest</span></span><br><span class="line"><span class="code">    steps:</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">      -</span> name: eks kubectl apply</span><br><span class="line"><span class="code">        run: |</span></span><br><span class="line"><span class="code">          kubectl rollout restart deployment project-backend -n dev</span></span><br></pre></td></tr></table></figure>

<p><code>AWS ECR</code> 에 등록된 <code>docker image</code> 에 당겨와서 <code>docker image</code> 기반으로 <code>Replicaset 및 Pod</code> 를 생성 하겠다는 의미 입니다.</p>
<h4 id="github-secret-에-중요-정보-추가-방법"><a href="#github-secret-에-중요-정보-추가-방법" class="headerlink" title="github secret 에 중요 정보 추가 방법"></a>github secret 에 중요 정보 추가 방법</h4><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GITHUB_SECRET_SETTING_1-1.png" alt="GITHUB_SECRET_SETTING_1-1"></p>
<p>GitHub 해당 프로젝트 접속 하셔서 <code>Settings</code> 페이지에 왼쪽 메뉴에서 <code>Secrets and variables</code> -&gt; <code>Actions</code> 접근 하도록 합니다. </p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GITHUB_SECRET_SETTING_1-2.png" alt="GITHUB_SECRET_SETTING_1-2"></p>
<p><code>New repository secret</code> 버튼을 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GITHUB_SECRET_SETTING_1-3.png" alt="GITHUB_SECRET_SETTING_1-3"></p>
<p>Name 에 <code>AWS_KEY</code> 이라는 이름을 지정하고 Secret 값에는 AWS Access-Key 값을 입력하고 <code>Add secret</code> 버튼을 클릭 합니다. </p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GITHUB_SECRET_SETTING_1-4.png" alt="GITHUB_SECRET_SETTING_1-4"></p>
<p>Name 에 <code>AWS_SECRET</code> 이라는 이름을 지정하고 Secret 값에는 AWS Secret 값을 입력하고 <code>Add secret</code> 버튼을 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-1.png" alt="GIT_HUB_Actions_Deploy_1-1"></p>
<p>한번 특정 브랜치를 <code>Git Push</code> 를 하도록 합니다. 그럼 자동으로 <code>Workflows</code> 실행 하게 됩니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-2.png" alt="GIT_HUB_Actions_Deploy_1-2"></p>
<h4 id="실제로-CI-CD-및-롤링-업데이트-진행-되는지-확인-해보기"><a href="#실제로-CI-CD-및-롤링-업데이트-진행-되는지-확인-해보기" class="headerlink" title="실제로 CI&#x2F;CD 및 롤링 업데이트 진행 되는지 확인 해보기"></a>실제로 CI&#x2F;CD 및 롤링 업데이트 진행 되는지 확인 해보기</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod -n $&#123;네임스페이스명&#125;</span><br></pre></td></tr></table></figure>
<p><code>Pod</code> 조회를 하게된다면 <code>Pod</code> 설치가 얼마 안된 것을 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-3.png" alt="GIT_HUB_Actions_Deploy_1-3"></p>
<p>이번에 해당 스프링 부트 프로젝트 에서 <code>HealthController</code> 파일에서 <code>health</code> API 응답을 <code>ok3</code> 로 변경 해서 다시 push 하도록 하겠습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-4.png" alt="GIT_HUB_Actions_Deploy_1-4"></p>
<p>즉시 <code>Pod</code> 조회를 하게된다면 정상적으로 <code>롤링업데이트</code> 가 진행 되는 것을 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-5.png" alt="GIT_HUB_Actions_Deploy_1-5"></p>
<p>Github Workflows 페이지에 접속하면 정상적으로 성공 했다고 나옵니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-6.png" alt="GIT_HUB_Actions_Deploy_1-6"></p>
<p>지속적으로 <code>Pod</code> 를 조회 하게 된다면 새로운 <code>Pod</code> 가 생성 되기 전까지 기존 <code>Pod</code> 는 계속 살아 있고 새로운 <code>Pod</code> 가 최종 생성 되면 기존 <code>Pod</code> 는 삭제 되는 것을 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/GIT_HUB_Actions_Deploy_1-7.png" alt="GIT_HUB_Actions_Deploy_1-7"></p>
<p><code>https//server.syh8088.store/health</code> API 호출하면 수정한 응답값 <code>ok3</code> 로 나타나는 것을 확인 할 수 있습니다.</p>
<h3 id="Autoscaling-Pod-자동-확장-작업"><a href="#Autoscaling-Pod-자동-확장-작업" class="headerlink" title="Autoscaling - Pod 자동 확장 작업"></a>Autoscaling - Pod 자동 확장 작업</h3><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling-pod.webp" alt="Autoscaling Horizontal Pod Autoscaler (HPA) 설명 POD 출처: https://www.apptio.com/topics/kubernetes/autoscaling/horizontal/"></p>
<p><code>Kubernetes</code> 에서 <code>Deployment</code> 의 <code>Autoscaling</code> 설정 하기 위해서 <code>Horizontal Pod Autoscaler (HPA)</code> 이라는 자원을 사용 하게 됩니다. <code>Horizontal Pod Autoscaler (HPA)</code> 이란 CPU 사용량 등 사용자 정의 파라미터에 기반하여 파드의 수를 자동으로 조정 기능 입니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling-pod2.webp" alt="Autoscaling HPA 동작 원리 출처: https://www.apptio.com/topics/kubernetes/autoscaling/horizontal/"></p>
<p><code>Autoscaling</code> 동작 원리는 우선  <code>메트릭 서버</code> 는 <code>HPA</code> 에서 관리 되는 <code>Pod</code> 를 계속 모니터링 하게 됩니다. 모니터링 한 데이터를 <code>HPA</code> 에게 보고 하게 되는데요. 계속 주시하고 있다가 <code>HPA</code> 는 특정 서버가 최소 및 최대 임계치 설정을 관리 하고 있어서 <code>모니터링 서버</code> 로부터 받은 서버 자원 사용률 한계치가 넘어가게 된다면 <code>Deployment</code> 에게 <code>Pod</code> 를 더 늘리라고 명령을 내리게 됩니다. 그럼 <code>Deployment</code> 는 <code>Pod</code> 를 더 생성하게 됩니다.</p>
<p>적용하는 단계는 크게 3가지로 구분 할 수 있습니다.</p>
<ol>
<li>Deployment 설정</li>
<li>메트릭 서버 설치</li>
<li>HPA 스크립트 생성 후 적용</li>
</ol>
<p>하나하나씩 알아보도록 하겠습니다.</p>
<h4 id="Autoscaling-Pod-자동-확장-작업-Deployment-설정"><a href="#Autoscaling-Pod-자동-확장-작업-Deployment-설정" class="headerlink" title="Autoscaling - Pod 자동 확장 작업 - Deployment 설정"></a>Autoscaling - Pod 자동 확장 작업 - Deployment 설정</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;프로젝트 ROOT 디렉토리&#125;\k8s\k8s-project</span><br></pre></td></tr></table></figure>
<p>depl_svc.yml 파일을 확인 및 수정 하기 위해 <code>depl_svc.yml</code> 파일을 열어봅시다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">## depl<span class="emphasis">_svc.yml 파일</span></span></span><br><span class="line"><span class="emphasis"><span class="section">apiVersion: apps/v1</span></span></span><br><span class="line"><span class="emphasis"><span class="section">kind: Deployment</span></span></span><br><span class="line"><span class="emphasis"><span class="section">metadata:</span></span></span><br><span class="line"><span class="emphasis"><span class="section">  name: project-backend</span></span></span><br><span class="line"><span class="emphasis"><span class="section">  namespace: dev</span></span></span><br><span class="line"><span class="emphasis"><span class="section">spec:</span></span></span><br><span class="line"><span class="emphasis"><span class="section"># Deployment나 StatefulSet이 유지할 &quot;옛날 ReplicaSet&quot;의 수를 제한하는 옵션. 자원공간의 낭비 방지 및 관리의 편의성.</span></span></span><br><span class="line"><span class="emphasis"><span class="section">  revisionHistoryLimit: 2</span></span></span><br><span class="line"><span class="emphasis"><span class="section">  replicas: 2</span></span></span><br><span class="line"><span class="emphasis"><span class="section">  selector:</span></span></span><br><span class="line"><span class="emphasis"><span class="section">    matchLabels:</span></span></span><br><span class="line"><span class="emphasis"><span class="section">     app: project-backend</span></span></span><br><span class="line"><span class="emphasis"><span class="section">    ... (생략) ...</span></span></span><br><span class="line"><span class="emphasis"><span class="section">    spec:</span></span></span><br><span class="line"><span class="emphasis"><span class="section">      containers:</span></span></span><br><span class="line"><span class="emphasis"><span class="section">      - name: project-backend</span></span></span><br><span class="line"><span class="emphasis"><span class="section">        image: 057026365119.dkr.ecr.ap-northeast-2.amazonaws.com/eks-syh-spring-ci-cd:latest</span></span></span><br><span class="line"><span class="emphasis"><span class="section">        ports:</span></span></span><br><span class="line"><span class="emphasis"><span class="section">        - containerPort: 8080</span></span></span><br><span class="line"><span class="emphasis"><span class="section">        resources:</span></span></span><br><span class="line"><span class="emphasis"><span class="section">        # 컨테이너가 사용할수 있는 리소스의 최대치</span></span></span><br><span class="line"><span class="emphasis"><span class="section">          limits:</span></span></span><br><span class="line"><span class="emphasis"><span class="section">            cpu: &quot;1&quot;</span></span></span><br><span class="line"><span class="emphasis"><span class="section">            memory: &quot;500Mi&quot;</span></span></span><br><span class="line"><span class="emphasis"><span class="section">        # 컨테이너가 시작될떄 보장받아야 하는 최소 자원</span></span></span><br><span class="line"><span class="emphasis"><span class="section">          requests:</span></span></span><br><span class="line"><span class="emphasis"><span class="section">            cpu: &quot;0.5&quot;</span></span></span><br><span class="line"><span class="emphasis"><span class="section">            memory: &quot;250Mi&quot;</span></span></span><br><span class="line"><span class="emphasis"><span class="section"></span></span></span><br><span class="line"><span class="emphasis"><span class="section">    ... (생략) ...</span></span></span><br></pre></td></tr></table></figure>

<p>해당 <code>Pod</code> 에 <code>resource</code> 사전 제한 설정 필요 합니다. 중요한 것은 <code>Pod</code> 가 생성 및 삭제 하는 과정에서 cpu 가 갑자기 튈수 있으므로 <code>HPA</code> 와 <code>resource limit</code> 의 Cpu 를 여유롭게 셋팅 해야 합니다.</p>
<h4 id="Autoscaling-Pod-자동-확장-작업-메트릭-서버-설치"><a href="#Autoscaling-Pod-자동-확장-작업-메트릭-서버-설치" class="headerlink" title="Autoscaling - Pod 자동 확장 작업 - 메트릭 서버 설치"></a>Autoscaling - Pod 자동 확장 작업 - 메트릭 서버 설치</h4><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-1.png" alt="autoscaling_prod_1-1"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## 메트릭 서버 설치</span></span><br><span class="line">kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span><br></pre></td></tr></table></figure>

<p><code>메트릭 서버</code>의 역할은 <code>HPA</code> 가 <code>Pod</code> 의 리소스 사용량을 지속적으로 모니터링하고 이를 기반으로 자동 확장을 수행할 수 있도록 필요한 메트릭 데이터를 제공 합니다. <code>메트릭 서버</code> 를 apply 하도록 합니다.</p>
<h4 id="Autoscaling-Pod-자동-확장-작업-HPA-스크립트-생성-후-적용"><a href="#Autoscaling-Pod-자동-확장-작업-HPA-스크립트-생성-후-적용" class="headerlink" title="Autoscaling - Pod 자동 확장 작업 - HPA 스크립트 생성 후 적용"></a>Autoscaling - Pod 자동 확장 작업 - HPA 스크립트 생성 후 적용</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## hpa.yml 설치</span></span><br><span class="line">cd $&#123;프로젝트 ROOT 디렉토리&#125;\k8s\k8s-project</span><br><span class="line">kubectl apply -f ./hpa.yml</span><br></pre></td></tr></table></figure>
<p><code>HPA</code> 를 apply 하도록 하겠습니다.</p>
<h5 id="hpa-yml-파일"><a href="#hpa-yml-파일" class="headerlink" title="hpa.yml 파일"></a>hpa.yml 파일</h5><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-2.png" alt="autoscaling_prod_1-2"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: autoscaling/v1</span><br><span class="line">kind: HorizontalPodAutoscaler</span><br><span class="line">metadata:</span><br><span class="line">  name: project-backend-hpa</span><br><span class="line">  namespace: dev</span><br><span class="line">spec: </span><br><span class="line">  scaleTargetRef:</span><br><span class="line"><span class="code">    apiVersion: apps/v1</span></span><br><span class="line"><span class="code">    kind: Deployment</span></span><br><span class="line"><span class="code">    name: project-backend</span></span><br><span class="line"><span class="code">  minReplicas: 2</span></span><br><span class="line"><span class="code">  maxReplicas: 4</span></span><br><span class="line"><span class="code">  targetCPUUtilizationPercentage: 50</span></span><br></pre></td></tr></table></figure>
<p><code>spec.scaleTargetRef.name</code>: <code>project-backend</code> 값으로 셋팅 하고 있는데 depl_svc.yml 파일에 <code>spec.selector.matchLabels</code> 이름하고 동일하게 매칭 해야 합니다.<br><code>spec.minReplicas</code>: <code>Pod</code> 갯수를 최소 2대로 유지 하겠다는 의미 입니다. 참고로 <code>depl_svc.yml</code> 파일에서 <code>spec.replicas</code> 값이 서로 틀리면 <code>hpa.yml</code> 파일에서 설정한 값이 더 우선권이 높습니다.<br><code>spec.maxReplicas</code>: <code>Pod</code> 갯수 최대 4대로 유지 하겠다는 의미 입니다.<br><code>spec.targetCPUUtilizationPercentage</code>: cpu 사용률이 50% 까지 점유하면 <code>Pod</code> 를 증가 하도록 하겠다는 의미 입니다.</p>
<h4 id="부하-테스트-통해-Pod-Autoscaling-되는지-확인-해보기"><a href="#부하-테스트-통해-Pod-Autoscaling-되는지-확인-해보기" class="headerlink" title="부하 테스트 통해 Pod Autoscaling 되는지 확인 해보기"></a>부하 테스트 통해 Pod Autoscaling 되는지 확인 해보기</h4><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-3.png" alt="autoscaling_prod_1-3"></p>
<p>첫번재 <code>CMD</code> 창을 실행해서 </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get hpa project-backend-hpa -n dev -w</span><br></pre></td></tr></table></figure>
<p>현재 <code>Pod</code> 자원 조회 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-4.png" alt="autoscaling_prod_1-4"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -n dev</span><br></pre></td></tr></table></figure>
<p>두번재 <code>CMD</code> 창을 실행해서 설치된 <code>Pod</code> 조회 합니다. </p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it &#123;Pod name&#125; -n dev -- /bin/sh # pod 접속</span><br></pre></td></tr></table></figure>
<p>2개 중 하나를 선택해서 해당 컨테이너로 <code>exec</code> 명령어를 이용해 접속 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-5.png" alt="autoscaling_prod_1-5"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apk add --no-cache curl # curl 설치</span><br></pre></td></tr></table></figure>
<p>서버부하를 위해서 미리 <code>curl</code> 설치를 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-6.png" alt="autoscaling_prod_1-6"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">while true; do curl -s http://project-backend-service/health; done</span><br></pre></td></tr></table></figure>
<p>실제로 while 문을 이용해서 <code>/health</code> API 를 계속 호출 시켜 강제로 서버부하를 일으키도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-7.png" alt="autoscaling_prod_1-7"></p>
<p>첫번째 <code>CMD</code> 창에서 계속 모니터링 해보면 지속적으로 CPU 점유율이 높아지는 것을 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-8.png" alt="autoscaling_prod_1-8"></p>
<p>세번째 <code>CMD</code> 창을 띄어서 <code>kubectl get pod -n $&#123;namespace 명&#125;</code> 확인 해보면 <code>Pod</code> 가 계속 생성 되고 있는 것을 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_prod_1-9.png" alt="autoscaling_prod_1-9"></p>
<p>두번째 <code>CMD</code> 창에서 서버부하를 멈추게 된다면 일정 시간 흐른 후 Pod 최소 갯수인 2개까지 줄어가는 것을 확인 할 수 있습니다.</p>
<h3 id="Autoscaling-EC2-자동-확장-작업"><a href="#Autoscaling-EC2-자동-확장-작업" class="headerlink" title="Autoscaling - EC2 자동 확장 작업"></a>Autoscaling - EC2 자동 확장 작업</h3><p><code>Pod</code> 통해 <code>Autoscaling</code> 만으로 물리적인 자원 한계치로 인해 더 이상 <code>Pod</code> 가 증설 할 수 없는 상황이 분명 있을 수 있습니다. 더 이상 증설 할 수 없는 <code>Pod</code> 는 <code>Pending</code> 상태로 변경이 되는데요. </p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/Autoscaling-EC2-architecture.png" alt="Autoscaling-EC2-architecture"></p>
<p>이미지에 보시는 것 처럼 <code>Pending</code> 상태인 <code>Pod</code> 가 생성되고 <code>Kubernetes Cluster Autoscaler</code> 는 이것을 계속 모니터링 및 감지 하고 노드를 관리하고 있는 <code>AWS Auto Scaling</code> 그룹에 노드를 증설 시켜달라고 요청을 보내게 됩니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-1.png" alt="autoscaling_ec2_1-1"></p>
<p>해당 AWS EKS Cluster 접속 하도록 합니다. 여기서 <code>Auto Scaling 그룹</code> 이라고 확인 할 수 있습니다. 실질적으로 노드를 관리 하는 역활을 담당 하고 있습니다.(EKS 가 아님) <code>Auto Scaling 그룹</code> 을 클릭 하도록 합니다.</p>
<p>여기서 최소 노드 갯수 및 최대 노드 갯수를 확인 할 수 있습니다.</p>
<h4 id="Autoscaling-EC2-자동-확장-NodeGroup-ASG-에-태그-추가-작업-진행"><a href="#Autoscaling-EC2-자동-확장-NodeGroup-ASG-에-태그-추가-작업-진행" class="headerlink" title="Autoscaling EC2 자동 확장 - NodeGroup(ASG)에 태그 추가 작업 진행"></a>Autoscaling EC2 자동 확장 - NodeGroup(ASG)에 태그 추가 작업 진행</h4><p>지금까지 설명한 flow 를 진행하기 위해서는 우선 <code>NodeGroup(ASG)</code>에 태그 추가 작업 진행 해야 합니다. 이 태그값의 의미는 <code>ASG</code>에 대한 통제권을 <code>Kubernetes Cluster Autoscaler</code> 한테 맡긴다는 의미입니다. 작업을 진행 하도록 하겠습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-2.png" alt="autoscaling_ec2_1-2"></p>
<p>우선 AWS EKS 해당 클러스터에 접근 해서 <code>Auto Scaling 그룹</code> 을 클릭해서 접속 하도록 합니다. </p>
<ol>
<li><code>k8s.io/cluster-autoscaler/eks_syh</code></li>
<li><code>k8s.io/cluster-autoscaler/enabled</code></li>
</ol>
<p>해당 값을 확인 할 수 있는데요. <code>k8s.io/cluster-autoscaler/eks_syh</code> 키 값 value 값을 <code>true</code> 설정 해야 하고 <code>k8s.io/cluster-autoscaler/enabled</code> 키 값 value 값을 <code>owned</code> 로 설정 해야 합니다.</p>
<p>다시 말하자면 이 태그값을 하므로써 <code>ASG</code>에 대한 통제권을 <code>Kubernetes Cluster Autoscaler</code> 한테 맡긴다는 의미이고, <code>Kubernetes Cluster Autoscaler</code> 가 <code>EC2</code> 를 증가 해달라고 요청이 오면 <code>ASG</code>가 <code>EC2</code>를 증가하게 되는 클러스터 오토스케일러의 통제를 받습니다.</p>
<h4 id="Autoscaling-EC2-자동-확장-ID-제공업체-추가"><a href="#Autoscaling-EC2-자동-확장-ID-제공업체-추가" class="headerlink" title="Autoscaling EC2 자동 확장 - ID 제공업체 추가"></a>Autoscaling EC2 자동 확장 - ID 제공업체 추가</h4><p>다시 전체적인 흐름을 설명하자면 <code>Pod</code> 를 생성하는데 있어서 <code>EC2</code> 자원이 부족해 생성하고자 하는 <code>Pod</code> 가 <code>Pending</code> 상태가 되면 <code>Kubernetes Cluster Autoscaler</code> 가 <code>ASG</code> 에게 <code>EC2</code> 자원을 증설 해달라고 요청 하게 됩니다. 이렇게 진행하기 위해서는 <code>Kubernetes Cluster Autoscaler</code> 는 <code>AWS EkS</code> 전체 자원에 대한 모니터링 할 수 있는 권한을 가지고 있어야 합니다. 그리고 또 <code>Kubernetes Cluster Autoscaler</code> 가 <code>ASG</code> 에게 요청 할 수 있는 권한도 필요 합니다. 그리고 마지막으로 <code>EC2</code> 에 대한 권한도 필요 합니다.<br><code>Kubernetes Cluster Autoscaler</code> 가 필요한 권한 목록</p>
<ol>
<li><code>AWS EkS</code> 서비스 전체 자원에 대한 모니터링 할 수 있는 권한</li>
<li><code>ASG</code> 에게 요청 할 수 있는 권한</li>
<li><code>EC2</code> 권한 필요</li>
</ol>
<p>이렇게 설정하기 위해서는 <code>AWS IAM</code> 에 들어가서 <code>역할</code> 즉 AWS 서비스 간에 접근 할 수 있는 <code>정책</code> 을 생성해서 부여 해야 합니다. 즉 <code>Kubernetes Cluster Autoscaler</code> 가 3가지 접근 할 수 있는 <code>역할</code> 을 생성 해야 합니다.</p>
<p>그런데 AWS 에서 <code>역할</code> 이라는 것은 AWS 서비스 (EX: EC2) 간에 권한 부여 하는 것 입니다. 하지만 <code>Kubernetes Cluster Autoscaler</code> 경우는 <code>AWS EKS</code> 안에 있는 <code>Pod</code> 이기 때문에 AWS 서비스 단위 라고 불리기는 어렵습니다. 이러한 부분을 해결 하기 위해서는 <code>Kubernetes Cluster Autoscaler</code> 이라는 <code>Pod</code> 단위를 <code>신뢰 할 수 있는 엔티티</code> 로 등록 시켜줘야 합니다.</p>
<p><code>EKS</code> 상에서 실행되고 있는 수많은 요소들이 있을 건데 이 요소들이 <code>AWS</code> 상에서 독립적으로 나 신뢰할 수 있는 요소야 라고 등록이 되려면 그 보증을 <code>EKS</code>가 해주게 됩니다. <code>EKS</code> 는 AWS 서비스 자원이기 때문에 ID 제공 업체로 추가 해주고 추가된 Id 값을 이용해서 <code>Kubernetes Cluster Autoscaler</code> 이라는 <code>Pod</code> 가 <code>신뢰할 수 있는 엔티티</code>다 라고 등록을 해주는 작업을 진행 해야 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-4.png" alt="autoscaling_ec2_1-4"></p>
<p><code>AWS EKS</code> 서비스에 접근해서 <code>OpenID Connect 공급자 URL</code> 복사 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-3.png" alt="autoscaling_ec2_1-3"></p>
<p>AWS IAM 서비스로 접근 해서 왼쪽 메뉴에 <code>ID 제공 업체</code> 버튼을 클릭 해서 <code>공급자 추가</code> 버튼을 클릭 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-5.png" alt="autoscaling_ec2_1-5"></p>
<p>공급자 유형을 <code>OpenID Connect</code> 선택 합니다. 그리고 공급자 URL 를 복사 했던 <code>OpenID Connect 공급자 URL</code> 값을 붙여넣기 하도록 합니다. 여기서 대상은 <code>sts.amazonaws.com</code> 로 입력 하도록 합니다.</p>
<p>STS 경우는 AWS 에서 제공 해주는 <code>보안 토큰 서비스</code> 입니다. <code>Kubernetes Cluster Autoscaler 같은 </code>Pod<code>는</code>STS&#96;에 Role 사용 요청 할 때 사용 합니다.</p>
<h4 id="Autoscaling-EC2-자동-확장-IAM-역할-생성"><a href="#Autoscaling-EC2-자동-확장-IAM-역할-생성" class="headerlink" title="Autoscaling EC2 자동 확장 - IAM 역할 생성"></a>Autoscaling EC2 자동 확장 - IAM 역할 생성</h4><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-6.png" alt="autoscaling_ec2_1-6"></p>
<p><code>AWS IAM</code> 서비스로 접근 해서 왼쪽 메뉴에 <code>역할</code> 버튼을 클릭하고 <code>역할 생성</code> 버튼을 클릭 하도록 합니다. </p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-7.png" alt="autoscaling_ec2_1-7"></p>
<p>신뢰할 수 있는 엔티티 유형을 <code>사용자 지정 신뢰 정책</code> 로 선택 합니다. 그리고 <code>사용자 지정 신뢰 정책</code> 을 구성 해야 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">  &quot;Statement&quot;: [</span><br><span class="line"><span class="code">    &#123;</span></span><br><span class="line"><span class="code">      &quot;Effect&quot;: &quot;Allow&quot;,</span></span><br><span class="line"><span class="code">      &quot;Principal&quot;: &#123;</span></span><br><span class="line"><span class="code">        &quot;Federated&quot;: &quot;arn:aws:iam::&lt;AWS_ACCOUNT_ID&gt;:oidc-provider/&lt;YOUR_EKS_OIDC_PROVIDER&gt;&quot;</span></span><br><span class="line"><span class="code">      &#125;,</span></span><br><span class="line"><span class="code">      &quot;Action&quot;: &quot;sts:AssumeRoleWithWebIdentity&quot;,</span></span><br><span class="line"><span class="code">      &quot;Condition&quot;: &#123;</span></span><br><span class="line"><span class="code">        &quot;StringEquals&quot;: &#123;</span></span><br><span class="line"><span class="code">          &quot;&lt;YOUR_EKS_OIDC_PROVIDER&gt;:sub&quot;: &quot;system:serviceaccount:kube-system:cluster-autoscaler&quot;</span></span><br><span class="line"><span class="code">        &#125;</span></span><br><span class="line"><span class="code">      &#125;</span></span><br><span class="line"><span class="code">    &#125;</span></span><br><span class="line"><span class="code">  ]</span></span><br><span class="line"><span class="code">&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;AWS_ACCOUNT_ID&gt;</code>: AWS 계정 아이디값<br><code>&lt;YOUR_EKS_OIDC_PROVIDER&gt;</code>: <code>AWS EKS</code> 서비스에 접근해서 <code>OpenID Connect 공급자 URL</code> (Http 프로토콜 제외)</p>
<p>입력 하고 다음 버튼 클릭 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-8.png" alt="autoscaling_ec2_1-8"></p>
<p>권한을 추가 해야 하는데요.</p>
<ol>
<li>AmazonEKSClusterPolicy</li>
<li>AutoScalingFullAccess</li>
<li>AmazonEC2FullAccess</li>
</ol>
<p>이렇게 추가 해서 다음 버튼 클릭 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-9.png" alt="autoscaling_ec2_1-9"></p>
<p>역할 이름을 지정 하고 최종 확인 버튼을 클릭 합니다.</p>
<h4 id="부하테스트-통해-실제로-Node-가-자동-생성-되는지-확인-해보기"><a href="#부하테스트-통해-실제로-Node-가-자동-생성-되는지-확인-해보기" class="headerlink" title="부하테스트 통해 실제로 Node 가 자동 생성 되는지 확인 해보기"></a>부하테스트 통해 실제로 Node 가 자동 생성 되는지 확인 해보기</h4><p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-10.png" alt="autoscaling_ec2_1-10"></p>
<p><code>AWS EKS</code> 서비스에 들어가서 노드 최대 갯수를 2 에서 3으로 수정 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-11.png" alt="autoscaling_ec2_1-11"></p>
<p>실제로 <code>cluster-autoscaler</code> 역할을 하고 있는 <code>autoscaler.yml</code> 파일에 들어가서 수정 작업이 필요 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line"><span class="code">    k8s-addon: cluster-autoscaler.addons.k8s.io</span></span><br><span class="line"><span class="code">    k8s-app: cluster-autoscaler</span></span><br><span class="line"><span class="code">  name: cluster-autoscaler</span></span><br><span class="line"><span class="code">  namespace: kube-system</span></span><br><span class="line"><span class="code">  annotations:</span></span><br><span class="line"><span class="code">    eks.amazonaws.com/role-arn: $&#123;ARN 주소값&#125;</span></span><br></pre></td></tr></table></figure>
<p><code>eks.amazonaws.com/role-arn</code>: 방금 생성한 <code>cluster-autoscaler</code> 역할 ARN 주소값</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">containers:</span><br><span class="line"><span class="bullet">  -</span> image: k8s.gcr.io/autoscaling/cluster-autoscaler:v1.29.0</span><br><span class="line"><span class="code">    name: cluster-autoscaler</span></span><br><span class="line"><span class="code">    resources:</span></span><br><span class="line"><span class="code">      limits:</span></span><br><span class="line"><span class="code">        cpu: 100m</span></span><br><span class="line"><span class="code">        memory: 600Mi</span></span><br><span class="line"><span class="code">      requests:</span></span><br><span class="line"><span class="code">        cpu: 100m</span></span><br><span class="line"><span class="code">        memory: 600Mi</span></span><br><span class="line"><span class="code">    command:</span></span><br><span class="line"><span class="code">      - ./cluster-autoscaler</span></span><br><span class="line"><span class="code">      - --v=4</span></span><br><span class="line"><span class="code">      - --stderrthreshold=info</span></span><br><span class="line"><span class="code">      - --cloud-provider=aws</span></span><br><span class="line"><span class="code">      - --skip-nodes-with-local-storage=false</span></span><br><span class="line"><span class="code">      - --expander=least-waste</span></span><br><span class="line"><span class="code">      - --cluster-name=$&#123;AWS EKS Cluster 이름&#125;</span></span><br><span class="line"><span class="code">      - --node-group-auto-discovery=asg:tag=k8s.io/cluster-autoscaler/enabled,k8s.io/cluster-autoscaler/eks_syh</span></span><br><span class="line"><span class="code">    env:</span></span><br><span class="line"><span class="code">      - name: AWS_REGION</span></span><br><span class="line"><span class="code">        value: &quot;ap-northeast-2&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>--cluster-name</code>: ${AWS EKS Cluster 이름}<br><code>--node-group-auto-discovery=asg:tag</code>: k8s.io&#x2F;cluster-autoscaler&#x2F;enabled,k8s.io&#x2F;cluster-autoscaler&#x2F;${AWS EKS Cluster 이름}</p>
<p>이렇게 수정해서 <code>autoscaler.yml</code> apply 하도록 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;프로젝트 ROOT 디렉토리&#125;\k8s\k8s-project</span><br><span class="line">kubectl apply -f ./autoscaler.yml</span><br></pre></td></tr></table></figure>

<p><code>hpa.yml</code> 파일에 들어가서 <code>maxReplicas</code> 10개로 수정 및 <code>targetCPUUtilizationPercentage</code> 30 으로 수정하고 다시 apply 하도록 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## hpa.yml 수정</span></span><br><span class="line">kubectl apply -f ./hap.yml</span><br></pre></td></tr></table></figure>

<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-12.png" alt="autoscaling_ec2_1-12"></p>
<p>첫번재 <code>CMD</code> 창을 실행해서</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get hpa project-backend-hpa -n dev -w</span><br></pre></td></tr></table></figure>
<p>현재 <code>Pod</code> 자원 조회 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-13.png" alt="autoscaling_ec2_1-13"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -n dev</span><br></pre></td></tr></table></figure>
<p>두번재 <code>CMD</code> 창을 실행해서 설치된 <code>Pod</code> 조회 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it &#123;Pod name&#125; -n dev -- /bin/sh # pod 접속</span><br></pre></td></tr></table></figure>

<p>2개 중 하나를 선택해서 해당 컨테이너로 <code>exec</code> 명령어를 이용해 접속 하도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-14.png" alt="autoscaling_ec2_1-14"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apk add --no-cache curl # curl 설치</span><br></pre></td></tr></table></figure>
<p>서버부하를 위해서 미리 <code>curl</code> 설치를 하도록 합니다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">while true; do curl -s http://project-backend-service/health; done</span><br></pre></td></tr></table></figure>
<p>실제로 while 문을 이용해서 <code>/health</code> API 를 계속 호출 시켜 강제로 서버부하를 일으키도록 합니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-15.png" alt="autoscaling_ec2_1-15"></p>
<p>첫번째 <code>CMD</code> 창에서 계속 모니터링 해보면 지속적으로 CPU 점유율이 높아지는 것을 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-16.png" alt="autoscaling_ec2_1-16"></p>
<p>노드 자원 한계로 인해 더 이상 <code>Pod</code> 가 생성 되지 않고 <code>Pending</code> 상태 인걸로 볼 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-17.png" alt="autoscaling_ec2_1-17"></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;Pending&#x27; 된 pod describe 확인 해보기</span><br><span class="line">kubectl describe pod $&#123;&#x27;Pending&#x27; 된 pod NAME&#125; -n dev</span><br></pre></td></tr></table></figure>
<p><code>Pending</code> 된 <code>pod</code> describe 확인 해보면 자원이 부족 하다는 에러 메시지를 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-18.png" alt="autoscaling_ec2_1-18"></p>
<p>조금 기다려보면 <code>Pending</code> 된 <code>Pod</code> 가 <code>Running</code> 상태로 변환 되는 것을 확인 할수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-19.png" alt="autoscaling_ec2_1-19"></p>
<p>실제로 <code>AWS EKS 노드그룹</code>에서 확인 해보면 2개 였던 노드가 2개로 증설 되었다는 것을 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-20.png" alt="autoscaling_ec2_1-20"></p>
<p>두번째 <code>CMD</code> 창에서 서버부하를 멈추게 된다면 일정 시간 흐른 후 다시 <code>Pod</code> 를 조회 하면  2개의 <code>Pod</code> 로 줄어든 것을 확인 할 수 있습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-21.png" alt="autoscaling_ec2_1-21"></p>
<p><code>AWS EKS 노드그룹</code>에서 확인 해보면 3개 였던 노드 갯수가 2개로 줄어들었습니다.</p>
<p><img src="/../../../img/CI-CD/AWS_EKS_CICD/flow/deploy/autoscaling_ec2_1-22.png" alt="autoscaling_ec2_1-22"></p>
<p>Cpu 점유율이 점점 줄어 들고 있는 것을 확인 할 수 있습니다.</p>

      
       <hr><span style="font-style: italic;color: gray;"> Copyright 201- syh8088. 무단 전재 및 재배포 금지. 출처 표기 시 인용 가능. </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">버튼</a>
</p>






    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2017 Seo Yang Hun
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
